<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üÜò H·ªá Th·ªëng X√°c Minh & ƒêi·ªÅu Ph·ªëi C·ª©u Tr·ª£ Kh·∫©n C·∫•p</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --green-50: #f0fdf4;
            --green-100: #dcfce7;
            --green-500: #22c55e;
            --green-600: #16a34a;
            --green-700: #15803d;
            --red-50: #fef2f2;
            --red-100: #fee2e2;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --yellow-50: #fefce8;
            --yellow-100: #fef9c3;
            --yellow-500: #eab308;
            --yellow-600: #ca8a04;
            --blue-500: #3b82f6;
            --purple-500: #8b5cf6;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
            color: var(--gray-900);
        }

        .phone-frame {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(0, 0, 0, 0.1);
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: white;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 20px;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--gray-400);
            font-size: 10px;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: var(--green-600);
        }

        .nav-item .icon {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .header {
            background: linear-gradient(135deg, var(--green-600), var(--green-700));
            color: white;
            padding: 14px 20px 35px;
            /* Reduced by half */
        }

        .header-small {
            background: var(--green-600);
            color: white;
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-small .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            margin-top: 4px;
            font-size: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            /* Approx 1/2 side length */
            justify-content: center;
            gap: 8px;
            padding: 0 20px;
            margin-top: -30px;
            /* Reduced overlap */
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 5px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .stat-card .number {
            font-size: 14px;
            font-weight: 700;
        }

        .stat-card .label {
            font-size: 8px;
            color: var(--gray-500);
            margin-top: 2px;
            white-space: nowrap;
        }

        .stat-card.sos .number {
            color: var(--red-500);
        }

        .stat-card.medical .number {
            color: var(--yellow-600);
        }

        .stat-card.safe .number {
            color: var(--green-600);
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin: 12px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .workflow-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .workflow-btn {
            padding: 16px 12px;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .workflow-btn:active {
            transform: scale(0.98);
        }

        .workflow-btn.verify {
            background: linear-gradient(135deg, var(--blue-500), #2563eb);
            color: white;
        }

        .workflow-btn.map {
            background: linear-gradient(135deg, var(--green-500), var(--green-600));
            color: white;
        }

        .workflow-btn.id {
            background: linear-gradient(135deg, var(--purple-500), #7c3aed);
            color: white;
        }

        .workflow-btn.register {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
        }

        .workflow-btn .icon {
            font-size: 28px;
            display: block;
            margin-bottom: 6px;
        }

        .workflow-btn .text {
            font-size: 12px;
            font-weight: 600;
        }

        .case-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
        }

        .case-status {
            width: 5px;
            height: 40px;
            border-radius: 3px;
            margin-right: 10px;
        }

        .case-status.sos {
            background: var(--red-500);
        }

        .case-status.medical {
            background: var(--yellow-500);
        }

        .case-status.safe {
            background: var(--green-500);
        }

        .case-info {
            flex: 1;
        }

        .case-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
        }

        .case-address {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .case-meta {
            font-size: 11px;
            color: var(--gray-400);
            margin-top: 2px;
        }

        .case-badge {
            font-size: 9px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 20px;
        }

        .case-badge.sos {
            background: var(--red-100);
            color: var(--red-600);
        }

        .case-badge.medical {
            background: var(--yellow-100);
            color: var(--yellow-600);
        }

        .case-badge.safe {
            background: var(--green-100);
            color: var(--green-600);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--green-500), var(--green-600));
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--red-500), var(--red-600));
            color: white;
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--green-500);
            color: var(--green-600);
        }

        .form-group {
            margin-bottom: 14px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--green-500);
            box-shadow: 0 0 0 3px var(--green-100);
        }

        .call-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 30px 20px;
        }

        .counter-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid var(--green-500);
            background: white;
            font-size: 26px;
            color: var(--green-600);
            cursor: pointer;
        }

        .counter-value {
            font-size: 64px;
            font-weight: 700;
            color: var(--green-600);
            min-width: 80px;
            text-align: center;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-200);
            margin: 0 16px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-500);
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--green-600);
            border-bottom-color: var(--green-600);
        }

        .progress-section {
            padding: 14px 16px;
            background: var(--green-50);
        }

        .progress-bar-bg {
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green-500), var(--green-600));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 6px;
            color: var(--gray-600);
        }

        .script-card {
            background: var(--gray-50);
            border-radius: 10px;
            margin: 12px 16px;
            overflow: hidden;
        }

        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: var(--gray-100);
            cursor: pointer;
            font-size: 13px;
        }

        .script-content {
            padding: 14px;
            font-size: 13px;
            line-height: 1.5;
            color: var(--gray-700);
            display: none;
        }

        .script-content.show {
            display: block;
        }

        .call-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 10px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .call-item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .call-item-status {
            width: 6px;
            height: 36px;
            border-radius: 3px;
        }

        .call-item-status.pending {
            background: var(--yellow-500);
        }

        .call-item-status.completed {
            background: var(--green-500);
        }

        .call-item-status.unreachable {
            background: var(--red-500);
        }

        .call-item-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 14px;
        }

        .call-item-phone {
            font-size: 16px;
            font-weight: 700;
            color: var(--green-600);
        }

        .call-item-address {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .call-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
        }

        .call-action-btn {
            padding: 8px 6px;
            border-radius: 8px;
            border: none;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .call-action-btn.call {
            background: var(--green-500);
            color: white;
        }

        .call-action-btn.form {
            background: var(--blue-500);
            color: white;
        }

        .call-action-btn.skip {
            background: var(--gray-200);
            color: var(--gray-600);
        }

        #map {
            height: calc(100vh - 140px);
            width: 100%;
        }

        #windy {
            width: 90%;
            height: 40vh;
            margin: 10px auto;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .map-legend {
            position: absolute;
            bottom: 90px;
            left: 16px;
            background: white;
            padding: 10px 14px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            font-size: 11px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 3px 0;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .scanner-area {
            background: var(--gray-900);
            min-height: 280px;
            margin: 16px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .scanner-area video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #qr-reader {
            width: 100% !important;
            height: 100% !important;
            border: none !important;
            position: absolute;
            top: 0;
            left: 0;
        }

        #qr-reader video {
            border-radius: 10px;
        }

        #qr-reader__scan_region {
            display: flex !important;
            justify-content: center !important;
        }

        .scanner-frame {
            width: 180px;
            height: 180px;
            border: 3px solid var(--green-500);
            border-radius: 14px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
        }

        .scanner-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: var(--green-500);
            box-shadow: 0 0 10px var(--green-500);
            animation: scan 2s infinite;
        }

        @keyframes scan {

            0%,
            100% {
                top: 0;
            }

            50% {
                top: calc(100% - 2px);
            }
        }

        .already-received-banner {
            background: var(--red-50);
            border: 2px solid var(--red-500);
            padding: 16px;
            margin: 16px;
            border-radius: 10px;
            text-align: center;
        }

        .already-received-banner .icon {
            font-size: 40px;
            margin-bottom: 8px;
        }

        .already-received-banner .title {
            font-size: 16px;
            font-weight: 700;
            color: var(--red-600);
            margin-bottom: 4px;
        }

        .already-received-banner .description {
            font-size: 13px;
            color: var(--red-500);
        }

        .scanned-result {
            background: var(--green-50);
            padding: 16px;
            margin: 16px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--green-200);
        }

        .scanned-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--green-600);
            letter-spacing: 2px;
        }

        .login-header {
            text-align: center;
            padding: 50px 20px 30px;
        }

        .login-logo {
            font-size: 56px;
            margin-bottom: 12px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--green-700);
        }

        .login-subtitle {
            color: var(--gray-500);
            margin-top: 6px;
            font-size: 13px;
        }

        .login-form {
            padding: 0 20px;
        }

        .login-footer {
            text-align: center;
            padding: 20px;
        }

        .login-footer a {
            color: var(--green-600);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
        }

        .profile-header {
            background: linear-gradient(135deg, var(--green-600), var(--green-700));
            padding: 40px 20px 28px;
            text-align: center;
            color: white;
        }

        .profile-avatar {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 12px;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 700;
        }

        .profile-email {
            opacity: 0.9;
            margin-top: 4px;
            font-size: 13px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 16px;
            margin-top: -16px;
        }

        .profile-stat {
            background: white;
            padding: 14px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .profile-stat-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--green-600);
        }

        .profile-stat-label {
            font-size: 10px;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .recording-btn {
            background: var(--red-500);
            color: white;
            padding: 16px;
            border-radius: 50%;
            font-size: 28px;
            border: none;
            cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(239, 68, 68, 0);
            }
        }

        .priority-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 6px;
        }

        .priority-tag.high {
            background: var(--red-100);
            color: var(--red-600);
        }

        .priority-tag.medium {
            background: var(--yellow-100);
            color: var(--yellow-600);
        }

        .priority-tag.low {
            background: var(--green-100);
            color: var(--green-600);
        }

        .data-source {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--gray-100);
            border-radius: 20px;
            font-size: 11px;
            color: var(--gray-600);
            margin: 2px;
        }

        .volunteer-card {
            background: white;
            border-radius: 12px;
            padding: 14px;
            margin: 10px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--green-500);
        }

        .volunteer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .volunteer-name {
            font-weight: 600;
            color: var(--gray-800);
        }

        .volunteer-goods {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .volunteer-route {
            font-size: 11px;
            color: var(--green-600);
            margin-top: 4px;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .history-avatar {
            width: 40px;
            height: 40px;
            background: var(--green-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-right: 12px;
        }

        .history-info {
            flex: 1;
        }

        .history-name {
            font-weight: 600;
            font-size: 14px;
        }

        .history-cccd {
            font-size: 12px;
            color: var(--gray-500);
        }

        .history-time {
            font-size: 11px;
            color: var(--gray-400);
        }

        .history-count {
            text-align: right;
        }

        .history-count-num {
            font-size: 20px;
            font-weight: 700;
            color: var(--green-600);
        }

        .history-count-label {
            font-size: 10px;
            color: var(--gray-500);
        }

        .alert-banner {
            background: var(--yellow-100);
            border-left: 4px solid var(--yellow-500);
            padding: 10px 14px;
            margin: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            color: var(--yellow-600);
        }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 12px 24px;
            border-radius: 100px;
            font-size: 14px;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.show {
            opacity: 1;
        }

        .hidden {
            display: none !important;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            padding: 12px 16px 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Logo placeholder */
        .logo-placeholder {
            width: 100px;
            height: 100px;
            margin: 0 auto 16px;
            border: 3px dashed var(--gray-300);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-50);
            overflow: hidden;
        }

        .logo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-placeholder .placeholder-text {
            font-size: 10px;
            color: var(--gray-400);
            text-align: center;
        }

        /* Compact workflow grid */
        .workflow-grid-compact {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .workflow-btn-compact {
            padding: 10px 4px;
            border-radius: 12px;
            border: 1px solid transparent;
            /* Prepare for borders */
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }

        .workflow-btn-compact:active {
            transform: scale(0.95);
        }

        .workflow-btn-compact .icon {
            font-size: 24px;
            /* Larger icons for visibility */
            display: block;
            margin-bottom: 6px;
        }

        .workflow-btn-compact .text {
            font-size: 10px;
            font-weight: 700;
            line-height: 1.2;
        }

        /* Pastel Themes */
        .workflow-btn-compact.verify {
            background: #eff6ff;
            /* Blue 50 */
            color: #1d4ed8;
            /* Blue 700 */
            border-color: #dbeafe;
        }

        .workflow-btn-compact.map {
            background: #f0fdf4;
            /* Green 50 */
            color: #15803d;
            /* Green 700 */
            border-color: #dcfce7;
        }

        .workflow-btn-compact.id {
            background: #faf5ff;
            /* Purple 50 */
            color: #7e22ce;
            /* Purple 700 */
            border-color: #f3e8ff;
        }

        .workflow-btn-compact.register {
            background: #fff7ed;
            /* Orange 50 */
            color: #c2410c;
            /* Orange 700 */
            border-color: #ffedd5;
        }

        .workflow-btn-compact.cases {
            background: #fef2f2;
            /* Red 50 */
            color: #b91c1c;
            /* Red 700 */
            border-color: #fee2e2;
        }

        /* Highlighted Container Custom Style */
        #main-workflow-container {
            border: 2px solid #bfdbfe !important;
            /* Blue 200 frame */
            background: linear-gradient(180deg, #f0f9ff 0%, #ffffff 100%) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15) !important;
        }

        /* Region cards */
        .region-card {
            background: white;
            border-radius: 14px;
            padding: 14px;
            margin: 10px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 5px solid;
        }

        .region-card:active {
            transform: scale(0.98);
        }

        .region-card.critical {
            border-left-color: var(--red-500);
        }

        .region-card.high {
            border-left-color: #f97316;
        }

        .region-card.medium {
            border-left-color: var(--yellow-500);
        }

        .region-card.low {
            border-left-color: var(--green-500);
        }

        .region-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .region-name {
            font-weight: 700;
            font-size: 15px;
            color: var(--gray-800);
        }

        .region-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
        }

        .region-badge.critical {
            background: var(--red-100);
            color: var(--red-600);
        }

        .region-badge.high {
            background: #ffedd5;
            color: #c2410c;
        }

        .region-badge.medium {
            background: var(--yellow-100);
            color: var(--yellow-600);
        }

        .region-badge.low {
            background: var(--green-100);
            color: var(--green-600);
        }

        .region-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--gray-500);
        }

        .region-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Convoy cards */
        .convoy-card {
            background: white;
            border-radius: 12px;
            padding: 12px 14px;
            margin: 8px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--blue-500);
        }

        .convoy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .convoy-name {
            font-weight: 700;
            font-size: 13px;
            color: var(--gray-800);
        }

        .convoy-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }

        .convoy-badge.arriving {
            background: var(--green-100);
            color: var(--green-600);
        }

        .convoy-badge.enroute {
            background: var(--blue-100);
            color: var(--blue-600);
        }

        .convoy-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 11px;
            color: var(--gray-500);
            margin-bottom: 6px;
        }

        .convoy-eta {
            font-size: 11px;
            color: var(--blue-600);
            font-weight: 600;
        }

        /* Household list */
        .household-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .household-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .household-status.critical {
            background: var(--red-500);
        }

        .household-status.high {
            background: #f97316;
        }

        .household-status.medium {
            background: var(--yellow-500);
        }

        .household-status.low {
            background: var(--green-500);
        }

        .household-info {
            flex: 1;
        }

        .household-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
        }

        .household-detail {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .household-arrow {
            color: var(--gray-400);
            font-size: 16px;
        }

        /* News and Tips cards */
        .news-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 16px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .news-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .news-icon.alert {
            background: var(--red-100);
        }

        .news-icon.info {
            background: var(--blue-500);
            background: #dbeafe;
        }

        .news-icon.success {
            background: var(--green-100);
        }

        .news-icon.warning {
            background: var(--yellow-100);
        }

        .news-content {
            flex: 1;
        }

        .news-title {
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-800);
            margin-bottom: 2px;
        }

        .news-desc {
            font-size: 11px;
            color: var(--gray-500);
            line-height: 1.4;
        }

        .news-time {
            font-size: 10px;
            color: var(--gray-400);
            margin-top: 4px;
        }

        .tip-card {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border-radius: 12px;
            padding: 14px;
            margin: 8px 16px;
            color: white;
        }

        .tip-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .tip-content {
            font-size: 12px;
            line-height: 1.5;
            opacity: 0.95;
        }

        .tip-content ul {
            margin: 8px 0 0 16px;
            padding: 0;
        }

        .tip-content li {
            margin-bottom: 4px;
        }

        .see-more-btn {
            display: block;
            text-align: center;
            padding: 10px;
            margin: 8px 16px;
            background: var(--gray-100);
            border-radius: 10px;
            color: var(--gray-600);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .see-more-btn:hover {
            background: var(--gray-200);
        }

        /* Collapsible Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--gray-50);
            cursor: pointer;
            border-bottom: 1px solid var(--gray-200);
            margin-top: 8px;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: var(--gray-100);
        }

        .section-header .section-title {
            margin: 0;
            padding: 0;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .section-toggle {
            font-size: 14px;
            color: var(--gray-500);
            transition: transform 0.3s;
        }

        .section-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-section {
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 2000px;
            opacity: 1;
        }

        .collapsible-section.collapsed {
            max-height: 0;
            opacity: 0;
        }

        /* Doctor Call Section */
        .doctor-call-card {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid var(--red-400);
            border-radius: 14px;
            padding: 14px;
            margin: 8px 16px;
        }

        .health-condition-select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 14px;
            background: white;
            margin-top: 10px;
        }

        /* Photo Upload */
        .photo-upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            background: var(--gray-50);
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .photo-upload-area:hover {
            border-color: var(--green-500);
            background: var(--green-50);
        }

        .photo-upload-area .upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .photo-upload-area .upload-text {
            font-size: 12px;
            color: var(--gray-600);
        }

        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .photo-preview-item {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview-item .remove-photo {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--red-500);
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            cursor: pointer;
        }

        /* Symptom Selection Modal */
        .symptom-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            justify-content: center;
            align-items: center;
        }

        .symptom-modal-overlay.show {
            display: flex;
        }

        .symptom-modal {
            background: white;
            border-radius: 16px;
            padding: 20px;
            width: 90%;
            max-width: 380px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .symptom-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .symptom-modal-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .symptom-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray-500);
        }

        .symptom-option {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .symptom-option:hover {
            border-color: var(--red-400);
            background: var(--red-50);
        }

        .symptom-option.selected {
            border-color: var(--red-500);
            background: var(--red-50);
        }

        .symptom-option input[type="checkbox"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            accent-color: var(--red-500);
        }

        .symptom-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .symptom-text {
            flex: 1;
        }

        .symptom-text-title {
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-800);
        }

        .symptom-text-desc {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .doctor-call-section {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-radius: 14px;
            padding: 16px;
            margin: 12px 16px;
            border: 2px solid var(--red-300);
        }

        .doctor-call-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .doctor-call-title {
            font-weight: 700;
            font-size: 15px;
            color: var(--red-700);
        }

        .doctor-call-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .doctor-btn {
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .doctor-btn:active {
            transform: scale(0.98);
        }

        .doctor-btn.call {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
        }

        .doctor-btn.symptoms {
            background: white;
            border: 2px solid var(--red-400);
            color: var(--red-700);
        }

        .doctor-btn .btn-icon {
            font-size: 24px;
        }

        /* Photo upload for convoy */
        .convoy-photo-upload {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: var(--gray-50);
            border: 2px dashed var(--gray-300);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .convoy-photo-upload:hover {
            border-color: var(--green-500);
            background: var(--green-50);
        }

        .convoy-photo-upload .upload-icon {
            font-size: 20px;
        }

        .convoy-photo-upload .upload-text {
            font-size: 12px;
            color: var(--gray-600);
        }

        .convoy-photos-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .convoy-photo-item {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .convoy-photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Modal Overlay Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay>div {
            max-width: 430px;
            width: 100%;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideDown {
            from {
                transform: translateY(0);
                opacity: 1;
            }

            to {
                transform: translateY(100%);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div class="phone-frame">
        <!-- Login Screen -->
        <div class="screen active" id="screen-login">
            <div class="login-header" style="position: relative;">
                <!-- Language Toggle Button -->
                <button id="lang-toggle-login" onclick="toggleLanguage()"
                    style="position: absolute; top: 10px; right: 10px; width: 44px; height: 44px; border-radius: 50%; background: white; border: 2px solid var(--green-500); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.15); font-size: 22px; z-index: 10;">
                    <span id="lang-flag-login">üáªüá≥</span>
                </button>
                <div class="logo-placeholder" style="margin-bottom: 16px;">
                    <img src="https://i.postimg.cc/g0fMQWGQ/Anh-chup-man-hinh-2026-01-28-072615.png" alt="Logo">
                </div>
                <div class="login-title"><span class="lang-vi">X√°c Minh & ƒêi·ªÅu Ph·ªëi</span><span class="lang-en"
                        style="display:none;">Verification & Coordination</span></div>
                <div class="login-subtitle"><span class="lang-vi">C·ª©u Tr·ª£ Kh·∫©n C·∫•p</span><span class="lang-en"
                        style="display:none;">Emergency Relief</span></div>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label class="form-label">Email / S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="text" class="form-input" value="volunteer@relief.vn">
                </div>
                <div class="form-group">
                    <label class="form-label">M·∫≠t kh·∫©u</label>
                    <input type="password" class="form-input" value="password">
                </div>
                <button class="btn btn-primary" onclick="showScreen('home')">ƒêƒÉng nh·∫≠p</button>
            </div>

            <!-- VNeID Login Section & Emergency Button -->
            <div style="padding: 0 24px;">
                <div style="display: flex; align-items: center; gap: 12px; margin: 16px 0;">
                    <div style="flex: 1; height: 1px; background: var(--gray-300);"></div>
                    <span style="font-size: 12px; color: var(--gray-500);"><span class="lang-vi">ho·∫∑c</span><span
                            class="lang-en" style="display:none;">or</span></span>
                    <div style="flex: 1; height: 1px; background: var(--gray-300);"></div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <!-- VNeID (2/3 width) -->
                    <button onclick="showScreen('vneid')"
                        style="flex: 2; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; background: linear-gradient(135deg, #dc2626, #ef4444); border: none; border-radius: 12px; color: white; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);">
                        <img src="https://cdn.tgdd.vn/2023/07/GameApp/vneid-200x200.jpg" alt="VNeID"
                            style="width: 26px; height: 26px; border-radius: 6px; object-fit: cover;">
                        <span><span class="lang-vi">ƒêƒÉng nh·∫≠p VNeID</span><span class="lang-en"
                                style="display:none;">VNeID Login</span></span>
                    </button>
                    <!-- Emergency Button (1/3 width) -->
                    <button onclick="toggleSOSOverlay(true)"
                        style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 14px 8px; background: linear-gradient(135deg, #f97316, #ea580c); border: none; border-radius: 12px; color: white; font-weight: 600; font-size: 11px; cursor: pointer; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);">
                        <span style="font-size: 20px;">üÜò</span>
                        <span><span class="lang-vi">Kh·∫©n c·∫•p</span><span class="lang-en"
                                style="display:none;">Emergency</span></span>
                    </button>
                </div>
                <p style="font-size: 10px; color: var(--gray-500); text-align: center; margin-top: 8px;">
                    <span class="lang-vi">ƒê·ªãnh danh ƒëi·ªán t·ª≠ Qu·ªëc gia - X√°c th·ª±c nhanh ch√≥ng v√† an to√†n</span>
                    <span class="lang-en" style="display:none;">National Digital ID - Fast and secure
                        authentication</span>
                </p>
            </div>

            <div class="login-footer">
                <a href="#" onclick="showScreen('register')">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</a>

                <!-- Author Info -->
                <div style="margin-top: 30px; border-top: 1px solid var(--gray-200); padding-top: 20px;">
                    <div style="font-size: 12px; color: var(--gray-500); margin-bottom: 8px;">T√°c gi·∫£</div>
                    <div style="font-weight: 700; color: var(--green-700); font-size: 15px; margin-bottom: 12px;">Nguy·ªÖn
                        Tr·∫ßn Ti·∫øn Ph√∫c</div>

                    <div style="display: flex; justify-content: center; gap: 16px;">
                        <!-- Facebook -->
                        <a href="https://www.facebook.com/nguyen.phuc.524150" target="_blank"
                            style="display: flex; flex-direction: column; align-items: center; gap: 4px; text-decoration: none; color: var(--gray-700);">
                            <div
                                style="width: 36px; height: 36px; background: #1877F2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                f</div>
                            <span style="font-size: 10px;">Nguy·ªÖn Ph√∫c</span>
                        </a>

                        <!-- Mail -->
                        <a href="mailto:pn852007@gmail.com"
                            style="display: flex; flex-direction: column; align-items: center; gap: 4px; text-decoration: none; color: var(--gray-700);">
                            <div
                                style="width: 36px; height: 36px; background: #EA4335; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                ‚úâÔ∏è</div>
                            <span style="font-size: 10px;">Email</span>
                        </a>

                        <!-- Phone -->
                        <a href="tel:0342381843"
                            style="display: flex; flex-direction: column; align-items: center; gap: 4px; text-decoration: none; color: var(--gray-700);">
                            <div
                                style="width: 36px; height: 36px; background: #34A853; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                üìû</div>
                            <span style="font-size: 10px;">0342381843</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOS Emergency Overlay -->
        <div id="sos-overlay"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
            <!-- Close Button -->
            <button onclick="toggleSOSOverlay(false)"
                style="position: absolute; top: 20px; right: 20px; width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer;">√ó</button>

            <!-- SOS Title -->
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 24px; font-weight: 700; color: white; margin-bottom: 8px;">
                    <span class="lang-vi">üÜò CH·∫æ ƒê·ªò KH·∫®N C·∫§P</span>
                    <span class="lang-en" style="display:none;">üÜò EMERGENCY MODE</span>
                </div>
                <div style="font-size: 14px; color: rgba(255,255,255,0.7);">
                    <span class="lang-vi">Gi·ªØ n√∫t SOS trong 3 gi√¢y ƒë·ªÉ c·∫ßu c·ª©u</span>
                    <span class="lang-en" style="display:none;">Hold SOS button for 3 seconds to call for help</span>
                </div>
            </div>

            <!-- SOS Button with Progress Ring -->
            <div id="sos-btn-container" style="position: relative; width: 160px; height: 160px; margin-bottom: 30px;">
                <!-- Progress Ring (SVG) -->
                <svg id="sos-progress-ring"
                    style="position: absolute; top: 0; left: 0; width: 160px; height: 160px; transform: rotate(-90deg);">
                    <circle cx="80" cy="80" r="74" stroke="rgba(255,255,255,0.2)" stroke-width="8" fill="none" />
                    <circle id="sos-progress-circle" cx="80" cy="80" r="74" stroke="#ef4444" stroke-width="8"
                        fill="none" stroke-dasharray="465" stroke-dashoffset="465" stroke-linecap="round"
                        style="transition: stroke-dashoffset 0.1s linear;" />
                </svg>
                <!-- SOS Button -->
                <button id="sos-btn"
                    style="position: absolute; top: 8px; left: 8px; width: 144px; height: 144px; border-radius: 50%; background: linear-gradient(135deg, #ef4444, #dc2626); border: none; color: white; font-size: 48px; font-weight: 900; cursor: pointer; box-shadow: 0 0 30px rgba(239, 68, 68, 0.5); animation: pulse-sos 2s infinite;">
                    SOS
                </button>
            </div>

            <!-- Victim Info Panel (Hidden by default, shown after 3s hold) -->
            <div id="victim-info-panel"
                style="display: none; width: 100%; max-width: 380px; background: white; border-radius: 16px; padding: 20px; max-height: 60vh; overflow-y: auto;">
                <div style="text-align: center; margin-bottom: 16px;">
                    <div style="font-size: 48px; margin-bottom: 8px;">‚úÖ</div>
                    <div style="font-size: 18px; font-weight: 700; color: #16a34a;">
                        <span class="lang-vi">ƒê√É K√çCH HO·∫†T C·∫¶U C·ª®U!</span>
                        <span class="lang-en" style="display:none;">HELP ACTIVATED!</span>
                    </div>
                </div>

                <div
                    style="font-weight: 700; font-size: 15px; color: var(--gray-800); margin-bottom: 12px; border-bottom: 2px solid var(--gray-200); padding-bottom: 8px;">
                    <span class="lang-vi">üìã Th√¥ng tin n·∫°n nh√¢n</span>
                    <span class="lang-en" style="display:none;">üìã Victim Information</span>
                </div>

                <!-- Victim Details -->
                <div style="display: grid; gap: 10px; margin-bottom: 16px;">
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">üë§</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);"><span class="lang-vi">H·ªç
                                    t√™n</span><span class="lang-en" style="display:none;">Full name</span></div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--gray-800);">Nguy·ªÖn Tr·∫ßn Ti·∫øn
                                Ph√∫c</div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">ü™™</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);">CCCD</div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--gray-800);">012345678901</div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">üìç</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);"><span class="lang-vi">ƒê·ªãa
                                    ch·ªâ</span><span class="lang-en" style="display:none;">Address</span></div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--gray-800);">123 ƒê∆∞·ªùng 2 Th√°ng 4,
                                P. Vƒ©nh H·∫£i, TP. Nha Trang</div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">üìû</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);"><span class="lang-vi">SƒêT kh·∫©n
                                    c·∫•p</span><span class="lang-en" style="display:none;">Emergency phone</span></div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--gray-800);">0342 381 843</div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: linear-gradient(135deg, #fef2f2, #fee2e2); border-radius: 8px; border-left: 4px solid #dc2626;">
                        <span style="font-size: 18px;">ü©∏</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);"><span class="lang-vi">Nh√≥m
                                    m√°u</span><span class="lang-en" style="display:none;">Blood type</span></div>
                            <div style="font-size: 14px; font-weight: 700; color: #dc2626;">O+</div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <span style="font-size: 18px;">‚ö†Ô∏è</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);"><span class="lang-vi">B·ªánh
                                    n·ªÅn</span><span class="lang-en" style="display:none;">Pre-existing conditions</span>
                            </div>
                            <div style="font-size: 13px; font-weight: 600; color: #92400e;">Ti·ªÉu ƒë∆∞·ªùng type 2, Huy·∫øt √°p
                                cao</div>
                        </div>
                    </div>
                    <div
                        style="display: flex; gap: 10px; padding: 10px; background: linear-gradient(135deg, #fee2e2, #fecaca); border-radius: 8px; border-left: 4px solid #dc2626;">
                        <span style="font-size: 18px;">üö´</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);"><span class="lang-vi">D·ªã
                                    ·ª©ng</span><span class="lang-en" style="display:none;">Allergies</span></div>
                            <div style="font-size: 13px; font-weight: 600; color: #dc2626;">Penicillin, H·∫£i s·∫£n (t√¥m,
                                cua)</div>
                        </div>
                    </div>
                </div>

                <!-- GPS Location -->
                <div
                    style="padding: 12px; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 10px; margin-bottom: 16px;">
                    <div style="font-size: 12px; font-weight: 600; color: #1e40af; margin-bottom: 4px;">üìç <span
                            class="lang-vi">T·ªça ƒë·ªô GPS hi·ªán t·∫°i</span><span class="lang-en"
                            style="display:none;">Current GPS coordinates</span></div>
                    <div id="sos-gps-coords" style="font-size: 13px; color: #1e40af; font-family: monospace;">ƒêang l·∫•y
                        t·ªça ƒë·ªô...</div>
                </div>

                <!-- Quick SMS Button -->
                <button id="quick-sms-btn" onclick="sendEmergencySMS()"
                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #16a34a, #22c55e); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(22, 163, 74, 0.4);">
                    <span style="font-size: 24px;">üì±</span>
                    <span><span class="lang-vi">G·ª¨I SMS NHANH</span><span class="lang-en" style="display:none;">QUICK
                            SMS</span></span>
                </button>
            </div>
        </div>

        <style>
            @keyframes pulse-sos {

                0%,
                100% {
                    box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
                }

                50% {
                    box-shadow: 0 0 50px rgba(239, 68, 68, 0.8);
                }
            }
        </style>

        <!-- Register Screen -->
        <div class="screen" id="screen-register">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('login')">‚Üê</button>
                <h2>ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
            </div>
            <div style="text-align: center; padding: 16px 16px 8px;">
                <div class="logo-placeholder" style="margin: 0 auto 16px;">
                    <img src="https://i.postimg.cc/g0fMQWGQ/Anh-chup-man-hinh-2026-01-28-072615.png" alt="Logo">
                </div>
            </div>
            <div style="padding: 0 16px 16px;">
                <div class="form-group">
                    <label class="form-label">H·ªç v√† t√™n <span style="color: var(--red-500);">*</span></label>
                    <input type="text" id="reg-name" class="form-input" placeholder="Nguy·ªÖn VƒÉn A">
                </div>
                <div class="form-group">
                    <label class="form-label">Email <span style="color: var(--red-500);">*</span></label>
                    <input type="email" id="reg-email" class="form-input" placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">S·ªë ƒëi·ªán tho·∫°i <span style="color: var(--red-500);">*</span></label>
                    <input type="tel" id="reg-phone" class="form-input" placeholder="0912 345 678">
                </div>
                <div class="form-group">
                    <label class="form-label">M·∫≠t kh·∫©u <span style="color: var(--red-500);">*</span></label>
                    <input type="password" id="reg-password" class="form-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <button class="btn btn-primary" onclick="submitRegistration()">Ti·∫øp t·ª•c ‚Üí</button>
            </div>
        </div>

        <!-- Personal Info Screen (after registration) -->
        <div class="screen" id="screen-personal-info">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('register')">‚Üê</button>
                <h2>Th√¥ng tin c√° nh√¢n</h2>
            </div>
            <div style="text-align: center; padding: 16px;">
                <div style="font-size: 48px; margin-bottom: 8px;">üìã</div>
                <div style="font-size: 14px; color: var(--gray-600);">B·ªï sung th√¥ng tin ƒë·ªÉ ho√†n t·∫•t ƒëƒÉng k√Ω</div>
            </div>
            <div style="padding: 0 16px 16px;">
                <div class="form-group">
                    <label class="form-label">Ng√†y sinh</label>
                    <input type="date" id="personal-dob" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Gi·ªõi t√≠nh</label>
                    <select id="personal-gender" class="form-input">
                        <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
                        <option>Nam</option>
                        <option>N·ªØ</option>
                        <option>Kh√°c</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">S·ªë CCCD/CMND</label>
                    <input type="text" id="personal-cccd" class="form-input" placeholder="012345678901">
                </div>
                <div class="form-group">
                    <label class="form-label">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</label>
                    <textarea id="personal-address" class="form-input" rows="2"
                        placeholder="S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, t·ªânh/th√†nh ph·ªë"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Vai tr√≤ ƒëƒÉng k√Ω <span style="color: var(--red-500);">*</span></label>
                    <select id="personal-role" class="form-input">
                        <option>T√¨nh nguy·ªán vi√™n g·ªçi ƒëi·ªán</option>
                        <option>ƒêo√†n thi·ªán nguy·ªán</option>
                        <option>Nh√¢n vi√™n ph√°t qu√†</option>
                        <option>ƒêi·ªÅu ph·ªëi vi√™n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Kinh nghi·ªám t√¨nh nguy·ªán</label>
                    <textarea id="personal-exp" class="form-input" rows="2"
                        placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ kinh nghi·ªám (n·∫øu c√≥)"></textarea>
                </div>
                <button class="btn btn-primary" onclick="completeRegistration()">Ho√†n t·∫•t ƒëƒÉng k√Ω</button>
            </div>
        </div>

        <!-- VNeID Login Screen -->
        <div class="screen" id="screen-vneid">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('login')">‚Üê</button>
                <h2>ƒêƒÉng nh·∫≠p VNeID</h2>
            </div>
            <div style="text-align: center; padding: 24px;">
                <div
                    style="width: 80px; height: 80px; border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.15);">
                    <img src="https://cdn.tgdd.vn/2023/07/GameApp/vneid-200x200.jpg" alt="VNeID Logo"
                        style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <div style="font-size: 18px; font-weight: 700; color: #dc2626; margin-bottom: 4px;">VNeID</div>
                <div style="font-size: 12px; color: var(--gray-600);">ƒê·ªãnh danh ƒëi·ªán t·ª≠ Qu·ªëc gia</div>
            </div>

            <div style="padding: 0 16px;">
                <div class="form-group">
                    <label class="form-label">S·ªë CCCD <span style="color: var(--red-500);">*</span></label>
                    <input type="text" id="vneid-cccd" class="form-input" placeholder="012345678901" maxlength="12">
                </div>
                <div class="form-group">
                    <label class="form-label">M√£ b√≠ m·∫≠t VNeID <span style="color: var(--red-500);">*</span></label>
                    <input type="password" id="vneid-pin" class="form-input" placeholder="Nh·∫≠p m√£ PIN 6 s·ªë"
                        maxlength="6">
                </div>

                <p style="font-size: 11px; color: var(--gray-500); margin-bottom: 16px; line-height: 1.5;">
                    <span style="color: var(--red-500);">*</span> Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ ƒëƒÉng nh·∫≠p. T·∫•t c·∫£
                    c√°c tr∆∞·ªùng ƒë·ªÅu b·∫Øt bu·ªôc.
                </p>

                <button class="btn btn-primary" onclick="loginWithVNeID()"
                    style="background: linear-gradient(135deg, #dc2626, #ef4444);">
                    ü™™ X√°c th·ª±c VNeID
                </button>

                <div
                    style="margin-top: 16px; padding: 14px; background: linear-gradient(135deg, #fef2f2, #fee2e2); border-radius: 10px;">
                    <div style="font-weight: 600; font-size: 13px; color: #dc2626; margin-bottom: 8px;">üí° H∆∞·ªõng
                        d·∫´n</div>
                    <ul
                        style="font-size: 11px; color: var(--gray-600); padding-left: 16px; margin: 0; line-height: 1.6;">
                        <li>S·ªë CCCD g·ªìm 12 ch·ªØ s·ªë tr√™n th·∫ª cƒÉn c∆∞·ªõc</li>
                        <li>M√£ PIN l√† m√£ 6 s·ªë b·∫°n ƒë√£ ƒëƒÉng k√Ω tr√™n ·ª©ng d·ª•ng VNeID</li>
                        <li>Th√¥ng tin ƒë∆∞·ª£c x√°c th·ª±c qua h·ªá th·ªëng C∆° s·ªü d·ªØ li·ªáu Qu·ªëc gia</li>
                    </ul>
                </div>

                <!-- Demo notice -->
                <div
                    style="margin-top: 12px; padding: 10px; background: var(--yellow-100); border: 1px dashed var(--yellow-500); border-radius: 8px; text-align: center;">
                    <span style="font-size: 11px; color: var(--yellow-700);">‚ö†Ô∏è B·∫£n Demo - Nh·∫≠p b·∫•t k·ª≥ th√¥ng tin n√†o ƒë·ªÉ
                        ti·∫øp t·ª•c</span>
                </div>
            </div>
        </div>

        <!-- Profile Screen -->
        <div class="screen" id="screen-profile">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('home')">‚Üê</button>
                <h2>H·ªì s∆° c√° nh√¢n</h2>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div
                    style="width: 90px; height: 90px; background: linear-gradient(135deg, var(--green-500), var(--green-600)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3);">
                    <span style="font-size: 40px;">üë§</span>
                </div>
                <div style="font-size: 20px; font-weight: 700; color: var(--gray-800);">Nguy·ªÖn VƒÉn A</div>
                <div style="font-size: 13px; color: var(--gray-500);">T√¨nh nguy·ªán vi√™n</div>
            </div>

            <div style="padding: 0 16px;">
                <!-- Personal Info Card -->
                <div
                    style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="font-weight: 600; font-size: 14px; color: var(--gray-800); margin-bottom: 12px;">üìã
                        Th√¥ng tin c√° nh√¢n</div>

                    <div
                        style="display: flex; gap: 12px; margin-bottom: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">üìç</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);">ƒê·ªãa ch·ªâ</div>
                            <div style="font-size: 13px; color: var(--gray-800);">123 ƒê∆∞·ªùng 2 Th√°ng 4, P. Vƒ©nh H·∫£i, TP.
                                Nha Trang</div>
                        </div>
                    </div>

                    <div
                        style="display: flex; gap: 12px; margin-bottom: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">üìû</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);">S·ªë ƒëi·ªán tho·∫°i</div>
                            <div style="font-size: 13px; color: var(--gray-800);">0912 345 678</div>
                        </div>
                    </div>

                    <div
                        style="display: flex; gap: 12px; margin-bottom: 10px; padding: 10px; background: var(--gray-50); border-radius: 8px;">
                        <span style="font-size: 18px;">‚úâÔ∏è</span>
                        <div>
                            <div style="font-size: 11px; color: var(--gray-500);">Email</div>
                            <div style="font-size: 13px; color: var(--gray-800);">volunteer@relief.vn</div>
                        </div>
                    </div>
                </div>

                <!-- Emergency Contact Card -->
                <div
                    style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="font-weight: 600; font-size: 14px; color: var(--gray-800); margin-bottom: 12px;">üìû
                        Li√™n h·ªá ng∆∞·ªùi th√¢n kh·∫©n c·∫•p</div>

                    <!-- Contact 1 -->
                    <div
                        style="display: flex; gap: 12px; padding: 12px; background: linear-gradient(135deg, #fef2f2, #fee2e2); border-radius: 10px; margin-bottom: 10px; align-items: center;">
                        <div
                            style="width: 42px; height: 42px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 20px;">üë©</span>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--gray-800);">Tr·∫ßn Th·ªã H∆∞∆°ng</div>
                            <div style="font-size: 11px; color: var(--red-600);">M·∫π</div>
                        </div>
                        <a href="tel:0912111222"
                            style="background: var(--red-500); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; text-decoration: none;">
                            üìû G·ªçi
                        </a>
                    </div>

                    <!-- Contact 2 -->
                    <div
                        style="display: flex; gap: 12px; padding: 12px; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 10px; margin-bottom: 10px; align-items: center;">
                        <div
                            style="width: 42px; height: 42px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 20px;">üë®</span>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--gray-800);">Nguy·ªÖn VƒÉn B</div>
                            <div style="font-size: 11px; color: var(--blue-500);">Anh trai</div>
                        </div>
                        <a href="tel:0912333444"
                            style="background: var(--blue-500); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; text-decoration: none;">
                            üìû G·ªçi
                        </a>
                    </div>

                    <!-- Contact 3 -->
                    <div
                        style="display: flex; gap: 12px; padding: 12px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 10px; align-items: center;">
                        <div
                            style="width: 42px; height: 42px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 20px;">üë¥</span>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--gray-800);">L√™ VƒÉn T√¢m</div>
                            <div style="font-size: 11px; color: var(--green-600);">Ch√∫</div>
                        </div>
                        <a href="tel:0912555666"
                            style="background: var(--green-600); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; text-decoration: none;">
                            üìû G·ªçi
                        </a>
                    </div>
                </div>

                <!-- Health Info Card -->
                <div
                    style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="font-weight: 600; font-size: 14px; color: var(--gray-800); margin-bottom: 12px;">üè•
                        Th√¥ng tin y t·∫ø</div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div
                            style="padding: 12px; background: linear-gradient(135deg, #fef2f2, #fee2e2); border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 4px;">ü©∏</div>
                            <div style="font-size: 10px; color: var(--gray-500);">Nh√≥m m√°u</div>
                            <div style="font-size: 16px; font-weight: 700; color: #dc2626;">O+</div>
                        </div>
                        <div
                            style="padding: 12px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 4px;">‚öñÔ∏è</div>
                            <div style="font-size: 10px; color: var(--gray-500);">C√¢n n·∫∑ng</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--green-600);">65 kg</div>
                        </div>
                    </div>

                    <!-- Pre-existing conditions -->
                    <div
                        style="margin-top: 12px; padding: 12px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <div style="font-size: 12px; font-weight: 600; color: #92400e; margin-bottom: 6px;">‚ö†Ô∏è B·ªánh n·ªÅn
                        </div>
                        <ul style="font-size: 12px; color: #78350f; padding-left: 16px; margin: 0; line-height: 1.6;">
                            <li>Ti·ªÉu ƒë∆∞·ªùng type 2 (ƒëang ƒëi·ªÅu tr·ªã)</li>
                            <li>Huy·∫øt √°p cao nh·∫π</li>
                        </ul>
                    </div>

                    <!-- Medical history -->
                    <div style="margin-top: 10px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <div style="font-size: 11px; color: var(--gray-500); margin-bottom: 4px;">üìã Ti·ªÅn s·ª≠ b·ªánh</div>
                        <div style="font-size: 12px; color: var(--gray-700); line-height: 1.5;">
                            Ph·∫´u thu·∫≠t ru·ªôt th·ª´a (2018)<br>
                            Vi√™m ph·ªïi n·∫∑ng (2020)
                        </div>
                    </div>

                    <!-- Allergies -->
                    <div
                        style="margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #fee2e2, #fecaca); border-radius: 8px; border-left: 4px solid var(--red-500);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--red-700); margin-bottom: 4px;">üö´ D·ªã
                            ·ª©ng</div>
                        <div style="font-size: 12px; color: var(--red-600);">
                            ‚Ä¢ Penicillin<br>
                            ‚Ä¢ H·∫£i s·∫£n (t√¥m, cua)
                        </div>
                    </div>

                    <!-- Current medications -->
                    <div
                        style="margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 8px;">
                        <div style="font-size: 12px; font-weight: 600; color: #1e40af; margin-bottom: 4px;">üíä Thu·ªëc
                            ƒëang d√πng</div>
                        <div style="font-size: 12px; color: #1e40af;">
                            ‚Ä¢ Metformin 500mg (2 l·∫ßn/ng√†y)<br>
                            ‚Ä¢ Amlodipine 5mg (bu·ªïi s√°ng)
                        </div>
                    </div>
                </div>

                <!-- QR Code Section -->
                <div
                    style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); text-align: center;">
                    <div style="font-weight: 600; font-size: 14px; color: var(--gray-800); margin-bottom: 12px;">üì± M√£
                        QR ƒë·ªãnh danh</div>
                    <div id="profile-qr-code"
                        style="width: 150px; height: 150px; background: white; border: 2px dashed var(--gray-300); border-radius: 12px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 48px;">üì±</div>
                            <div style="font-size: 10px; color: var(--gray-500); margin-top: 4px;">QR Code</div>
                        </div>
                    </div>
                    <p style="font-size: 11px; color: var(--gray-500);">Qu√©t m√£ ƒë·ªÉ x√°c minh danh t√≠nh khi nh·∫≠n h·ªó tr·ª£
                        c·ª©u tr·ª£</p>
                </div>

                <!-- Action Buttons -->
                <button class="btn btn-primary" onclick="showToast('‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin!')"
                    style="margin-bottom: 8px;">
                    üìù Ch·ªânh s·ª≠a th√¥ng tin
                </button>
                <button class="btn" onclick="showScreen('login')"
                    style="background: var(--gray-100); color: var(--gray-700);">
                    üö™ ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>

        <!-- Home Screen -->
        <div class="screen" id="screen-home">
            <div class="header">
                <!-- Logo and Account icon - horizontally aligned -->
                <div style="position: relative; height: 44px; display: flex; align-items: center;">
                    <!-- Logo - centered absolute & scaled down 75% -->
                    <div class="logo-placeholder" id="logo-container"
                        style="margin: 0; margin-top: 10px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%) scale(0.75);">
                        <img src="https://i.postimg.cc/g0fMQWGQ/Anh-chup-man-hinh-2026-01-28-072615.png" alt="Logo">
                    </div>
                    <!-- Account icon - absolute right -->
                    <button onclick="showScreen('profile')"
                        style="position: absolute; right: 0; width: 44px; height: 44px; border-radius: 50%; background: white; border: 2px solid var(--green-500); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <span style="font-size: 22px;">üë§</span>
                    </button>
                </div>
            </div>


            <!-- Compact Workflow Grid -->
            <div class="card" id="main-workflow-container" style="padding: 12px;">
                <div class="workflow-grid-compact">
                    <button class="workflow-btn-compact verify" onclick="showScreen('verify')">
                        <span class="icon">üìû</span>
                        <span class="text">X√°c minh</span>
                    </button>
                    <button class="workflow-btn-compact map" onclick="showScreen('map')">
                        <span class="icon">üó∫Ô∏è</span>
                        <span class="text">B·∫£n ƒë·ªì</span>
                    </button>
                    <button class="workflow-btn-compact id" onclick="showScreen('identify')">
                        <span class="icon">ü™™</span>
                        <span class="text">ƒê·ªãnh danh</span>
                    </button>
                    <button class="workflow-btn-compact register" onclick="showScreen('volunteer-register')">
                        <span class="icon">üöõ</span>
                        <span class="text">ƒêƒÉng k√Ω</span>
                    </button>
                    <button class="workflow-btn-compact cases" onclick="showScreen('case-list')">
                        <span class="icon">üîç</span>
                        <span class="text">Tra c·ª©u</span>
                    </button>
                </div>
            </div>

            <!-- Notification Bell & Video Recording Section -->
            <div style="display: flex; gap: 8px; padding: 0 16px; margin-bottom: 12px;">
                <!-- Video Recording Button -->
                <button onclick="openVideoRecording()"
                    style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; background: linear-gradient(135deg, #dc2626, #ef4444); border: none; border-radius: 12px; color: white; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
                    <span style="font-size: 22px;">üìπ</span>
                    <span>Quay video hi·ªán tr·∫°ng</span>
                </button>

                <!-- Notification Bell -->
                <button onclick="openNotificationPanel()"
                    style="position: relative; width: 56px; display: flex; align-items: center; justify-content: center; background: white; border: 2px solid var(--green-500); border-radius: 12px; cursor: pointer;">
                    <span style="font-size: 24px;">üîî</span>
                    <span id="notification-badge"
                        style="position: absolute; top: -4px; right: -4px; background: var(--red-500); color: white; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 10px; min-width: 18px; text-align: center;">3</span>
                </button>
            </div>

            <!-- Doctor Call Section - Separate from convoys -->
            <div class="doctor-call-section">
                <div class="doctor-call-header">
                    <span style="font-size: 24px;">üè•</span>
                    <span class="doctor-call-title">H·ªó tr·ª£ Y t·∫ø & V·∫≠t d·ª•ng Kh·∫©n c·∫•p</span>
                </div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">Li√™n h·ªá b√°c sƒ©, b√°o c√°o tri·ªáu
                    ch·ª©ng/y√™u c·∫ßu v·∫≠t d·ª•ng thi·∫øt y·∫øu</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                    <a href="tel:0912345678" class="doctor-btn call" style="padding: 10px;">
                        <span class="btn-icon" style="font-size: 20px;">üìû</span>
                        <span style="font-size: 11px;">G·ªçi B√°c sƒ©</span>
                    </a>
                    <button class="doctor-btn symptoms" onclick="openSymptomModal()" style="padding: 10px;">
                        <span class="btn-icon" style="font-size: 20px;">ü©∫</span>
                        <span style="font-size: 11px;">Tri·ªáu ch·ª©ng</span>
                    </button>
                    <button class="doctor-btn symptoms" onclick="openItemsModal()" style="padding: 10px;">
                        <span class="btn-icon" style="font-size: 20px;">üì¶</span>
                        <span style="font-size: 11px;">V·∫≠t d·ª•ng</span>
                    </button>
                </div>

                <!-- Address and Phone Input -->
                <!-- Address and Phone Input REMOVED - Using Auto GPS or Video Location -->
                <!-- Location Tracking Section -->
                <div
                    style="background: #eff6ff; border-radius: 8px; padding: 10px; margin: 10px 0; border: 1px dashed var(--blue-400);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                        <span style="font-size: 12px; font-weight: 600; color: var(--blue-700);">üìç V·ªã tr√≠ hi·ªán t·∫°i c·ªßa
                            b·∫°n:</span>
                        <button onclick="refreshHomeLocation()"
                            style="border: none; background: none; color: var(--blue-600); font-weight: 700; font-size: 11px; cursor: pointer; text-decoration: underline;">üîÑ
                            L·∫•y l·∫°i v·ªã tr√≠</button>
                    </div>
                    <div id="home-location-text"
                        style="font-size: 13px; color: var(--gray-800); font-weight: 500; min-height: 20px;">ƒêang l·∫•y v·ªã
                        tr√≠...</div>
                    <div style="font-size: 10px; color: var(--gray-500); margin-top: 4px;">(T·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 1 ph√∫t)
                    </div>
                </div>

                <div style="margin-top: 12px;">
                    <button class="btn btn-danger" onclick="sendEmergencyRequest()"
                        style="padding: 10px; font-size: 13px; width: 100%;">
                        üÜò G·ª≠i y√™u c·∫ßu h·ªó tr·ª£ kh·∫©n c·∫•p (K√®m ƒë·ªãnh v·ªã)
                    </button>
                    <div id="emergency-gps-status"
                        style="font-size: 11px; color: var(--gray-500); text-align: center; margin-top: 6px;">
                        ‚ö†Ô∏è S·∫Ω t·ª± ƒë·ªông l·∫•y v·ªã tr√≠ khi g·ª≠i
                    </div>
                </div>
            </div>

            <!-- Hydroelectric Dam Notification Section -->
            <div class="section-header" onclick="toggleSection('dam-section')"
                style="background: linear-gradient(135deg, #1e40af, #3b82f6);">
                <span class="section-title" style="margin: 0; color: white;">‚ö° Th√¥ng b√°o Th·ªßy ƒëi·ªán</span>
                <span class="section-toggle" id="dam-section-toggle" style="color: white;">‚ñº</span>
            </div>
            <div id="dam-section" class="collapsible-section">
                <!-- Critical Dam Alert -->
                <div
                    style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 2px solid var(--red-500); border-radius: 12px; padding: 14px; margin: 8px 0;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 24px;">üö®</span>
                            <div>
                                <div style="font-weight: 700; font-size: 14px; color: var(--red-700);">Th·ªßy ƒëi·ªán S√¥ng
                                    C√°i</div>
                                <div style="font-size: 11px; color: var(--red-600);">Kh√°nh H√≤a</div>
                            </div>
                        </div>
                        <div
                            style="background: var(--red-500); color: white; padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 700; animation: pulse 2s infinite;">
                            üî¥ ƒêANG X·∫¢
                        </div>
                    </div>
                    <div style="background: white; border-radius: 8px; padding: 10px; margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                            <div>
                                <span style="color: var(--gray-500);">M·ª±c n∆∞·ªõc h·ªì:</span>
                                <span style="font-weight: 600; color: var(--red-600);">98.5m (cao)</span>
                            </div>
                            <div>
                                <span style="color: var(--gray-500);">L∆∞u l∆∞·ª£ng x·∫£:</span>
                                <span style="font-weight: 600; color: var(--red-600);">1,500 m¬≥/s</span>
                            </div>
                            <div>
                                <span style="color: var(--gray-500);">B·∫Øt ƒë·∫ßu x·∫£:</span>
                                <span style="font-weight: 600;">08:00 - 30/01</span>
                            </div>
                            <div>
                                <span style="color: var(--gray-500);">D·ª± ki·∫øn k·∫øt th√∫c:</span>
                                <span style="font-weight: 600;">18:00 - 30/01</span>
                            </div>
                        </div>
                    </div>
                    <div style="background: var(--red-100); border-radius: 6px; padding: 8px; margin-bottom: 10px;">
                        <div style="font-size: 12px; color: var(--red-700); font-weight: 600;">‚ö†Ô∏è C·∫¢NH B√ÅO:</div>
                        <div style="font-size: 11px; color: var(--red-600); margin-top: 4px;">Ng∆∞·ªùi d√¢n v√πng h·∫° du s√¥ng
                            C√°i c·∫ßn di chuy·ªÉn ƒë·∫øn n∆°i an to√†n. M·ª±c n∆∞·ªõc c√≥ th·ªÉ d√¢ng cao 1.5-2m trong 2-4 gi·ªù t·ªõi.</div>
                    </div>
                    <div
                        style="display: flex; align-items: center; gap: 6px; padding: 8px; background: var(--green-50); border: 1px solid var(--green-400); border-radius: 6px;">
                        <span style="font-size: 14px;">‚úÖ</span>
                        <div style="flex: 1;">
                            <div style="font-size: 11px; color: var(--green-700); font-weight: 600;">ƒê√£ x√°c th·ª±c b·ªüi
                                Ch√≠nh quy·ªÅn</div>
                            <div style="font-size: 10px; color: var(--green-600);">Ban Ch·ªâ huy PCTT t·ªânh Kh√°nh H√≤a ‚Ä¢
                                07:45 30/01/2026</div>
                        </div>
                    </div>
                </div>

                <!-- Normal Dam Status -->
                <div
                    style="background: white; border: 1px solid var(--gray-200); border-radius: 12px; padding: 14px; margin: 8px 0;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">üíß</span>
                            <div>
                                <div style="font-weight: 600; font-size: 13px; color: var(--gray-800);">Th·ªßy ƒëi·ªán Ea
                                    Kr√¥ng Rou</div>
                                <div style="font-size: 11px; color: var(--gray-500);">Kh√°nh H√≤a</div>
                            </div>
                        </div>
                        <div
                            style="background: var(--green-100); color: var(--green-700); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                            üü¢ B√åNH TH∆Ø·ªúNG
                        </div>
                    </div>
                    <div
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; font-size: 11px; color: var(--gray-600);">
                        <div>M·ª±c n∆∞·ªõc: <span style="font-weight: 600; color: var(--gray-800);">72.3m</span></div>
                        <div>Dung t√≠ch: <span style="font-weight: 600; color: var(--gray-800);">65%</span></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px; margin-top: 8px;">
                        <span style="font-size: 12px;">‚úÖ</span>
                        <span style="font-size: 10px; color: var(--green-600);">X√°c th·ª±c: S·ªü NN&PTNT ‚Ä¢ 07:30
                            30/01</span>
                    </div>
                </div>

                <!-- Warning Dam Status -->
                <div
                    style="background: linear-gradient(135deg, #fffbeb, #fef3c7); border: 2px solid var(--yellow-500); border-radius: 12px; padding: 14px; margin: 8px 0;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">‚ö†Ô∏è</span>
                            <div>
                                <div style="font-weight: 600; font-size: 13px; color: var(--yellow-800);">Th·ªßy ƒëi·ªán S√¥ng
                                    Hinh</div>
                                <div style="font-size: 11px; color: var(--yellow-600);">Ph√∫ Y√™n (l√¢n c·∫≠n)</div>
                            </div>
                        </div>
                        <div
                            style="background: var(--yellow-500); color: white; padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                            üü° S·∫ÆP X·∫¢
                        </div>
                    </div>
                    <div
                        style="background: white; border-radius: 6px; padding: 8px; font-size: 11px; color: var(--yellow-700);">
                        <div style="font-weight: 600;">üì¢ D·ª± ki·∫øn x·∫£ l√∫c 14:00 ng√†y 30/01/2026</div>
                        <div style="margin-top: 4px;">L∆∞u l∆∞·ª£ng d·ª± ki·∫øn: 800-1,000 m¬≥/s</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px; margin-top: 8px;">
                        <span style="font-size: 12px;">‚úÖ</span>
                        <span style="font-size: 10px; color: var(--green-600);">X√°c th·ª±c: UBND t·ªânh Ph√∫ Y√™n ‚Ä¢ 06:00
                            30/01</span>
                    </div>
                </div>

                <div class="see-more-btn" onclick="showToast('ƒêang t·∫£i th√™m th√¥ng tin th·ªßy ƒëi·ªán...')">Xem t·∫•t c·∫£ th√¥ng
                    b√°o th·ªßy ƒëi·ªán ‚Üí</div>
            </div>

            <!-- Rescue Teams Arriving - MOVED UP & ADDED CONTACT -->
            <div class="section-header" onclick="toggleSection('rescue-section')">
                <span class="section-title" style="margin: 0;">üö® ƒêo√†n c·ª©u h·ªô ƒëang ƒë·∫øn</span>
                <span class="section-toggle" id="rescue-section-toggle">‚ñº</span>
            </div>
            <div id="rescue-section" class="collapsible-section">
                <!-- Rescue Team 1 -->
                <div class="convoy-card"
                    style="border-left: 4px solid var(--red-500); background: linear-gradient(135deg, #fef2f2, #fee2e2);">
                    <div class="convoy-header">
                        <div class="convoy-name" style="color: var(--red-700);">üöí ƒê·ªôi PCCC Kh√°nh H√≤a</div>
                        <div class="convoy-badge" style="background: var(--red-500); color: white;">üö® KH·∫®N C·∫§P</div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-600); margin: 6px 0;">
                        üìç ƒêang h∆∞·ªõng ƒë·∫øn: P. Vƒ©nh H·∫£i - Khu v·ª±c ng·∫≠p n·∫∑ng
                    </div>
                    <div class="convoy-details">
                        <span>üöí 3 xe c·ª©u h·ªô</span>
                        <span>üë• 25 ng∆∞·ªùi</span>
                        <span>üõü Thi·∫øt b·ªã c·ª©u h·ªô</span>
                    </div>
                    <div class="convoy-eta" style="color: var(--red-600);">‚è±Ô∏è D·ª± ki·∫øn ƒë·∫øn: 15 ph√∫t</div>
                    <!-- Contact Button Added -->
                    <div style="margin-top: 10px;">
                        <a href="tel:114" class="btn"
                            style="background: var(--red-600); color: white; padding: 8px 16px; text-decoration: none; font-size: 11px; display: block; text-align: center;">
                            üìû Li√™n h·ªá c·ª©u h·ªô
                        </a>
                    </div>
                </div>

                <!-- Rescue Team 2 -->
                <div class="convoy-card"
                    style="border-left: 4px solid var(--yellow-500); background: linear-gradient(135deg, #fffbeb, #fef3c7);">

                    <div class="convoy-header">
                        <div class="convoy-name" style="color: var(--yellow-800);">üöë ƒê·ªôi Y T·∫ø C·ª©u H·ªô</div>
                        <div class="convoy-badge" style="background: var(--yellow-500); color: black;">üè• Y T·∫æ</div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-600); margin: 6px 0;">
                        üìç ƒêang h∆∞·ªõng ƒë·∫øn: P. L·ªôc Th·ªç - H·ªó tr·ª£ y t·∫ø
                    </div>
                    <div class="convoy-details">
                        <span>üöë 2 xe c·ª©u th∆∞∆°ng</span>
                        <span>üë®‚Äç‚öïÔ∏è 8 b√°c sƒ©</span>
                        <span>üíä Thu·ªëc & v·∫≠t t∆∞</span>
                    </div>
                    <div class="convoy-eta">‚è±Ô∏è D·ª± ki·∫øn ƒë·∫øn: 25 ph√∫t</div>
                    <!-- Contact Button Added -->
                    <div style="margin-top: 10px;">
                        <a href="tel:115" class="btn"
                            style="background: var(--yellow-500); color: black; border: 2px solid var(--yellow-600); padding: 8px 16px; text-decoration: none; font-size: 11px; display: block; text-align: center; font-weight: 600;">
                            üìû Li√™n h·ªá Y t·∫ø
                        </a>
                    </div>
                </div>
                <div class="see-more-btn" onclick="showToast('ƒêang t·∫£i th√™m th√¥ng tin ƒëo√†n c·ª©u h·ªô...')">Xem t·∫•t c·∫£ ƒëo√†n
                    c·ª©u h·ªô ‚Üí</div>
            </div>

            <!-- Volunteer Convoys - MERGED & REMOVED CONTACT -->
            <div class="section-header" onclick="toggleSection('convoy-section')">
                <span class="section-title" style="margin: 0;">üöõ ƒêo√†n thi·ªán nguy·ªán (ƒê√£ ƒë·∫øn & ƒêang ƒë·∫øn)</span>
                <span class="section-toggle" id="convoy-section-toggle">‚ñº</span>
            </div>
            <div id="convoy-section" class="collapsible-section">
                <!-- Nearest convoy - Arrived -->
                <div class="convoy-card"
                    style="border-left: 5px solid var(--green-500); background: linear-gradient(135deg, #f0fdf4, #dcfce7);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <span style="font-size: 20px;">üìç</span>
                                <span
                                    style="font-size: 10px; background: var(--green-500); color: white; padding: 3px 8px; border-radius: 10px; font-weight: 600;">G·∫¶N
                                    B·∫†N NH·∫§T</span>
                            </div>
                            <div class="convoy-name" style="font-size: 14px;">ƒêo√†n TP.HCM - Nha Trang #1</div>
                            <div class="convoy-badge"
                                style="background: var(--green-500); color: white; display: inline-block; margin-top: 4px;">
                                ‚úÖ ƒê√É ƒê·∫æN</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--gray-800); margin-bottom: 4px;">üìç
                            ƒê·ªãa
                            ƒëi·ªÉm ph√°t qu√†:</div>
                        <div style="font-size: 13px; color: var(--gray-700);">S·ªë 45, ƒê∆∞·ªùng Tr·∫ßn Ph√∫, Ph∆∞·ªùng L·ªôc Th·ªç, TP.
                            Nha
                            Trang, Kh√°nh H√≤a</div>
                    </div>
                    <div class="convoy-details" style="margin-top: 10px;">
                        <span>üë• 15 ng∆∞·ªùi</span>
                        <span>üì¶ 200 ph·∫ßn qu√†</span>
                        <span>üïê ƒê√£ ƒë·∫øn 15 ph√∫t tr∆∞·ªõc</span>
                    </div>
                    <!-- Contact Button REMOVED -->
                </div>

                <!-- Second arrived convoy -->
                <div class="convoy-card" style="border-left-color: var(--green-500);">
                    <div class="convoy-header">
                        <div class="convoy-name">ƒêo√†n H√† N·ªôi - Nha Trang #2</div>
                        <div class="convoy-badge" style="background: var(--green-500); color: white;">‚úÖ ƒê√É ƒê·∫æN</div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-600); margin: 6px 0;">
                        üìç S·ªë 78, ƒê∆∞·ªùng Yersin, Ph∆∞·ªùng Vƒ©nh Nguy√™n, TP. Nha Trang, Kh√°nh H√≤a
                    </div>
                    <div class="convoy-details">
                        <span>üë• 20 ng∆∞·ªùi</span>
                        <span>üì¶ 300 ph·∫ßn qu√†</span>
                        <span>üïê ƒê√£ ƒë·∫øn 45 ph√∫t tr∆∞·ªõc</span>
                    </div>
                    <!-- Contact Button REMOVED -->
                </div>

                <!-- Moving convoy 1 -->
                <div class="convoy-card" style="border-left-color: var(--yellow-500);">
                    <div class="convoy-header">
                        <div class="convoy-name">ƒêo√†n ƒê√† N·∫µng - Nha Trang #3</div>
                        <div class="convoy-badge enroute" style="background: var(--yellow-500);">üöö ƒêANG DI CHUY·ªÇN</div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-600); margin: 6px 0;">
                        üìç ƒêang h∆∞·ªõng ƒë·∫øn: S·ªë 123, ƒê∆∞·ªùng 2 Th√°ng 4, Ph∆∞·ªùng Vƒ©nh H·∫£i, TP. Nha Trang
                    </div>
                    <div class="convoy-details">
                        <span>üë• 12 ng∆∞·ªùi</span>
                        <span>üì¶ 150 ph·∫ßn qu√†</span>
                    </div>
                    <div class="convoy-eta" style="color: var(--yellow-700);">‚è±Ô∏è D·ª± ki·∫øn ƒë·∫øn: 30 ph√∫t</div>
                    <!-- Contact Button REMOVED -->
                </div>

                <!-- Moving convoy 2 -->
                <div class="convoy-card" style="border-left-color: var(--blue-500);">
                    <div class="convoy-header">
                        <div class="convoy-name">ƒêo√†n C·∫ßn Th∆° - Nha Trang #4</div>
                        <div class="convoy-badge enroute">üöö ƒêANG DI CHUY·ªÇN</div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-600); margin: 6px 0;">
                        üìç ƒêang h∆∞·ªõng ƒë·∫øn: P. Ph∆∞·ªõc H·∫£i
                    </div>
                    <div class="convoy-details">
                        <span>üë• 18 ng∆∞·ªùi</span>
                        <span>üì¶ 250 ph·∫ßn qu√†</span>
                        <span>üíä Thu·ªëc y t·∫ø</span>
                    </div>
                    <div class="convoy-eta">‚è±Ô∏è D·ª± ki·∫øn ƒë·∫øn: 1 gi·ªù 30 ph√∫t</div>
                    <!-- Contact Button REMOVED -->
                </div>

                <div class="see-more-btn" onclick="showToast('ƒêang t·∫£i th√™m th√¥ng tin ƒëo√†n thi·ªán nguy·ªán...')">Xem t·∫•t c·∫£
                    ƒëo√†n thi·ªán nguy·ªán ‚Üí</div>
            </div>

            <!-- News and Announcements Section - Collapsible -->
            <div class="section-header" onclick="toggleSection('news-section')">
                <span class="section-title" style="margin: 0;">üì¢ Tin t·ª©c & Th√¥ng b√°o</span>
                <span class="section-toggle" id="news-section-toggle">‚ñº</span>
            </div>
            <div id="news-section" class="collapsible-section">
                <div class="news-card">
                    <div class="news-icon alert">üö®</div>
                    <div class="news-content">
                        <div class="news-title">C·∫£nh b√°o: M∆∞a l·ªõn ti·∫øp t·ª•c t·∫°i Y√™n B√°i</div>
                        <div class="news-desc">D·ª± b√°o m∆∞a l·ªõn 100-200mm trong 24h t·ªõi. Ng∆∞·ªùi d√¢n c·∫ßn di chuy·ªÉn ƒë·∫øn n∆°i
                            an
                            to√†n.</div>
                        <div class="news-time">‚è∞ 30 ph√∫t tr∆∞·ªõc</div>
                    </div>
                </div>
                <div class="news-card">
                    <div class="news-icon success">‚úÖ</div>
                    <div class="news-content">
                        <div class="news-title">ƒêo√†n c·ª©u tr·ª£ H√† N·ªôi ƒë√£ ƒë·∫øn X√£ Th∆∞·ª£ng</div>
                        <div class="news-desc">Ph√°t 500 ph·∫ßn qu√† cho b√† con v√πng l≈©. Ti·∫øp t·ª•c di chuy·ªÉn ƒë·∫øn X√£ H·∫°.</div>
                        <div class="news-time">‚è∞ 1 gi·ªù tr∆∞·ªõc</div>
                    </div>
                </div>
                <div class="news-card">
                    <div class="news-icon warning">‚ö†Ô∏è</div>
                    <div class="news-content">
                        <div class="news-title">Khu v·ª±c X√£ ƒê√¥ng ƒëang thi·∫øu thu·ªëc y t·∫ø</div>
                        <div class="news-desc">C·∫ßn c√°c ƒëo√†n c√≥ thu·ªëc kh√°ng sinh, thu·ªëc ti√™u ch·∫£y ∆∞u ti√™n h∆∞·ªõng ƒë·∫øn khu
                            v·ª±c
                            n√†y.</div>
                        <div class="news-time">‚è∞ 2 gi·ªù tr∆∞·ªõc</div>
                    </div>
                </div>
                <div class="see-more-btn" onclick="showToast('ƒêang t·∫£i th√™m tin t·ª©c...')">Xem th√™m tin t·ª©c ‚Üí</div>
            </div>

            <!-- Survival Tips Section - Collapsible -->
            <div class="section-header" onclick="toggleSection('tips-section')">
                <span class="section-title" style="margin: 0;">üí° M·∫πo sinh t·ªìn khi b√£o l≈©</span>
                <span class="section-toggle" id="tips-section-toggle">‚ñº</span>
            </div>
            <div id="tips-section" class="collapsible-section">
                <div class="tip-card">
                    <div class="tip-header">
                        <span>üåä</span> Khi n∆∞·ªõc l≈© d√¢ng cao
                    </div>
                    <div class="tip-content">
                        <ul>
                            <li>Di chuy·ªÉn l√™n t·∫ßng cao ho·∫∑c n√≥c nh√†</li>
                            <li>Mang theo n∆∞·ªõc s·∫°ch v√† ƒë√®n pin</li>
                            <li>Kh√¥ng c·ªë b∆°i qua d√≤ng n∆∞·ªõc ch·∫£y xi·∫øt</li>
                            <li>G·ªçi c·ª©u h·ªô: <b>113 ho·∫∑c 114</b></li>
                        </ul>
                    </div>
                </div>
                <div class="tip-card" style="background: linear-gradient(135deg, #f97316, #ea580c);">
                    <div class="tip-header">
                        <span>‚ö°</span> An to√†n ƒëi·ªán trong m∆∞a b√£o
                    </div>
                    <div class="tip-content">
                        <ul>
                            <li>Ng·∫Øt c·∫ßu dao ƒëi·ªán khi n∆∞·ªõc v√†o nh√†</li>
                            <li>Kh√¥ng ch·∫°m v√†o thi·∫øt b·ªã ƒëi·ªán khi tay ∆∞·ªõt</li>
                            <li>Tr√°nh xa c·ªôt ƒëi·ªán, d√¢y ƒëi·ªán ƒë·ª©t</li>
                            <li>Kh√¥ng s·ª≠ d·ª•ng ƒëi·ªán tho·∫°i khi ƒëang s·∫°c</li>
                        </ul>
                    </div>
                </div>
                <div class="tip-card" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                    <div class="tip-header">
                        <span>üè•</span> S∆° c·ª©u & Y t·∫ø c∆° b·∫£n
                    </div>
                    <div class="tip-content">
                        <ul>
                            <li>U·ªëng n∆∞·ªõc ƒë√£ ƒëun s√¥i ƒë·ªÉ tr√°nh b·ªánh ti√™u h√≥a</li>
                            <li>R·ª≠a tay th∆∞·ªùng xuy√™n v·ªõi x√† ph√≤ng</li>
                            <li>X·ª≠ l√Ω v·∫øt th∆∞∆°ng b·∫±ng c·ªìn 70 ƒë·ªô</li>
                            <li>ƒê∆∞a ng∆∞·ªùi b·ªã h·∫° th√¢n nhi·ªát v√†o ch·ªó ·∫•m</li>
                        </ul>
                    </div>
                </div>
                <div class="see-more-btn" onclick="showToast('ƒêang t·∫£i th√™m m·∫πo...')">Xem th√™m m·∫πo sinh t·ªìn ‚Üí</div>
            </div>
        </div>

        <!-- Symptom Selection Modal -->
        <div class="symptom-modal-overlay" id="symptom-modal">
            <div class="symptom-modal">
                <div class="symptom-modal-header">
                    <span class="symptom-modal-title">ü©∫ Ch·ªçn tri·ªáu ch·ª©ng c·∫ßn h·ªó tr·ª£</span>
                    <button class="symptom-modal-close" onclick="closeSymptomModal()">√ó</button>
                </div>
                <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 16px;">Ch·ªçn c√°c tri·ªáu ch·ª©ng ƒë·ªÉ th√¥ng
                    b√°o cho b√°c sƒ© tr∆∞·ªõc khi g·ªçi</div>

                <div style="max-height: 50vh; overflow-y: auto; padding-right: 4px;">
                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü§∞</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Ph·ª• n·ªØ ƒëang sinh ƒë·∫ª</div>
                            <div class="symptom-text-desc">C·∫ßn h·ªó tr·ª£ y t·∫ø cho s·∫£n ph·ª•</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üë¥</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Ng∆∞·ªùi gi√† c·∫ßn h·ªó tr·ª£ ƒë·∫∑c bi·ªát</div>
                            <div class="symptom-text-desc">Ng∆∞·ªùi cao tu·ªïi, kh√≥ di chuy·ªÉn</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üíä</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">C·∫ßn thu·ªëc tim m·∫°ch</div>
                            <div class="symptom-text-desc">Thu·ªëc huy·∫øt √°p, tim, m·ª° m√°u...</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üíâ</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">C·∫ßn thu·ªëc ti·ªÉu ƒë∆∞·ªùng</div>
                            <div class="symptom-text-desc">Insulin, thu·ªëc h·∫° ƒë∆∞·ªùng huy·∫øt...</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü´Å</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">B·ªánh h√¥ h·∫•p / Hen suy·ªÖn</div>
                            <div class="symptom-text-desc">C·∫ßn b√¨nh oxy, thu·ªëc x·ªãt hen...</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü©π</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Ch·∫•n th∆∞∆°ng / Tai n·∫°n</div>
                            <div class="symptom-text-desc">G√£y x∆∞∆°ng, v·∫øt th∆∞∆°ng h·ªü...</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üë∂</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Tr·∫ª em c·∫ßn h·ªó tr·ª£</div>
                            <div class="symptom-text-desc">Tr·∫ª s∆° sinh, tr·∫ª nh·ªè c·∫ßn chƒÉm s√≥c</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü§í</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">S·ªët cao / Nhi·ªÖm tr√πng</div>
                            <div class="symptom-text-desc">S·ªët tr√™n 38.5¬∞C, d·∫•u hi·ªáu nhi·ªÖm tr√πng</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü§¢</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Ti√™u ch·∫£y / Ng·ªô ƒë·ªôc th·ª±c ph·∫©m</div>
                            <div class="symptom-text-desc">N√¥n m·ª≠a, ti√™u ch·∫£y, m·∫•t n∆∞·ªõc</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü¶†</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">B·ªánh ngo√†i da / D·ªã ·ª©ng</div>
                            <div class="symptom-text-desc">N·∫•m, gh·∫ª, ph√°t ban, d·ªã ·ª©ng n∆∞·ªõc</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üòµ</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">ƒêu·ªëi n∆∞·ªõc / H·∫° th√¢n nhi·ªát</div>
                            <div class="symptom-text-desc">C·∫ßn h·ªìi s·ª©c, s∆∞·ªüi ·∫•m kh·∫©n c·∫•p</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üß†</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">R·ªëi lo·∫°n t√¢m th·∫ßn / Ho·∫£ng lo·∫°n</div>
                            <div class="symptom-text-desc">Lo √¢u, ho·∫£ng s·ª£, c·∫ßn h·ªó tr·ª£ t√¢m l√Ω</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü¶¥</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Ng∆∞·ªùi khuy·∫øt t·∫≠t c·∫ßn h·ªó tr·ª£</div>
                            <div class="symptom-text-desc">C·∫ßn h·ªó tr·ª£ di chuy·ªÉn, thi·∫øt b·ªã ƒë·∫∑c bi·ªát</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">‚ö°</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">ƒêi·ªán gi·∫≠t / B·ªèng</div>
                            <div class="symptom-text-desc">B·ªèng ƒëi·ªán, b·ªèng n∆∞·ªõc s√¥i, b·ªèng l·ª≠a</div>
                        </div>
                    </div>
                </div>

                <!-- Other symptoms input -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-200);">
                    <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 6px;">üìù Tri·ªáu ch·ª©ng kh√°c:</div>
                    <textarea id="other-symptoms" class="form-input" rows="2"
                        placeholder="Nh·∫≠p c√°c tri·ªáu ch·ª©ng kh√°c kh√¥ng c√≥ trong danh s√°ch..."></textarea>
                </div>

                <div style="margin-top: 16px;">
                    <button class="btn btn-danger" onclick="confirmSymptoms()" style="margin-bottom: 8px;">üìû G·ªçi B√°c sƒ©
                        v·ªõi tri·ªáu ch·ª©ng ƒë√£ ch·ªçn</button>
                    <button class="btn btn-outline" onclick="closeSymptomModal()">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Essential Items Modal -->
        <div class="symptom-modal-overlay" id="items-modal">
            <div class="symptom-modal">
                <div class="symptom-modal-header">
                    <span class="symptom-modal-title">üì¶ V·∫≠t d·ª•ng c·∫ßn h·ªó tr·ª£</span>
                    <button class="symptom-modal-close" onclick="closeItemsModal()">√ó</button>
                </div>
                <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 16px;">Ch·ªçn c√°c v·∫≠t d·ª•ng thi·∫øt y·∫øu
                    b·∫°n c·∫ßn ƒë∆∞·ª£c h·ªó tr·ª£</div>

                <div style="max-height: 50vh; overflow-y: auto; padding-right: 4px;">
                    <!-- Personal Care -->
                    <div
                        style="font-size: 11px; font-weight: 600; color: var(--gray-500); margin-bottom: 6px; margin-top: 8px;">
                        üë§ V·ªÜ SINH C√Å NH√ÇN</div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü©∏</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">BƒÉng v·ªá sinh ph·ª• n·ªØ</div>
                            <div class="symptom-text-desc">BƒÉng v·ªá sinh, tampon, gi·∫•y v·ªá sinh...</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üçº</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">T√£, b·ªâm cho tr·∫ª em</div>
                            <div class="symptom-text-desc">T√£ gi·∫•y, b·ªâm c√°c size, khƒÉn ∆∞·ªõt</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üß¥</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">X√† ph√≤ng / D·∫ßu g·ªôi</div>
                            <div class="symptom-text-desc">X√† ph√≤ng t·∫Øm, d·∫ßu g·ªôi, s·ªØa r·ª≠a m·∫∑t</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü™•</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">B√†n ch·∫£i / Kem ƒë√°nh rƒÉng</div>
                            <div class="symptom-text-desc">D·ª•ng c·ª• v·ªá sinh rƒÉng mi·ªáng</div>
                        </div>
                    </div>

                    <!-- Food & Water -->
                    <div
                        style="font-size: 11px; font-weight: 600; color: var(--gray-500); margin-bottom: 6px; margin-top: 16px;">
                        üçû TH·ª∞C PH·∫®M & N∆Ø·ªöC</div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üíß</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">N∆∞·ªõc u·ªëng s·∫°ch</div>
                            <div class="symptom-text-desc">N∆∞·ªõc ƒë√≥ng chai, n∆∞·ªõc l·ªçc</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üçö</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">G·∫°o / L∆∞∆°ng th·ª±c kh√¥</div>
                            <div class="symptom-text-desc">G·∫°o, m√¨ g√≥i, ch√°o ƒÉn li·ªÅn</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü•´</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">ƒê·ªì h·ªôp / Th·ª±c ph·∫©m ƒë√≥ng g√≥i</div>
                            <div class="symptom-text-desc">C√° h·ªôp, th·ªãt h·ªôp, x√∫c x√≠ch...</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü•õ</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">S·ªØa cho tr·∫ª em / Ng∆∞·ªùi gi√†</div>
                            <div class="symptom-text-desc">S·ªØa b·ªôt, s·ªØa t∆∞∆°i, s·ªØa ƒë·∫∑c bi·ªát</div>
                        </div>
                    </div>

                    <!-- Medical Supplies -->
                    <div
                        style="font-size: 11px; font-weight: 600; color: var(--gray-500); margin-bottom: 6px; margin-top: 16px;">
                        üíä Y T·∫æ & THU·ªêC</div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü©π</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">BƒÉng g·∫°c / C·ªìn s√°t tr√πng</div>
                            <div class="symptom-text-desc">D·ª•ng c·ª• s∆° c·ª©u, bƒÉng keo y t·∫ø</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üíä</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Thu·ªëc c·∫£m / H·∫° s·ªët</div>
                            <div class="symptom-text-desc">Paracetamol, thu·ªëc ho, c·∫£m c√∫m</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üíâ</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Thu·ªëc ti√™u ch·∫£y / ƒêau b·ª•ng</div>
                            <div class="symptom-text-desc">Oresol, Smecta, thu·ªëc d·∫° d√†y</div>
                        </div>
                    </div>

                    <!-- Shelter & Clothing -->
                    <div
                        style="font-size: 11px; font-weight: 600; color: var(--gray-500); margin-bottom: 6px; margin-top: 16px;">
                        üè† CH·ªñ ·ªû & QU·∫¶N √ÅO</div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üëï</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">Qu·∫ßn √°o</div>
                            <div class="symptom-text-desc">Qu·∫ßn √°o kh√¥, ƒë·ªì l√≥t, gi√†y d√©p</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üõèÔ∏è</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">ChƒÉn / M√†n / Chi·∫øu</div>
                            <div class="symptom-text-desc">ƒê·ªì d√πng ng·ªß ngh·ªâ, gi·ªØ ·∫•m</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">‚õ∫</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">B·∫°t / L·ªÅu t·∫°m</div>
                            <div class="symptom-text-desc">N∆°i tr√∫ ·∫©n t·∫°m th·ªùi</div>
                        </div>
                    </div>

                    <!-- Tools & Equipment -->
                    <div
                        style="font-size: 11px; font-weight: 600; color: var(--gray-500); margin-bottom: 6px; margin-top: 16px;">
                        üîß D·ª§NG C·ª§ & THI·∫æT B·ªä</div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üî¶</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">ƒê√®n pin / N·∫øn</div>
                            <div class="symptom-text-desc">Thi·∫øt b·ªã chi·∫øu s√°ng, pin d·ª± ph√≤ng</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">üîã</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">S·∫°c d·ª± ph√≤ng / Pin</div>
                            <div class="symptom-text-desc">Powerbank, pin c√°c lo·∫°i</div>
                        </div>
                    </div>

                    <div class="symptom-option" onclick="toggleSymptom(this)">
                        <input type="checkbox">
                        <span class="symptom-icon">ü™£</span>
                        <div class="symptom-text">
                            <div class="symptom-text-title">X√¥ / Ch·∫≠u / Th√πng ch·ª©a n∆∞·ªõc</div>
                            <div class="symptom-text-desc">D·ª•ng c·ª• ch·ª©a v√† v·∫≠n chuy·ªÉn n∆∞·ªõc</div>
                        </div>
                    </div>
                </div>

                <!-- Other items input -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-200);">
                    <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 6px;">üìù V·∫≠t d·ª•ng kh√°c:</div>
                    <textarea id="other-items" class="form-input" rows="2"
                        placeholder="Nh·∫≠p c√°c v·∫≠t d·ª•ng kh√°c kh√¥ng c√≥ trong danh s√°ch..."></textarea>
                </div>

                <div style="margin-top: 16px;">
                    <button class="btn btn-primary" onclick="confirmItems()" style="margin-bottom: 8px;">‚úÖ X√°c nh·∫≠n v·∫≠t
                        d·ª•ng c·∫ßn h·ªó tr·ª£</button>
                    <button class="btn btn-outline" onclick="closeItemsModal()">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Video Recording Modal -->
        <div class="symptom-modal-overlay" id="video-modal">
            <div class="symptom-modal">
                <div class="symptom-modal-header">
                    <span class="symptom-modal-title">üìπ Quay video hi·ªán tr·∫°ng</span>
                    <button class="symptom-modal-close" onclick="closeVideoModal()">√ó</button>
                </div>
                <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 16px;">Quay video ƒë·ªÉ g·ª≠i ƒë·∫øn ƒë·ªôi ng≈©
                    y t·∫ø v√† c·ª©u tr·ª£</div>

                <div
                    style="background: var(--gray-100); border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 16px;">
                    <div style="font-size: 48px; margin-bottom: 8px;">üé•</div>

                    <!-- Location Status for Video -->
                    <div
                        style="background: white; border-radius: 8px; padding: 8px; margin-bottom: 12px; border: 1px solid var(--gray-200);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                            <span style="font-size: 11px; font-weight: 600; color: var(--gray-600);">üìç V·ªã tr√≠ hi·ªán
                                t·∫°i:</span>
                            <button onclick="refreshVideoLocation()"
                                style="border: none; background: none; color: var(--blue-500); font-weight: 600; font-size: 11px; cursor: pointer;">üîÑ
                                L√†m m·ªõi</button>
                        </div>
                        <div id="video-location-text"
                            style="font-size: 12px; font-weight: 700; color: var(--blue-600); min-height: 18px;">ƒêang
                            l·∫•y v·ªã tr√≠...</div>
                        <div style="font-size: 10px; color: var(--gray-400); margin-top: 2px;">(T·ª± ƒë·ªông c·∫≠p nh·∫≠t 1
                            ph√∫t/l·∫ßn)</div>
                    </div>

                    <div style="font-size: 13px; color: var(--gray-600); margin-bottom: 12px;">Nh·∫•n ƒë·ªÉ b·∫Øt ƒë·∫ßu quay
                        video</div>
                    <label
                        style="display: inline-block; padding: 14px 24px; background: var(--red-500); color: white; border-radius: 50px; font-weight: 600; cursor: pointer;">

                        <input type="file" accept="video/*" capture="environment" style="display: none;"
                            onchange="handleVideoUpload(this)">
                        ‚è∫Ô∏è B·∫Øt ƒë·∫ßu quay
                    </label>
                </div>

                <div id="video-preview" style="display: none; margin-bottom: 16px;">
                    <video id="recorded-video" controls style="width: 100%; border-radius: 8px;"></video>
                </div>

                <div class="form-group" style="margin-bottom: 12px;">
                    <label class="form-label">M√¥ t·∫£ t√¨nh tr·∫°ng</label>
                    <textarea id="video-description" class="form-input" rows="2"
                        placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ t√¨nh tr·∫°ng hi·ªán t·∫°i..."></textarea>
                </div>

                <button class="btn btn-danger" onclick="sendVideoToMedical()" style="margin-bottom: 8px;">üÜò G·ª≠i video
                    ƒë·∫øn ƒë·ªôi Y t·∫ø</button>
                <button class="btn btn-outline" onclick="closeVideoModal()">ƒê√≥ng</button>
            </div>
        </div>

        <!-- Notification Panel Modal -->
        <div class="symptom-modal-overlay" id="notification-modal">
            <div class="symptom-modal">
                <div class="symptom-modal-header">
                    <span class="symptom-modal-title">üîî Th√¥ng b√°o</span>
                    <button class="symptom-modal-close" onclick="closeNotificationPanel()">√ó</button>
                </div>
                <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 16px;">Tin nh·∫Øn t·ª´ ƒë·ªôi ng≈© y t·∫ø v√†
                    ng∆∞·ªùi th√¢n</div>

                <div style="max-height: 50vh; overflow-y: auto;">
                    <!-- Coordinator Notification (Redirection) -->
                    <div
                        style="background: linear-gradient(135deg, #fff7ed, #ffedd5); border-left: 4px solid var(--orange-500); border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600; font-size: 13px; color: var(--orange-800);">üì° ƒêi·ªÅu ph·ªëi
                                vi√™n</span>
                            <span style="font-size: 10px; color: var(--gray-500);">V·ª´a xong</span>
                        </div>
                        <div style="font-size: 12px; color: var(--gray-800); margin-bottom: 6px;">‚ö†Ô∏è <strong>CH√ö √ù ƒêI·ªÄU
                                PH·ªêI:</strong></div>
                        <div style="font-size: 12px; color: var(--gray-700);">Khu v·ª±c <strong>P. Vƒ©nh H·∫£i</strong> hi·ªán
                            ƒë√£ c√≥ <span style="font-weight: 700;">10 ƒëo√†n</span> (qu√° t·∫£i).</div>
                        <div style="font-size: 12px; color: var(--gray-700); margin-top: 4px; font-weight: 600;">üìç Ch·ªçn
                            ƒë·ªãa ƒëi·ªÉm ƒë·ªÉ chuy·ªÉn h∆∞·ªõng:</div>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                            <button onclick="showToast('‚úÖ ƒê√£ x√°c nh·∫≠n ƒë·∫øn Ph∆∞·ªõc H·∫£i!')"
                                style="padding: 12px; background: white; border: 2px solid var(--orange-500); color: var(--orange-700); border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                                <span>1Ô∏è‚É£ Ph∆∞·ªùng Ph∆∞·ªõc H·∫£i</span>
                                <span
                                    style="font-size: 11px; background: var(--orange-100); padding: 2px 6px; border-radius: 4px;">√çt
                                    ƒëo√†n</span>
                            </button>
                            <button onclick="showToast('‚úÖ ƒê√£ x√°c nh·∫≠n ƒë·∫øn Ph∆∞·ªõc H√≤a!')"
                                style="padding: 12px; background: white; border: 2px solid var(--orange-500); color: var(--orange-700); border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                                <span>2Ô∏è‚É£ Ph∆∞·ªùng Ph∆∞·ªõc H√≤a</span>
                                <span
                                    style="font-size: 11px; background: var(--orange-100); padding: 2px 6px; border-radius: 4px;">C·∫ßn
                                    h·ªó tr·ª£</span>
                            </button>
                            <button onclick="showToast('‚úÖ ƒê√£ x√°c nh·∫≠n ƒë·∫øn Vƒ©nh L∆∞∆°ng!')"
                                style="padding: 12px; background: white; border: 2px solid var(--orange-500); color: var(--orange-700); border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                                <span>3Ô∏è‚É£ X√£ Vƒ©nh L∆∞∆°ng</span>
                                <span
                                    style="font-size: 11px; background: var(--orange-100); padding: 2px 6px; border-radius: 4px;">Kh·∫©n
                                    c·∫•p</span>
                            </button>
                        </div>
                    </div>
                    <!-- Medical Team Notification -->
                    <div
                        style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border-left: 4px solid var(--red-500); border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600; font-size: 13px; color: var(--red-700);">üè• ƒê·ªôi Y t·∫ø Nha
                                Trang</span>
                            <span style="font-size: 10px; color: var(--gray-500);">5 ph√∫t tr∆∞·ªõc</span>
                        </div>
                        <div style="font-size: 12px; color: var(--gray-700);">Ch√∫ng t√¥i ƒë√£ nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu h·ªó tr·ª£ c·ªßa
                            b·∫°n. ƒê·ªôi c·ª©u h·ªô ƒëang tr√™n ƒë∆∞·ªùng ƒë·∫øn.</div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <a href="tel:0912345678"
                                style="flex: 1; text-align: center; padding: 8px; background: var(--green-500); color: white; border-radius: 6px; font-size: 11px; text-decoration: none; font-weight: 600;">üìû
                                G·ªçi l·∫°i</a>
                            <button onclick="replyToNotification('medical')"
                                style="flex: 1; padding: 8px; background: white; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 11px; cursor: pointer;">üí¨
                                Nh·∫Øn</button>
                        </div>
                    </div>

                    <!-- Family Notification -->
                    <div
                        style="background: white; border: 1px solid var(--gray-200); border-left: 4px solid var(--blue-500); border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600; font-size: 13px; color: var(--blue-700);">üë®‚Äçüë©‚Äçüëß Ng∆∞·ªùi th√¢n
                                - Nguy·ªÖn VƒÉn A</span>
                            <span style="font-size: 10px; color: var(--gray-500);">15 ph√∫t tr∆∞·ªõc</span>
                        </div>
                        <div style="font-size: 12px; color: var(--gray-700);">Con ∆°i, b·ªë m·∫π ƒëang r·∫•t lo. C√≥ c·∫ßn g√¨ th√¨
                            b√°o ngay nh√©!</div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <a href="tel:0987654321"
                                style="flex: 1; text-align: center; padding: 8px; background: var(--green-500); color: white; border-radius: 6px; font-size: 11px; text-decoration: none; font-weight: 600;">üìû
                                G·ªçi l·∫°i</a>
                            <button onclick="replyToNotification('family')"
                                style="flex: 1; padding: 8px; background: white; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 11px; cursor: pointer;">üí¨
                                Nh·∫Øn</button>
                        </div>
                    </div>

                    <!-- Volunteer Team Notification -->
                    <div
                        style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-left: 4px solid var(--green-500); border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600; font-size: 13px; color: var(--green-700);">üöõ ƒêo√†n thi·ªán
                                nguy·ªán TP.HCM</span>
                            <span style="font-size: 10px; color: var(--gray-500);">1 gi·ªù tr∆∞·ªõc</span>
                        </div>
                        <div style="font-size: 12px; color: var(--gray-700);">ƒêo√†n ƒë√£ ƒë·∫øn ƒëi·ªÉm ph√°t qu√†. Xin m·ªùi b√† con
                            ƒë·∫øn nh·∫≠n h·ªó tr·ª£!</div>
                    </div>
                </div>

                <button class="btn btn-outline" onclick="closeNotificationPanel()"
                    style="margin-top: 12px;">ƒê√≥ng</button>
            </div>
        </div>

        <!-- Pilot Registration Modal -->
        <div class="symptom-modal-overlay" id="pilot-register-modal">
            <div class="symptom-modal">
                <div class="symptom-modal-header">
                    <span class="symptom-modal-title">üôã ƒêƒÉng k√Ω Hoa ti√™u d·∫´n ƒë∆∞·ªùng</span>
                    <button class="symptom-modal-close" onclick="closePilotRegisterModal()">√ó</button>
                </div>
                <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 16px;">Nh·∫≠p th√¥ng tin ƒë·ªÉ ƒëƒÉng k√Ω l√†m
                    hoa ti√™u d·∫´n ƒë∆∞·ªùng cho c√°c ƒëo√†n thi·ªán nguy·ªán</div>

                <div style="max-height: 50vh; overflow-y: auto; padding-right: 4px;">
                    <div class="form-group">
                        <label class="form-label">H·ªç v√† t√™n <span style="color: var(--red-500);">*</span></label>
                        <input type="text" id="pilot-name" class="form-input" placeholder="Nguy·ªÖn VƒÉn A">
                    </div>
                    <div class="form-group">
                        <label class="form-label">S·ªë ƒëi·ªán tho·∫°i <span style="color: var(--red-500);">*</span></label>
                        <input type="tel" id="pilot-phone" class="form-input" placeholder="0912 345 678">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Khu v·ª±c th√¥ng th·∫°o <span
                                style="color: var(--red-500);">*</span></label>
                        <input type="text" id="pilot-area" class="form-input"
                            placeholder="P. L·ªôc Th·ªç, P. Vƒ©nh H·∫£i, TP. Nha Trang">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ph∆∞∆°ng ti·ªán di chuy·ªÉn</label>
                        <select id="pilot-vehicle" class="form-input">
                            <option value="motorbike">üèçÔ∏è Xe m√°y</option>
                            <option value="car">üöó √î t√¥</option>
                            <option value="bicycle">üö≤ Xe ƒë·∫°p</option>
                            <option value="walking">üö∂ ƒêi b·ªô</option>
                            <option value="boat">üö§ Thuy·ªÅn/Ghe</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Th·ªùi gian c√≥ th·ªÉ h·ªó tr·ª£</label>
                        <input type="text" id="pilot-availability" class="form-input" placeholder="6:00 - 18:00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ghi ch√∫ th√™m</label>
                        <textarea id="pilot-notes" class="form-input" rows="2"
                            placeholder="Bi·∫øt ƒë∆∞·ªùng t·∫Øt, c√≥ th·ªÉ ƒëi ƒë∆∞·ªùng ng·∫≠p..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 16px;">
                    <button class="btn btn-primary" onclick="registerPilot()" style="margin-bottom: 8px;">‚úÖ ƒêƒÉng k√Ω l√†m
                        Hoa ti√™u</button>
                    <button class="btn btn-outline" onclick="closePilotRegisterModal()">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Find Pilot Modal -->
        <div class="symptom-modal-overlay" id="find-pilot-modal">
            <div class="symptom-modal">
                <div class="symptom-modal-header">
                    <span class="symptom-modal-title">üîç T√¨m Hoa ti√™u d·∫´n ƒë∆∞·ªùng</span>
                    <button class="symptom-modal-close" onclick="closeFindPilotModal()">√ó</button>
                </div>
                <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">T√¨m hoa ti√™u ƒë·ªãa ph∆∞∆°ng ƒë·ªÉ
                    d·∫´n ƒë∆∞·ªùng</div>

                <button onclick="getPilotGPSLocation()"
                    style="width: 100%; padding: 12px; background: var(--blue-500); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 12px;">
                    üìç L·∫•y v·ªã tr√≠ GPS c·ªßa t√¥i
                </button>
                <div id="pilot-gps-status"
                    style="font-size: 11px; color: var(--gray-500); text-align: center; margin-bottom: 12px;"></div>

                <div style="font-size: 12px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">üìã Danh s√°ch
                    Hoa ti√™u g·∫ßn b·∫°n:</div>

                <div style="max-height: 40vh; overflow-y: auto;">
                    <!-- Nearest Pilot - Highlighted -->
                    <div id="pilot-nearest"
                        style="background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid var(--yellow-500); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
                            <span style="font-size: 20px;">‚≠ê</span>
                            <span
                                style="background: var(--yellow-500); color: white; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 10px;">G·∫¶N
                                NH·∫§T</span>
                        </div>
                        <div style="font-weight: 600; font-size: 14px; color: var(--gray-800);">Tr·∫ßn VƒÉn B</div>
                        <div style="font-size: 11px; color: var(--gray-600); margin: 4px 0;">üìç P. L·ªôc Th·ªç ‚Ä¢ üèçÔ∏è Xe m√°y
                            ‚Ä¢ ‚è∞ 6:00-18:00</div>
                        <div style="font-size: 11px; color: var(--green-600); font-weight: 600;">üìè C√°ch 0.5km</div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <a href="tel:0923456789"
                                style="flex: 1; text-align: center; padding: 10px; background: var(--green-500); color: white; border-radius: 6px; font-size: 12px; text-decoration: none; font-weight: 600;">üìû
                                G·ªçi ngay</a>
                            <button onclick="showToast('ƒê√£ g·ª≠i y√™u c·∫ßu!')"
                                style="flex: 1; padding: 10px; background: var(--blue-500); color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; font-weight: 600;">üìç
                                Nh·ªù d·∫´n</button>
                        </div>
                    </div>

                    <!-- Other Pilots -->
                    <div
                        style="background: white; border: 1px solid var(--gray-200); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="font-weight: 600; font-size: 13px; color: var(--gray-800);">L√™ Th·ªã C</div>
                        <div style="font-size: 11px; color: var(--gray-600); margin: 4px 0;">üìç P. Vƒ©nh H·∫£i ‚Ä¢ üöó √î t√¥ ‚Ä¢
                            ‚è∞ 8:00-20:00</div>
                        <div style="font-size: 11px; color: var(--gray-500);">üìè C√°ch 1.2km</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <a href="tel:0934567890"
                                style="flex: 1; text-align: center; padding: 8px; background: var(--green-500); color: white; border-radius: 6px; font-size: 11px; text-decoration: none;">üìû
                                G·ªçi</a>
                            <button onclick="showToast('ƒê√£ g·ª≠i y√™u c·∫ßu!')"
                                style="flex: 1; padding: 8px; background: white; border: 1px solid var(--blue-500); color: var(--blue-500); border-radius: 6px; font-size: 11px; cursor: pointer;">üìç
                                Nh·ªù d·∫´n</button>
                        </div>
                    </div>

                    <div
                        style="background: white; border: 1px solid var(--gray-200); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="font-weight: 600; font-size: 13px; color: var(--gray-800);">Ph·∫°m VƒÉn D</div>
                        <div style="font-size: 11px; color: var(--gray-600); margin: 4px 0;">üìç P. Vƒ©nh Nguy√™n ‚Ä¢ üö§
                            Thuy·ªÅn ‚Ä¢ ‚è∞ C·∫£ ng√†y</div>
                        <div style="font-size: 11px; color: var(--gray-500);">üìè C√°ch 2.5km</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <a href="tel:0945678901"
                                style="flex: 1; text-align: center; padding: 8px; background: var(--green-500); color: white; border-radius: 6px; font-size: 11px; text-decoration: none;">üìû
                                G·ªçi</a>
                            <button onclick="showToast('ƒê√£ g·ª≠i y√™u c·∫ßu!')"
                                style="flex: 1; padding: 8px; background: white; border: 1px solid var(--blue-500); color: var(--blue-500); border-radius: 6px; font-size: 11px; cursor: pointer;">üìç
                                Nh·ªù d·∫´n</button>
                        </div>
                    </div>
                </div>

                <button class="btn btn-outline" onclick="closeFindPilotModal()" style="margin-top: 12px;">ƒê√≥ng</button>
            </div>
        </div>

        <!-- 1. Verification Screen -->
        <div class="screen" id="screen-verify">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('home')">‚Üê</button>
                <h2>X√°c minh & S√†ng l·ªçc</h2>
            </div>
            <div class="card">
                <div class="card-title">üìû Quy tr√¨nh x√°c minh qua cu·ªôc g·ªçi</div>
                <p style="font-size: 13px; color: var(--gray-600); line-height: 1.5;">G·ªçi ƒëi·ªán x√°c minh t√¨nh tr·∫°ng n·∫°n
                    nh√¢n t·ª´ danh s√°ch Crawler. Ph√¢n lo·∫°i: <b>An to√†n</b> ho·∫∑c <b>C·∫ßn c·ª©u tr·ª£</b>.</p>
            </div>
            <div class="call-counter">
                <button class="counter-btn" onclick="decreaseCount()">‚àí</button>
                <div class="counter-value" id="call-count">5</div>
                <button class="counter-btn" onclick="increaseCount()">+</button>
            </div>
            <div style="padding: 16px;"><button class="btn btn-primary" onclick="startCalling()">üìû B·∫Øt ƒë·∫ßu g·ªçi x√°c
                    minh</button></div>
        </div>

        <!-- Call List Screen -->
        <div class="screen" id="screen-call-list">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('verify')">‚Üê</button>
                <h2>Danh s√°ch x√°c minh</h2>
            </div>
            <div class="progress-section">
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="call-progress" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-text">ƒê√£ x√°c minh: 0/5</span><span
                        id="unreachable-text">L·ªçc r√°c: 0</span></div>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('pending')">Ch∆∞a g·ªçi</button>
                <button class="tab" onclick="switchTab('completed')">ƒê√£ x√°c minh</button>
                <button class="tab" onclick="switchTab('spam')">Tin r√°c</button>
            </div>
            <div class="script-card">
                <div class="script-header" onclick="toggleScript()"><span>üìã K·ªãch b·∫£n g·ªçi ƒëi·ªán</span><span
                        id="script-toggle">‚ñº</span></div>
                <div class="script-content" id="script-content">"Xin ch√†o, t√¥i l√† t√¨nh nguy·ªán vi√™n. Xin h·ªèi gia ƒë√¨nh c√≤n
                    c·∫ßn h·ªó tr·ª£ kh√¥ng ·∫°?<br><br>‚úÖ N·∫øu <b>AN TO√ÄN</b>: C·∫£m ∆°n, ch√∫c gia ƒë√¨nh b√¨nh an!<br><br>üÜò N·∫øu <b>C·∫¶N
                        H·ªñ TR·ª¢</b>: Ghi nh·∫≠n v·ªã tr√≠, s·ªë ng∆∞·ªùi, t√¨nh tr·∫°ng s·ª©c kh·ªèe."</div>
            </div>
            <div id="call-list-container"></div>
        </div>

        <!-- Recording Form Screen -->
        <div class="screen" id="screen-record-form">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('call-list')">‚Üê</button>
                <h2>Ghi nh·∫≠n th√¥ng tin</h2>
            </div>
            <div style="padding: 16px;">
                <div
                    style="background: var(--blue-500); color: white; padding: 14px; border-radius: 10px; text-align: center; margin-bottom: 16px;">
                    <div style="font-size: 12px; opacity: 0.9;">ƒêang g·ªçi</div>
                    <div id="current-phone" style="font-size: 22px; font-weight: 700;">0912 345 678</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Tr·∫°ng th√°i</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="btn btn-outline" id="btn-safe" onclick="selectStatus('safe')"
                            style="padding: 12px;">‚úÖ An to√†n</button>
                        <button class="btn btn-danger" id="btn-need" onclick="selectStatus('need')"
                            style="padding: 12px;">üÜò C·∫ßn c·ª©u tr·ª£</button>
                    </div>
                </div>
                <div id="need-form" class="hidden">
                    <div class="form-group"><label class="form-label">üìç V·ªã tr√≠ ch√≠nh x√°c</label><textarea
                            class="form-input" rows="2" placeholder="Th√¥n, x√£, huy·ªán, t·ªânh..."></textarea></div>
                    <div class="form-group"><label class="form-label">üë• S·ªë l∆∞·ª£ng ng∆∞·ªùi</label><input type="number"
                            class="form-input" placeholder="5"></div>
                    <div class="form-group"><label class="form-label">üè• T√¨nh tr·∫°ng s·ª©c kh·ªèe</label>
                        <select class="form-input">
                            <option>B√¨nh th∆∞·ªùng</option>
                            <option>C·∫ßn y t·∫ø kh·∫©n c·∫•p</option>
                            <option>C√≥ ng∆∞·ªùi gi√†</option>
                            <option>C√≥ tr·∫ª nh·ªè</option>
                            <option>C√≥ ph·ª• n·ªØ mang thai</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">üìù Nhu c·∫ßu c·∫•p thi·∫øt</label><textarea
                            class="form-input" rows="2" placeholder="Th·ª±c ph·∫©m, n∆∞·ªõc, thu·ªëc..."></textarea></div>
                    <div class="form-group"><label class="form-label">üéôÔ∏è Ghi √¢m cu·ªôc g·ªçi</label>
                        <div style="text-align: center; padding: 16px;"><button class="recording-btn"
                                onclick="toggleRecording()">üéôÔ∏è</button>
                            <div style="margin-top: 8px; font-size: 12px; color: var(--gray-500);">Nh·∫•n ƒë·ªÉ ghi √¢m</div>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">‚ö° M·ª©c ƒë·ªô ∆∞u ti√™n</label>
                        <div style="display: flex; gap: 8px;">
                            <span class="priority-tag high" onclick="selectPriority('high')">üî¥ Kh·∫©n c·∫•p</span>
                            <span class="priority-tag medium" onclick="selectPriority('medium')">üü° Trung b√¨nh</span>
                            <span class="priority-tag low" onclick="selectPriority('low')">üü¢ Th·∫•p</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveVerification()">üíæ L∆∞u & Chuy·ªÉn ti·∫øp</button>
            </div>
        </div>

        <!-- 2. Map Screen -->
        <div class="screen" id="screen-map">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('home')">‚Üê</button>
                <h2>B·∫£n ƒë·ªì ƒêi·ªÅu ph·ªëi - Nha Trang</h2>
            </div>
            <!-- Quick Tips Banner -->
            <div
                style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); padding: 12px 16px; border-bottom: 2px solid #3b82f6;">
                <div style="font-weight: 600; font-size: 12px; color: #1e40af; margin-bottom: 4px;">üí° H∆∞·ªõng d·∫´n nhanh
                </div>
                <div style="font-size: 11px; color: #1e40af; line-height: 1.5;">
                    üëÜ B·∫•m v√†o ƒëi·ªÉm ƒë√°nh d·∫•u ƒë·ªÉ xem th√¥ng tin h·ªô c·∫ßn c·ª©u tr·ª£<br>
                    üìã Sao ch√©p t·ªça ƒë·ªô ho·∫∑c m·ªü Google Maps ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng
                </div>
            </div>

            <div id="map"></div>
            <div class="map-legend">
                <div style="font-weight: 600; margin-bottom: 4px;">Ph√¢n v√πng nguy c·∫•p</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--red-500)"></div> V√πng ƒê·ªè (SOS) - Ch∆∞a c√≥ ƒëo√†n
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--yellow-500)"></div> V√πng V√†ng - C·∫ßn Y t·∫ø/Thu·ªëc
                </div>

                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--blue-500)"></div> ƒêo√†n thi·ªán nguy·ªán
                </div>
            </div>
        </div>

        <!-- Volunteer Register Screen -->
        <div class="screen" id="screen-volunteer-register">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('home')">‚Üê</button>
                <h2>ƒêƒÉng k√Ω Thi·ªán nguy·ªán</h2>
            </div>
            <div class="card">
                <div class="card-title">üöõ C·ªïng ƒëƒÉng k√Ω ƒêo√†n</div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">ƒêƒÉng k√Ω l·ªô tr√¨nh v√† h√†ng h√≥a ƒë·ªÉ
                    h·ªá th·ªëng ƒëi·ªÅu ph·ªëi, tr√°nh qu√° t·∫£i.</p>
            </div>
            <div style="padding: 0 16px;">
                <div class="form-group"><label class="form-label">T√™n ƒëo√†n</label><input type="text" class="form-input"
                        placeholder="ƒêo√†n thi·ªán nguy·ªán ABC"></div>
                <div class="form-group"><label class="form-label">S·ªë xe / ph∆∞∆°ng ti·ªán</label><input type="text"
                        class="form-input" placeholder="2 xe t·∫£i, 1 xe con"></div>
                <div class="form-group"><label class="form-label">H√†ng h√≥a mang theo</label><textarea class="form-input"
                        rows="2" placeholder="G·∫°o 500kg, m√¨ 200 th√πng, n∆∞·ªõc 1000 chai..."></textarea></div>
                <div class="form-group"><label class="form-label">L·ªô tr√¨nh d·ª± ki·∫øn</label><input type="text"
                        class="form-input" placeholder="TP.HCM ‚Üí Cam Ranh ‚Üí Nha Trang"></div>
                <div class="form-group"><label class="form-label">Th·ªùi gian d·ª± ki·∫øn ƒë·∫øn</label><input
                        type="datetime-local" class="form-input"></div>

                <!-- Equitable Routing Opt-in -->
                <div class="form-group"
                    style="background: var(--blue-50); padding: 10px; border-radius: 8px; border: 1px solid var(--blue-200); margin-bottom: 12px;">
                    <label class="checkbox-label"
                        style="display: flex; align-items: flex-start; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="volunteer-routing-optin" style="margin-top: 2px;">
                        <div>
                            <div style="font-weight: 600; font-size: 13px; color: var(--blue-800);">üîÑ Nh·∫≠n ƒëi·ªÅu ph·ªëi
                                c·ª©u tr·ª£</div>
                            <div style="font-size: 11px; color: var(--blue-600); line-height: 1.3;">
                                T√¥i ƒë·ªìng √Ω ƒë·ªÉ h·ªá th·ªëng ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn c√°c khu v·ª±c ƒëang thi·∫øu ngu·ªìn l·ª±c nh·∫•t (tr√°nh tr√πng
                                l·∫∑p). H·ªá th·ªëng s·∫Ω g·ª≠i ƒë·ªãa ƒëi·ªÉm ƒë·ªÅ xu·∫•t ngay sau khi ƒëƒÉng k√Ω.
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Relief Station Registration -->
                <div class="form-group"
                    style="margin-bottom: 16px; border-top: 1px dashed var(--gray-300); padding-top: 12px;">
                    <label class="checkbox-label"
                        style="display: flex; align-items: center; gap: 8px; font-weight: 700; margin-bottom: 8px; cursor: pointer;">
                        <input type="checkbox" id="register-station-toggle"
                            onchange="document.getElementById('station-fields').style.display = this.checked ? 'block' : 'none'">
                        üè† ƒêƒÉng k√Ω ƒêi·ªÉm Cung c·∫•p C·ª©u tr·ª£ (C·ªë ƒë·ªãnh)
                    </label>
                    <div style="font-size: 11px; color: var(--gray-500); margin-bottom: 10px; margin-left: 20px;">
                        D√†nh cho ƒë∆°n v·ªã mu·ªën l·∫≠p ch·ªët ph√°t qu√†, n∆∞·ªõc, ch·ªó ·ªü mi·ªÖn ph√≠ t·∫°i ch·ªó.
                    </div>

                    <div id="station-fields" style="display: none; margin-left: 20px;">
                        <div style="margin-bottom: 8px; font-weight: 600; font-size: 12px;">Lo·∫°i h√¨nh h·ªó tr·ª£:</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                                <input type="checkbox" name="station-type" value="shelter"> üè† Ch·ªó ·ªü
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                                <input type="checkbox" name="station-type" value="water"> üíß N∆∞·ªõc u·ªëng
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                                <input type="checkbox" name="station-type" value="food"> üç≤ ƒê·ªì ƒÉn
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                                <input type="checkbox" name="station-type" value="medical"> üíä Y t·∫ø
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                                <input type="checkbox" name="station-type" value="charge"> ‚ö° S·∫°c ƒëi·ªán
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 12px;">ƒê·ªãa ch·ªâ ƒëi·ªÉm cung c·∫•p <span
                                    style="color: red">*</span></label>
                            <textarea class="form-input" rows="2"
                                placeholder="S·ªë nh√†, ƒë∆∞·ªùng, th√¥n/x√£... (Ghi r√µ ƒë·ªãa ƒëi·ªÉm)"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 12px;">Kh·∫£ nƒÉng ƒë√°p ·ª©ng</label>
                            <input type="text" class="form-input" placeholder="VD: 50 ng∆∞·ªùi ·ªü, 1000 su·∫•t ƒÉn/ng√†y...">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="registerVolunteer()" style="margin-bottom: 16px;">üìù ƒêƒÉng k√Ω
                    Ho·∫°t ƒë·ªông</button>

                <!-- GPS Check-in Section -->
                <div
                    style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid var(--green-500); border-radius: 12px; padding: 14px; margin-top: 8px;">
                    <div style="font-weight: 700; font-size: 14px; color: var(--green-700); margin-bottom: 8px;">üìç ƒê√£
                        ƒë·∫øn n∆°i ph√°t qu√†?</div>
                    <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 10px;">B·∫•m n√∫t d∆∞·ªõi ƒë·ªÉ x√°c nh·∫≠n
                        v·ªã tr√≠ ƒëi·ªÉm ph√°t qu√† v√† c·∫≠p nh·∫≠t l√™n h·ªá th·ªëng</div>
                    <div class="form-group" style="margin-bottom: 8px;">
                        <textarea id="volunteer-arrival-location" class="form-input" rows="2"
                            placeholder="ƒê·ªãa ch·ªâ ƒëi·ªÉm ph√°t qu√† (s·ªë nh√†, t√™n ƒë∆∞·ªùng...)"></textarea>
                    </div>
                    <button type="button" class="btn"
                        style="background: var(--green-500); color: white; width: 100%; padding: 12px;"
                        onclick="getVolunteerGPSLocation()">
                        üìç L·∫•y v·ªã tr√≠ GPS t·∫°i ƒëi·ªÉm ph√°t
                    </button>
                    <div id="volunteer-gps-status"
                        style="font-size: 11px; color: var(--gray-500); margin-top: 8px; text-align: center;"></div>

                    <!-- Photo Upload Section -->
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed var(--green-400);">
                        <div style="font-weight: 600; font-size: 13px; color: var(--green-700); margin-bottom: 8px;">üì∑
                            T·∫£i ·∫£nh ƒë·ªãa ƒëi·ªÉm ph√°t qu√†</div>
                        <label class="convoy-photo-upload" style="margin-top: 0;">
                            <input type="file" accept="image/*" capture="environment" style="display: none;"
                                onchange="handleConvoyPhotoUpload(this, 'volunteer-location')" multiple>
                            <span class="upload-icon">üì∑</span>
                            <span class="upload-text">Ch·ªçn ho·∫∑c ch·ª•p ·∫£nh ƒë·ªãa ƒëi·ªÉm</span>
                        </label>
                        <div id="volunteer-location-photos" class="convoy-photos-preview"></div>
                    </div>

                    <button type="button" class="btn btn-outline" style="width: 100%; margin-top: 12px; padding: 10px;"
                        onclick="confirmArrival()">
                        ‚úÖ X√°c nh·∫≠n ƒë√£ ƒë·∫øn n∆°i
                    </button>
                </div>

                <!-- Pilot/Guide Section -->
                <div
                    style="background: linear-gradient(135deg, #eff6ff, #dbeafe); border: 2px solid var(--blue-500); border-radius: 12px; padding: 14px; margin-top: 16px;">
                    <div style="font-weight: 700; font-size: 14px; color: var(--blue-700); margin-bottom: 8px;">üß≠ Hoa
                        ti√™u d·∫´n ƒë∆∞·ªùng</div>
                    <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">ƒêƒÉng k√Ω l√†m hoa ti√™u ho·∫∑c
                        t√¨m hoa ti√™u d·∫´n ƒë∆∞·ªùng t·∫°i ƒë·ªãa ph∆∞∆°ng</div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button onclick="openPilotRegisterModal()"
                            style="display: flex; flex-direction: column; align-items: center; gap: 6px; padding: 14px; background: white; border: 2px solid var(--blue-400); border-radius: 10px; cursor: pointer;">
                            <span style="font-size: 28px;">üôã</span>
                            <span style="font-size: 12px; font-weight: 600; color: var(--blue-700);">ƒêƒÉng k√Ω Hoa
                                ti√™u</span>
                            <span style="font-size: 10px; color: var(--gray-500);">D·∫´n ƒë∆∞·ªùng cho ƒëo√†n</span>
                        </button>
                        <button onclick="openFindPilotModal()"
                            style="display: flex; flex-direction: column; align-items: center; gap: 6px; padding: 14px; background: var(--blue-500); border: none; border-radius: 10px; cursor: pointer; color: white;">
                            <span style="font-size: 28px;">üîç</span>
                            <span style="font-size: 12px; font-weight: 600;">T√¨m Hoa ti√™u</span>
                            <span style="font-size: 10px; opacity: 0.9;">Nh·ªù d·∫´n ƒë∆∞·ªùng</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="section-title">üöó ƒêo√†n ƒëang di chuy·ªÉn</div>
            <div class="volunteer-card">
                <div class="volunteer-info">
                    <div>
                        <div class="volunteer-name">ƒêo√†n H√† N·ªôi 1</div>
                        <div class="volunteer-goods">G·∫°o 1 t·∫•n, M√¨ 500 th√πng</div>
                        <div class="volunteer-route">üìç ƒêang ƒë·∫øn: P. Vƒ©nh H·∫£i (c√≤n 15km)</div>
                    </div>
                    <span class="priority-tag low">üü¢ ƒê√∫ng tuy·∫øn</span>
                </div>
            </div>
            <div class="volunteer-card">
                <div class="volunteer-info">
                    <div>
                        <div class="volunteer-name">ƒêo√†n B·∫Øc Ninh</div>
                        <div class="volunteer-goods">Thu·ªëc y t·∫ø, S·ªØa</div>
                        <div class="volunteer-route">üìç ƒêang ƒë·∫øn: P. L·ªôc Th·ªç (c√≤n 5km)</div>
                    </div>
                    <span class="priority-tag high">‚ö†Ô∏è Khu v·ª±c ƒë√¥ng</span>
                </div>
            </div>
        </div>

        <!-- 3. Identify Screen -->
        <div class="screen" id="screen-identify">
            <div class="header-small">
                <button class="back-btn" onclick="goBackFromIdentify()">‚Üê</button>
                <h2>ƒê·ªãnh danh Minh b·∫°ch</h2>
            </div>
            <div class="card">
                <div class="card-title">ü™™ Qu√©t ƒë·ªãnh danh ng∆∞·ªùi nh·∫≠n</div>
                <p style="font-size: 12px; color: var(--gray-600); line-height: 1.5;">Qu√©t m√£ QR tr√™n CCCD/VNeID/BHYT ƒë·ªÉ
                    ghi nh·∫≠n
                    l·ªãch s·ª≠, ƒë·∫£m b·∫£o ph√¢n ph·ªëi c√¥ng b·∫±ng.</p>
            </div>

            <!-- Camera container for QR scanning -->
            <div class="scanner-area" id="scanner-area">
                <div id="qr-reader"></div>
                <div class="scanner-frame" id="scanner-placeholder">
                    <div class="scanner-line"></div>
                </div>
            </div>

            <div style="text-align: center; padding: 0 16px;">
                <p style="color: var(--gray-500); font-size: 12px; margin-bottom: 12px;" id="scan-instruction">Nh·∫•n n√∫t
                    b√™n d∆∞·ªõi ƒë·ªÉ m·ªü camera qu√©t m√£ QR</p>
                <button class="btn btn-primary" id="btn-start-scan" onclick="startQRScanner()">üì∑ M·ªü Camera Qu√©t
                    QR</button>
                <button class="btn btn-outline hidden" id="btn-stop-scan" onclick="stopQRScanner()"
                    style="margin-top: 10px;">‚èπÔ∏è D·ª´ng Qu√©t</button>
            </div>

            <!-- Already received warning banner -->
            <div class="already-received-banner hidden" id="already-received">
                <div class="icon">üö´</div>
                <div class="title">ƒê√É NH·∫¨N QU√Ä R·ªíI!</div>
                <div class="description" id="already-received-detail">M√£ n√†y ƒë√£ ƒë∆∞·ª£c nh·∫≠n qu√† tr∆∞·ªõc ƒë√≥. Kh√¥ng th·ªÉ nh·∫≠n
                    th√™m.</div>
                <button class="btn" style="background: var(--gray-200); color: var(--gray-700); margin-top: 12px;"
                    onclick="resetScan()">  Qu√©t m√£ kh√°c</button>
            </div>

            <!-- Scan result for new recipients -->
            <div class="scanned-result hidden" id="scan-result">
                <div style="font-size: 12px; color: var(--gray-500); margin-bottom: 6px;">M√£ ƒë√£ qu√©t (12 s·ªë ƒë·∫ßu):</div>
                <div class="scanned-number" id="scanned-cccd">012345678901</div>
                <div style="margin-top: 8px; padding: 10px; background: var(--green-50); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--green-600);">‚úÖ M√£ n√†y ch∆∞a nh·∫≠n qu√† - C√≥ th·ªÉ ph√°t qu√†!
                    </div>
                </div>
                <button class="btn btn-primary" style="margin-top: 12px;" onclick="confirmGift()">‚úÖ X√°c nh·∫≠n ph√°t
                    qu√†</button>
                <button class="btn btn-outline" style="margin-top: 8px;" onclick="resetScan()">üîÑ Qu√©t m√£ kh√°c</button>
            </div>

            <!-- Gift receiving instructions -->
            <div class="card" style="margin-top: 16px;">
                <div class="card-title">  H∆∞·ªõng d·∫´n nh·∫≠n qu√†</div>
                <div style="font-size: 12px; color: var(--gray-600); line-height: 1.6;">
                    <p style="margin-bottom: 8px;">1. ƒê∆∞a m√£ QR tr√™n CCCD/VNeID/BHYT v√†o khung qu√©t</p>
                    <p style="margin-bottom: 8px;">2. Ch·ªù h·ªá th·ªëng x√°c nh·∫≠n m√£ h·ª£p l·ªá</p>
                    <p style="margin-bottom: 8px;">3. Nh·∫≠n qu√† t·ª´ t√¨nh nguy·ªán vi√™n</p>
                </div>
                <div
                    style="background: var(--red-50); border: 2px solid var(--red-500); border-radius: 8px; padding: 10px; margin-top: 12px;">
                    <div style="color: var(--red-600); font-weight: 700; font-size: 13px; text-align: center;">
                        üö´ CH√ö √ù: M·ªñI M√É CH·ªà ƒê∆Ø·ª¢C NH·∫¨N QU√Ä 1 L·∫¶N DUY NH·∫§T!
                    </div>
                    <div style="color: var(--red-500); font-size: 11px; text-align: center; margin-top: 4px;">
                        H·ªá th·ªëng s·∫Ω t·ª´ ch·ªëi n·∫øu m√£ ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng tr∆∞·ªõc ƒë√≥.
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Case Screen -->
        <div class="screen" id="screen-add">
            <div
                style="background: linear-gradient(135deg, var(--red-500), var(--red-600)); color: white; padding: 16px; margin: 16px; border-radius: 14px; display: flex; align-items: center; gap: 12px;">
                <div style="font-size: 28px;">üÜò</div>
                <div style="font-size: 18px; font-weight: 700;">B√°o c√°o ca c·ª©u tr·ª£</div>
            </div>
            <div style="padding: 0 16px 16px;">
                <div class="form-group">
                    <label class="form-label">T√™n ch·ªß h·ªô <span style="color: var(--red-500);">*</span></label>
                    <input type="text" id="case-name" class="form-input" placeholder="Nguy·ªÖn VƒÉn A">
                </div>
                <div class="form-group">
                    <label class="form-label">S·ªë ƒëi·ªán tho·∫°i <span style="color: var(--red-500);">*</span></label>
                    <input type="tel" id="case-phone" class="form-input" placeholder="0912 345 678">
                </div>

                <div class="form-group">
                    <label class="form-label">ƒê·ªãa ch·ªâ <span style="color: var(--red-500);">*</span></label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button id="btn-addr-me" onclick="toggleCaseAddressMode('me')" class="btn"
                            style="flex: 1; background: var(--blue-500); color: white; padding: 8px; font-size: 12px;">üë§
                            Cho m√¨nh (GPS)</button>
                        <button id="btn-addr-relative" onclick="toggleCaseAddressMode('relative')" class="btn"
                            style="flex: 1; background: white; border: 1px solid var(--gray-300); color: var(--gray-700); padding: 8px; font-size: 12px;">üë•
                            Cho ng∆∞·ªùi th√¢n</button>
                    </div>

                    <!-- Mode: Me (GPS) -->
                    <div id="addr-mode-me" style="display: block;">
                        <textarea id="case-address" class="form-input" rows="2" placeholder="ƒêang l·∫•y v·ªã tr√≠..."
                            readonly style="background: #f3f4f6; color: #666;"></textarea>
                        <div id="gps-status" style="font-size: 11px; color: var(--blue-500); margin-top: 6px;">üìç ƒêang
                            t·ª± ƒë·ªông l·∫•y v·ªã tr√≠...</div>
                    </div>

                    <!-- Mode: Relative (Structured) -->
                    <div id="addr-mode-relative"
                        style="display: none; background: #f9fafb; padding: 10px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <input type="hidden" id="case-address-final">
                        <!-- Store combined address here if in relative mode -->
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label style="font-size: 11px; color: #666;">T·ªânh / Th√†nh ph·ªë</label>
                            <input type="text" id="addr-province" class="form-input" placeholder="Kh√°nh H√≤a"
                                oninput="updateCaseAddressFromFields()">
                        </div>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label style="font-size: 11px; color: #666;">Qu·∫≠n / Huy·ªán</label>
                            <input type="text" id="addr-district" class="form-input" placeholder="TP. Nha Trang"
                                oninput="updateCaseAddressFromFields()">
                        </div>
                        <div class="form-group" style="margin-bottom: 8px;">
                            <label style="font-size: 11px; color: #666;">Ph∆∞·ªùng / X√£</label>
                            <input type="text" id="addr-ward" class="form-input" placeholder="P. L·ªôc Th·ªç"
                                oninput="updateCaseAddressFromFields()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 11px; color: #666;">S·ªë nh√† / ƒê∆∞·ªùng</label>
                            <input type="text" id="addr-street" class="form-input" placeholder="S·ªë 15, ƒê∆∞·ªùng Tr·∫ßn Ph√∫"
                                oninput="updateCaseAddressFromFields()">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ngu·ªìn th√¥ng tin <span style="color: var(--red-500);">*</span></label>
                    <select id="case-source" class="form-input">
                        <option value="">-- Ch·ªçn ngu·ªìn th√¥ng tin --</option>
                        <option value="facebook">Facebook</option>
                        <option value="zalo">Zalo</option>
                        <option value="local">Danh s√°ch ƒë·ªãa ph∆∞∆°ng</option>
                        <option value="citizen">Ng∆∞·ªùi d√¢n b√°o</option>
                    </select>
                </div>
                <p style="font-size: 11px; color: var(--gray-500); margin-bottom: 12px;">
                    <span style="color: var(--red-500);">*</span> T·∫•t c·∫£ c√°c tr∆∞·ªùng ƒë·ªÅu b·∫Øt bu·ªôc ph·∫£i ƒëi·ªÅn
                </p>
                <button class="btn btn-danger" onclick="submitCase()" style="margin-bottom: 10px;">üÜò G·ª≠i b√°o
                    c√°o</button>

                <!-- SMS Auto-send Section -->
                <div
                    style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); border: 2px solid var(--blue-500); border-radius: 12px; padding: 14px; margin-top: 8px;">
                    <div style="font-weight: 700; font-size: 14px; color: var(--blue-700); margin-bottom: 8px;">üì± G·ª≠i
                        SMS b√°o c√°o nhanh</div>
                    <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 10px;">B·∫•m n√∫t d∆∞·ªõi ƒë·ªÉ t·ª± ƒë·ªông
                        m·ªü ·ª©ng d·ª•ng Tin nh·∫Øn v·ªõi n·ªôi dung b√°o c√°o so·∫°n s·∫µn</div>

                    <!-- SMS Template Preview -->
                    <div
                        style="background: white; border-radius: 8px; padding: 10px; margin-bottom: 10px; font-size: 11px; color: var(--gray-700); line-height: 1.5;">
                        <strong>M·∫´u tin nh·∫Øn:</strong><br>
                        <span style="color: var(--gray-500);">
                            [C·ª®U TR·ª¢ KH·∫®N C·∫§P]<br>
                            T√™n: <span style="color: var(--blue-600);">{T√™n ch·ªß h·ªô}</span><br>
                            SƒêT: <span style="color: var(--blue-600);">{S·ªë ƒëi·ªán tho·∫°i}</span><br>
                            ƒê·ªãa ch·ªâ: <span style="color: var(--blue-600);">{ƒê·ªãa ch·ªâ}</span><br>
                            Ngu·ªìn: <span style="color: var(--blue-600);">{Ngu·ªìn th√¥ng tin}</span>
                        </span>
                    </div>

                    <button type="button" class="btn"
                        style="background: var(--blue-500); color: white; width: 100%; padding: 12px; font-size: 14px;"
                        onclick="sendSMSReport()">
                        üì§ G·ª≠i SMS ƒë·∫øn 0342381843
                    </button>
                    <div style="font-size: 10px; color: var(--gray-500); margin-top: 6px; text-align: center;">
                        S·∫Ω t·ª± ƒë·ªông m·ªü ·ª©ng d·ª•ng Tin nh·∫Øn tr√™n ƒëi·ªán tho·∫°i
                    </div>
                </div>
            </div>
        </div>

        <!-- Tra c·ª©u (Lookup) Screen - 10 Nha Trang Locations -->
        <div class="screen" id="screen-case-list">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('home')">‚Üê</button>
                <h2>üîç Tra c·ª©u H·ªô d√¢n</h2>
            </div>
            <div class="card">
                <div class="card-title">üìç Ch·ªçn khu v·ª±c t·∫°i Nha Trang</div>
                <p style="font-size: 12px; color: var(--gray-600);">10 khu v·ª±c ƒë∆∞·ª£c s·∫Øp x·∫øp theo m·ª©c ƒë·ªô kh·∫©n c·∫•p. B·∫•m
                    v√†o ƒë·ªÉ xem danh s√°ch h·ªô d√¢n.</p>
            </div>

            <!-- Region 1: Critical -->
            <div class="region-card critical" onclick="showRegionDetail('vinh-luong')">
                <div class="region-header">
                    <div class="region-name">üî¥ X√£ Vƒ©nh L∆∞∆°ng</div>
                    <div class="region-badge critical">C·ª±c k·ª≥ kh·∫©n c·∫•p</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">üö® <span>Ch∆∞a c√≥ ƒëo√†n</span></div>
                    <div class="region-stat">üíß <span>Ng·∫≠p 2.5m</span></div>
                </div>
            </div>

            <!-- Region 2: Critical -->
            <div class="region-card critical" onclick="showRegionDetail('vinh-hai')">
                <div class="region-header">
                    <div class="region-name">üî¥ Ph∆∞·ªùng Vƒ©nh H·∫£i</div>
                    <div class="region-badge critical">C·ª±c k·ª≥ kh·∫©n c·∫•p</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">üöí <span>1 ƒëo√†n c·ª©u h·ªô</span></div>
                    <div class="region-stat">üíß <span>Ng·∫≠p 2m</span></div>
                </div>
            </div>

            <!-- Region 3: High -->
            <div class="region-card high" onclick="showRegionDetail('vinh-ngoc')">
                <div class="region-header">
                    <div class="region-name">üü† Ph∆∞·ªùng Vƒ©nh Ng·ªçc</div>
                    <div class="region-badge high">Kh·∫©n c·∫•p cao</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">üöõ <span>1 ƒëo√†n ƒëang ƒë·∫øn</span></div>
                    <div class="region-stat">üíß <span>Ng·∫≠p 1.5m</span></div>
                </div>
            </div>

            <!-- Region 4: High -->
            <div class="region-card high" onclick="showRegionDetail('vinh-tho')">
                <div class="region-header">
                    <div class="region-name">üü† Ph∆∞·ªùng Vƒ©nh Th·ªç</div>
                    <div class="region-badge high">Kh·∫©n c·∫•p cao</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">üè• <span>C·∫ßn thu·ªëc y t·∫ø</span></div>
                    <div class="region-stat">üíß <span>Ng·∫≠p 1.2m</span></div>
                </div>
            </div>

            <!-- Region 5: Medium -->
            <div class="region-card medium" onclick="showRegionDetail('phuoc-hai')">
                <div class="region-header">
                    <div class="region-name">üü° Ph∆∞·ªùng Ph∆∞·ªõc H·∫£i</div>
                    <div class="region-badge medium">C·∫ßn h·ªó tr·ª£</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">üç≤ <span>Thi·∫øu l∆∞∆°ng th·ª±c</span></div>
                    <div class="region-stat">üíß <span>Ng·∫≠p 1m</span></div>
                </div>
            </div>

            <!-- Region 6: Medium -->
            <div class="region-card medium" onclick="showRegionDetail('loc-tho')">
                <div class="region-header">
                    <div class="region-name">üü° Ph∆∞·ªùng L·ªôc Th·ªç</div>
                    <div class="region-badge medium">C·∫ßn h·ªó tr·ª£</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">üöõ <span>2 ƒëo√†n ƒë√£ ƒë·∫øn</span></div>
                    <div class="region-stat">üíß <span>Ng·∫≠p 0.8m</span></div>
                </div>
            </div>

            <!-- Region 7: Low -->
            <div class="region-card low" onclick="showRegionDetail('phuoc-long')">
                <div class="region-header">
                    <div class="region-name">üü¢ Ph∆∞·ªùng Ph∆∞·ªõc Long</div>
                    <div class="region-badge low">ƒêang theo d√µi</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">‚úÖ <span>ƒê√£ h·ªó tr·ª£ m·ªôt ph·∫ßn</span></div>
                    <div class="region-stat">üíß <span>N∆∞·ªõc r√∫t d·∫ßn</span></div>
                </div>
            </div>

            <!-- Region 8: Low -->
            <div class="region-card low" onclick="showRegionDetail('vinh-nguyen')">
                <div class="region-header">
                    <div class="region-name">üü¢ Ph∆∞·ªùng Vƒ©nh Nguy√™n</div>
                    <div class="region-badge low">ƒêang theo d√µi</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">‚úÖ <span>ƒê√£ h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß</span></div>
                    <div class="region-stat">üíß <span>N∆∞·ªõc r√∫t</span></div>
                </div>
            </div>

            <!-- Region 9: Safe -->
            <div class="region-card safe" onclick="showRegionDetail('phuoc-tien')">
                <div class="region-header">
                    <div class="region-name">üîµ Ph∆∞·ªùng Ph∆∞·ªõc Ti·∫øn</div>
                    <div class="region-badge safe">An to√†n</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">‚úÖ <span>ƒê√£ ·ªïn ƒë·ªãnh</span></div>
                    <div class="region-stat">üíß <span>Kh√¥ng ng·∫≠p</span></div>
                </div>
            </div>

            <!-- Region 10: Safe -->
            <div class="region-card safe" onclick="showRegionDetail('tan-lap')">
                <div class="region-header">
                    <div class="region-name">üîµ Ph∆∞·ªùng T√¢n L·∫≠p</div>
                    <div class="region-badge safe">An to√†n</div>
                </div>
                <div class="region-stats">
                    <div class="region-stat">üë• <span>20 h·ªô</span></div>
                    <div class="region-stat">‚úÖ <span>Ho√†n to√†n ·ªïn ƒë·ªãnh</span></div>
                    <div class="region-stat">üíß <span>Kh√¥ng ng·∫≠p</span></div>
                </div>
            </div>
        </div>

        <!-- Household Detail Screen with Search -->
        <div class="screen" id="screen-household-detail">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('case-list')">‚Üê</button>
                <h2 id="region-detail-title">Danh s√°ch h·ªô d√¢n</h2>
            </div>

            <!-- Search Bar -->
            <div
                style="padding: 12px 16px; background: white; border-bottom: 1px solid var(--gray-200); position: sticky; top: 0; z-index: 10;">
                <div style="position: relative;">
                    <input type="text" id="household-search" class="form-input"
                        placeholder="üîç T√¨m ki·∫øm t√™n ng∆∞·ªùi th√¢n..." oninput="filterHouseholds(this.value)"
                        style="padding-left: 16px; padding-right: 40px;">
                    <button onclick="document.getElementById('household-search').value=''; filterHouseholds('');"
                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 16px; cursor: pointer; color: var(--gray-400);">‚úï</button>
                </div>
                <div id="search-result-count"
                    style="font-size: 11px; color: var(--gray-500); margin-top: 6px; text-align: center;"></div>
            </div>

            <!-- Region Summary Card -->
            <div class="card" id="region-summary" style="margin-top: 8px;">
                <!-- Populated by JS -->
            </div>

            <!-- Stats Summary -->
            <div
                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 0 16px; margin-bottom: 12px;">
                <div id="stat-pending"
                    style="text-align: center; padding: 8px; background: #fef2f2; border-radius: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #dc2626;">0</div>
                    <div style="font-size: 9px; color: #dc2626;">Ch∆∞a c·ª©u</div>
                </div>
                <div id="stat-inprogress"
                    style="text-align: center; padding: 8px; background: #fef3c7; border-radius: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #d97706;">0</div>
                    <div style="font-size: 9px; color: #d97706;">ƒêang c·ª©u</div>
                </div>
                <div id="stat-rescued"
                    style="text-align: center; padding: 8px; background: #f0fdf4; border-radius: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #16a34a;">0</div>
                    <div style="font-size: 9px; color: #16a34a;">ƒê√£ c·ª©u</div>
                </div>
                <div id="stat-safe" style="text-align: center; padding: 8px; background: #dbeafe; border-radius: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #2563eb;">0</div>
                    <div style="font-size: 9px; color: #2563eb;">An to√†n</div>
                </div>
            </div>

            <div class="section-title">üìã Danh s√°ch 20 h·ªô trong khu v·ª±c</div>
            <div style="padding: 0 16px;" id="household-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Profile Screen -->
        <div class="screen" id="screen-profile">
            <div class="profile-header">
                <div class="profile-avatar">üë§</div>
                <div class="profile-name">T√¨nh Nguy·ªán Vi√™n</div>
                <div class="profile-email">volunteer@relief.vn</div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value">45</div>
                    <div class="profile-stat-label">Cu·ªôc g·ªçi</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value">120</div>
                    <div class="profile-stat-label">H·ªô ph√°t qu√†</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value">8h</div>
                    <div class="profile-stat-label">Th·ªùi gian</div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">üì± Th√¥ng tin</div>
                <div style="font-size: 13px;">
                    <div style="color: var(--gray-500);">Vai tr√≤</div>
                    <div style="font-weight: 600;">T√¨nh nguy·ªán vi√™n g·ªçi ƒëi·ªán</div>
                </div>
            </div>
            <div style="padding: 16px;"><button class="btn" style="background: var(--red-100); color: var(--red-600);"
                    onclick="showScreen('login'); showToast('ƒê√£ ƒëƒÉng xu·∫•t')">üö™ ƒêƒÉng xu·∫•t</button></div>
        </div>

        <!-- News Screen -->
        <div class="screen" id="screen-news">
            <div class="header-small">
                <button class="back-btn" onclick="showScreen('home')">‚Üê</button>
                <h2>Tin t·ª©c & M·∫πo sinh t·ªìn</h2>
            </div>

            <!-- Windy Map -->
            <!-- Windy Map -->
            <div id="windy">
                <iframe width="100%" height="100%"
                    src="https://embed.windy.com/embed2.html?lat=12.253&lon=109.190&detailLat=12.253&detailLon=109.190&width=650&height=450&zoom=6&level=surface&overlay=wind&product=ecmwf&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1"
                    frameborder="0"></iframe>
            </div>


            <!-- Dam Status Section -->
            <div style="padding: 16px; padding-bottom: 0;">
                <div
                    style="background: linear-gradient(135deg, #1e40af, #3b82f6); border-radius: 14px; padding: 16px; margin-bottom: 16px; color: white;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="font-size: 28px;">‚ö°</span>
                        <div>
                            <div style="font-weight: 700; font-size: 16px;">T√¨nh tr·∫°ng ƒê·∫≠p Th·ªßy ƒëi·ªán</div>
                            <div style="font-size: 11px; opacity: 0.9;">C·∫≠p nh·∫≠t: 30/01/2026 - 13:00</div>
                        </div>
                    </div>

                    <!-- Dam 1 - Critical -->
                    <div
                        style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600;">üî¥ ƒê·∫≠p S√¥ng C√°i</span>
                            <span
                                style="background: #ef4444; padding: 3px 8px; border-radius: 10px; font-size: 10px; font-weight: 700;">X·∫¢
                                L≈®</span>
                        </div>
                        <div style="font-size: 11px; opacity: 0.9;">M·ª±c n∆∞·ªõc: 98.5m (Gi·ªõi h·∫°n: 100m) | L∆∞u l∆∞·ª£ng x·∫£:
                            2500 m¬≥/s</div>
                    </div>

                    <!-- Dam 2 - Warning -->
                    <div
                        style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600;">üü° ƒê·∫≠p Eakrong Rou</span>
                            <span
                                style="background: #eab308; padding: 3px 8px; border-radius: 10px; font-size: 10px; font-weight: 700; color: #000;">C·∫¢NH
                                B√ÅO</span>
                        </div>
                        <div style="font-size: 11px; opacity: 0.9;">M·ª±c n∆∞·ªõc: 85.2m (Gi·ªõi h·∫°n: 95m) | ƒêang theo d√µi
                        </div>
                    </div>

                    <!-- Dam 3 - Normal -->
                    <div style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 12px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600;">üü¢ ƒê·∫≠p ƒêa Nhim</span>
                            <span
                                style="background: #22c55e; padding: 3px 8px; border-radius: 10px; font-size: 10px; font-weight: 700;">B√åNH
                                TH∆Ø·ªúNG</span>
                        </div>
                        <div style="font-size: 11px; opacity: 0.9;">M·ª±c n∆∞·ªõc: 72.0m (Gi·ªõi h·∫°n: 90m) | Ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh
                        </div>
                    </div>
                </div>
            </div>

            <!-- Survival Tips Section -->
            <div style="padding: 0 16px;">
                <div style="font-weight: 700; font-size: 15px; color: var(--gray-800); margin-bottom: 12px;">üõü M·∫πo sinh
                    t·ªìn khi b√£o l≈©</div>

                <div
                    style="background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; padding: 14px; margin-bottom: 12px; border-left: 4px solid #f59e0b;">
                    <div style="font-weight: 600; font-size: 13px; color: #92400e; margin-bottom: 6px;">üè† Khi ·ªü trong
                        nh√†</div>
                    <ul style="font-size: 12px; color: #78350f; padding-left: 18px; margin: 0; line-height: 1.6;">
                        <li>Di chuy·ªÉn l√™n t·∫ßng cao, mang theo n∆∞·ªõc u·ªëng v√† ƒë√®n pin</li>
                        <li>T·∫Øt ngu·ªìn ƒëi·ªán v√† gas ƒë·ªÉ tr√°nh nguy hi·ªÉm</li>
                        <li>L∆∞u s·ªë ƒëi·ªán tho·∫°i kh·∫©n c·∫•p: 113, 114, 115</li>
                    </ul>
                </div>

                <div
                    style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-radius: 12px; padding: 14px; margin-bottom: 12px; border-left: 4px solid #22c55e;">
                    <div style="font-weight: 600; font-size: 13px; color: #166534; margin-bottom: 6px;">üåä Khi di chuy·ªÉn
                        qua v√πng ng·∫≠p</div>
                    <ul style="font-size: 12px; color: #14532d; padding-left: 18px; margin: 0; line-height: 1.6;">
                        <li>D√πng g·∫≠y d√≤ ƒë∆∞·ªùng ƒë·ªÉ tr√°nh h·ªë s√¢u</li>
                        <li>Kh√¥ng ƒëi qua n∆°i n∆∞·ªõc ch·∫£y xi·∫øt</li>
                        <li>Gi·ªØ tr·∫ª em v√† ng∆∞·ªùi gi√† ·ªü gi·ªØa ƒëo√†n</li>
                    </ul>
                </div>

                <div
                    style="background: linear-gradient(135deg, #fee2e2, #fecaca); border-radius: 12px; padding: 14px; margin-bottom: 12px; border-left: 4px solid #ef4444;">
                    <div style="font-weight: 600; font-size: 13px; color: #991b1b; margin-bottom: 6px;">‚ö†Ô∏è C·∫£nh b√°o nguy
                        hi·ªÉm</div>
                    <ul style="font-size: 12px; color: #7f1d1d; padding-left: 18px; margin: 0; line-height: 1.6;">
                        <li>Tuy·ªát ƒë·ªëi kh√¥ng b∆°i qua v√πng n∆∞·ªõc l≈©</li>
                        <li>Tr√°nh xa c·ªôt ƒëi·ªán, d√¢y ƒëi·ªán b·ªã ƒë·ªï</li>
                        <li>Kh√¥ng ƒÉn th·ª±c ph·∫©m ƒë√£ ng√¢m n∆∞·ªõc l≈©</li>
                    </ul>
                </div>
            </div>

            <!-- News & Announcements -->
            <div style="padding: 16px;">
                <div style="font-weight: 700; font-size: 15px; color: var(--gray-800); margin-bottom: 12px;">üì¢ Tin t·ª©c
                    c·ª©u tr·ª£</div>

                <div
                    style="background: white; border-radius: 12px; padding: 14px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                        <span style="font-size: 18px;">üö®</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--red-600);">C·∫£nh b√°o m∆∞a l·ªõn ti·∫øp
                                t·ª•c</div>
                            <div style="font-size: 10px; color: var(--gray-500);">30 ph√∫t tr∆∞·ªõc</div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-700); line-height: 1.5;">D·ª± b√°o m∆∞a l·ªõn 100-200mm t·∫°i
                        Nha Trang trong 24h t·ªõi. Ng∆∞·ªùi d√¢n v√πng tr≈©ng c·∫ßn di chuy·ªÉn ƒë·∫øn n∆°i an to√†n.</div>
                </div>

                <div
                    style="background: white; border-radius: 12px; padding: 14px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                        <span style="font-size: 18px;">‚úÖ</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--green-600);">ƒêo√†n c·ª©u tr·ª£ TP.HCM
                                ƒë√£ ƒë·∫øn</div>
                            <div style="font-size: 10px; color: var(--gray-500);">1 gi·ªù tr∆∞·ªõc</div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-700); line-height: 1.5;">ƒêo√†n ƒë√£ ph√°t 500 ph·∫ßn qu√†
                        t·∫°i P. Vƒ©nh H·∫£i. Ti·∫øp t·ª•c di chuy·ªÉn ƒë·∫øn P. L·ªôc Th·ªç ƒë·ªÉ h·ªó tr·ª£.</div>
                </div>

                <div
                    style="background: white; border-radius: 12px; padding: 14px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                        <span style="font-size: 18px;">üìç</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--blue-600);">ƒêi·ªÉm t·∫≠p trung di
                                d·ªùi m·ªõi</div>
                            <div style="font-size: 10px; color: var(--gray-500);">2 gi·ªù tr∆∞·ªõc</div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-700); line-height: 1.5;">Tr∆∞·ªùng THPT Tr·∫ßn Ph√∫ ƒë∆∞·ª£c s·ª≠
                        d·ª•ng l√†m ƒëi·ªÉm t·∫≠p trung cho b√† con P. L·ªôc Th·ªç. C√≥ b·∫øp ƒÉn mi·ªÖn ph√≠.</div>
                </div>

                <div
                    style="background: white; border-radius: 12px; padding: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                        <span style="font-size: 18px;">üíä</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--orange-600);">Th√¥ng b√°o c·∫•p
                                thu·ªëc y t·∫ø</div>
                            <div style="font-size: 10px; color: var(--gray-500);">3 gi·ªù tr∆∞·ªõc</div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-700); line-height: 1.5;">Tr·∫°m Y t·∫ø P. Vƒ©nh Nguy√™n
                        ho·∫°t ƒë·ªông 24/7, c·∫•p thu·ªëc mi·ªÖn ph√≠ cho ng∆∞·ªùi d√¢n v√πng l≈©.</div>
                </div>
            </div>
        </div>

        <!-- Notification Panel Modal -->
        <div id="notification-modal" class="modal-overlay" style="display: none;">
            <div
                style="background: white; border-radius: 20px 20px 0 0; position: absolute; bottom: 0; left: 0; right: 0; max-height: 85vh; overflow-y: auto; animation: slideUp 0.3s ease;">
                <div
                    style="padding: 16px; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: white; z-index: 10;">
                    <div>
                        <div style="font-weight: 700; font-size: 16px; color: var(--gray-800);">üîî Th√¥ng b√°o</div>
                        <div style="font-size: 11px; color: var(--gray-500);">8 th√¥ng b√°o m·ªõi</div>
                    </div>
                    <button onclick="closeNotificationPanel()"
                        style="background: var(--gray-100); border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 18px;">‚úï</button>
                </div>

                <div style="padding: 16px;">
                    <!-- Header: For Convoy Teams -->
                    <div style="font-weight: 600; font-size: 13px; color: var(--gray-700); margin-bottom: 12px;">üöõ
                        Th√¥ng b√°o cho ƒêo√†n c·ª©u tr·ª£/c·ª©u h·ªô</div>

                    <!-- Critical: Area Overload Alert -->
                    <div
                        style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 2px solid var(--red-500); border-radius: 14px; padding: 14px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 20px;">üö®</span>
                            <div style="flex: 1;">
                                <div style="font-weight: 700; font-size: 13px; color: var(--red-700);">KHU V·ª∞C QU√Å T·∫¢I
                                </div>
                                <div style="font-size: 10px; color: var(--red-600);">2 ph√∫t tr∆∞·ªõc</div>
                            </div>
                        </div>
                        <div style="background: white; border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                            <div style="font-size: 12px; color: var(--gray-700); line-height: 1.6;">
                                <strong style="color: var(--red-600);">P. L·ªôc Th·ªç</strong> hi·ªán ƒë√£ c√≥ <strong>10
                                    ƒëo√†n</strong> ƒëang ho·∫°t ƒë·ªông.<br>
                                üëâ ƒê·ªÅ ngh·ªã chuy·ªÉn h∆∞·ªõng ƒë·∫øn <strong style="color: var(--green-600);">P. Vƒ©nh
                                    H·∫£i</strong> ho·∫∑c <strong style="color: var(--green-600);">X√£ Vƒ©nh L∆∞∆°ng</strong>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <button onclick="showScreen('map'); closeNotificationPanel();"
                                style="background: var(--blue-500); color: white; border: none; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer;">
                                üó∫Ô∏è Xem b·∫£n ƒë·ªì
                            </button>
                            <button onclick="showToast('‚úÖ ƒê√£ x√°c nh·∫≠n chuy·ªÉn h∆∞·ªõng'); closeNotificationPanel();"
                                style="background: var(--green-500); color: white; border: none; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer;">
                                ‚úÖ ƒê√£ hi·ªÉu
                            </button>
                        </div>
                    </div>

                    <!-- Area Status Summary Card -->
                    <div
                        style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 14px; padding: 14px; margin-bottom: 12px;">
                        <div style="font-weight: 600; font-size: 13px; color: #1e40af; margin-bottom: 10px;">üìä Th·ªëng k√™
                            ph√¢n b·ªï ƒëo√†n theo khu v·ª±c</div>

                        <!-- Area 1 - Overloaded -->
                        <div
                            style="background: white; border-radius: 8px; padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; font-size: 12px; color: var(--gray-800);">P. L·ªôc Th·ªç</div>
                                <div style="font-size: 10px; color: var(--red-500);">üî¥ ƒê√£ qu√° t·∫£i</div>
                            </div>
                            <div
                                style="background: var(--red-100); color: var(--red-600); padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 700;">
                                10 ƒëo√†n</div>
                        </div>

                        <!-- Area 2 - Need more -->
                        <div
                            style="background: white; border-radius: 8px; padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; font-size: 12px; color: var(--gray-800);">P. Vƒ©nh H·∫£i
                                </div>
                                <div style="font-size: 10px; color: var(--yellow-600);">üü° C·∫ßn th√™m h·ªó tr·ª£</div>
                            </div>
                            <div
                                style="background: var(--yellow-100); color: var(--yellow-700); padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 700;">
                                2 ƒëo√†n</div>
                        </div>

                        <!-- Area 3 - Urgent -->
                        <div
                            style="background: white; border-radius: 8px; padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 2px solid var(--green-500);">
                            <div>
                                <div style="font-weight: 600; font-size: 12px; color: var(--gray-800);">X√£ Vƒ©nh L∆∞∆°ng
                                </div>
                                <div style="font-size: 10px; color: var(--green-600);">üü¢ ∆ØU TI√äN ƒê·∫æN ƒê√ÇY</div>
                            </div>
                            <div
                                style="background: var(--green-500); color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 700;">
                                0 ƒëo√†n</div>
                        </div>

                        <!-- Area 4 -->
                        <div
                            style="background: white; border-radius: 8px; padding: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; font-size: 12px; color: var(--gray-800);">P. Ph∆∞·ªõc H·∫£i
                                </div>
                                <div style="font-size: 10px; color: var(--gray-500);">ƒê·ªß h·ªó tr·ª£</div>
                            </div>
                            <div
                                style="background: var(--gray-100); color: var(--gray-600); padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 700;">
                                5 ƒëo√†n</div>
                        </div>
                    </div>

                    <!-- Routing Suggestion -->
                    <div
                        style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid var(--green-500); border-radius: 14px; padding: 14px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 20px;">üß≠</span>
                            <div style="flex: 1;">
                                <div style="font-weight: 700; font-size: 13px; color: var(--green-700);">ƒê·ªÄ XU·∫§T L·ªò
                                    TR√åNH T·ªêI ∆ØU</div>
                                <div style="font-size: 10px; color: var(--green-600);">5 ph√∫t tr∆∞·ªõc</div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--gray-700); line-height: 1.6;">
                            ƒêo√†n ƒëang ·ªü <strong>P. L·ªôc Th·ªç</strong>? H√£y di chuy·ªÉn ƒë·∫øn:<br><br>
                            üìç <strong>X√£ Vƒ©nh L∆∞∆°ng</strong> - 12km v·ªÅ ph√≠a B·∫Øc<br>
                            <span style="font-size: 11px; color: var(--gray-500);">40 h·ªô ch∆∞a ƒë∆∞·ª£c h·ªó tr·ª£, ng·∫≠p
                                1.5m</span>
                        </div>
                        <button onclick="showScreen('map'); closeNotificationPanel();"
                            style="width: 100%; background: var(--green-600); color: white; border: none; padding: 12px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; margin-top: 10px;">
                            üó∫Ô∏è Xem ƒë∆∞·ªùng ƒëi tr√™n b·∫£n ƒë·ªì
                        </button>
                    </div>

                    <!-- Other Notifications -->
                    <div style="font-weight: 600; font-size: 13px; color: var(--gray-700); margin: 16px 0 12px;">üì¢
                        Th√¥ng b√°o kh√°c</div>

                    <div
                        style="background: white; border-radius: 12px; padding: 14px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <span style="font-size: 16px;">üöõ</span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--blue-600);">ƒêo√†n H√† N·ªôi ƒë√£
                                    ƒë·∫øn P. Vƒ©nh Nguy√™n</div>
                                <div style="font-size: 10px; color: var(--gray-500);">15 ph√∫t tr∆∞·ªõc</div>
                            </div>
                        </div>
                    </div>

                    <div
                        style="background: white; border-radius: 12px; padding: 14px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <span style="font-size: 16px;">‚ö°</span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--red-600);">ƒê·∫≠p S√¥ng C√°i ƒëang
                                    x·∫£ l≈©</div>
                                <div style="font-size: 10px; color: var(--gray-500);">30 ph√∫t tr∆∞·ªõc</div>
                            </div>
                        </div>
                    </div>

                    <div
                        style="background: white; border-radius: 12px; padding: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <span style="font-size: 16px;">üè•</span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--green-600);">Tr·∫°m y t·∫ø P.
                                    Vƒ©nh Nguy√™n ho·∫°t ƒë·ªông 24/7</div>
                                <div style="font-size: 10px; color: var(--gray-500);">1 gi·ªù tr∆∞·ªõc</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav" id="bottom-nav">
            <button class="nav-item active" onclick="navTo('home')"><span class="icon">üè†</span><span>Trang
                    ch·ªß</span></button>
            <button class="nav-item" onclick="navTo('map')"><span class="icon">üó∫Ô∏è</span><span>B·∫£n ƒë·ªì</span></button>
            <button class="nav-item" onclick="navTo('add')"><span class="icon">‚ûï</span><span>Th√™m ca</span></button>
            <button class="nav-item" onclick="navTo('identify')"><span class="icon">ü™™</span><span>ƒê·ªãnh
                    danh</span></button>
            <button class="nav-item" onclick="navTo('news')"><span class="icon">üì∞</span><span>Tin
                    t·ª©c</span></button>
        </div>
        <div class="toast" id="toast"></div>
    </div>

    <script>
        const cases = [
            { id: 1, name: 'H·ªô Nguy·ªÖn VƒÉn A', phone: '0912345678', address: 'S·ªë 15, ƒê∆∞·ªùng Tr·∫ßn Ph√∫, P. L·ªôc Th·ªç, Nha Trang', people: 5, status: 'sos', source: 'Facebook', lat: 12.2450, lng: 109.1950 },
            { id: 2, name: 'H·ªô Tr·∫ßn Th·ªã B', phone: '0923456789', address: 'S·ªë 78, ƒê∆∞·ªùng Yersin, P. Vƒ©nh Nguy√™n, Nha Trang', people: 3, status: 'medical', source: 'Zalo', lat: 12.2380, lng: 109.1920 },
            { id: 3, name: 'H·ªô L√™ VƒÉn C', phone: '0934567890', address: 'S·ªë 123, ƒê∆∞·ªùng 2 Th√°ng 4, P. Vƒ©nh H·∫£i, Nha Trang', people: 4, status: 'sos', source: 'ƒê·ªãa ph∆∞∆°ng', lat: 12.2520, lng: 109.1880 },
            { id: 5, name: 'H·ªô Ho√†ng Th·ªã E', phone: '0956789012', address: 'S·ªë 89, ƒê∆∞·ªùng Nguy·ªÖn Thi·ªán Thu·∫≠t, P. T√¢n L·∫≠p, Nha Trang', people: 2, status: 'sos', source: 'Zalo', lat: 12.2350, lng: 109.1980 },
            // 10 New Mainland Markers (Blue, Red, Yellow)
            { id: 6, name: 'H·ªô Ph·∫°m VƒÉn F', phone: '0967890123', address: 'Th√¥n Vƒ©nh Ch√¢u, X√£ Vƒ©nh Hi·ªáp', people: 6, status: 'blue', source: 'Zalo', lat: 12.2480, lng: 109.1750 },
            { id: 7, name: 'H·ªô Ng√¥ Th·ªã G', phone: '0978901234', address: 'Th√¥n Vƒ©nh ƒêi·ªÅm, X√£ Vƒ©nh Ng·ªçc', people: 3, status: 'medical', source: 'Khu ph·ªë', lat: 12.2550, lng: 109.1720 },
            { id: 8, name: 'H·ªô B√πi VƒÉn H', phone: '0989012345', address: 'X√£ Vƒ©nh Th·∫°nh, Nha Trang', people: 5, status: 'sos', source: 'Facebook', lat: 12.2600, lng: 109.1680 },
            { id: 9, name: 'H·ªô V≈© Th·ªã I', phone: '0990123456', address: 'H∆∞∆°ng l·ªô 45, X√£ Vƒ©nh Ng·ªçc', people: 4, status: 'blue', source: 'Zalo', lat: 12.2510, lng: 109.1650 },
            { id: 10, name: 'H·ªô ƒê·∫∑ng VƒÉn K', phone: '0901234567', address: 'C·∫ßu B√®, X√£ Vƒ©nh Th·∫°nh', people: 2, status: 'medical', source: 'Call', lat: 12.2580, lng: 109.1700 },
            { id: 11, name: 'H·ªô L√Ω Th·ªã L', phone: '0912345670', address: 'Th√¥n Ph√∫ N√¥ng, X√£ Vƒ©nh Ng·ªçc', people: 7, status: 'sos', source: 'Facebook', lat: 12.2530, lng: 109.1780 },
            { id: 12, name: 'H·ªô Tr∆∞∆°ng VƒÉn M', phone: '0923456781', address: 'ƒê∆∞·ªùng 23/10, X√£ Vƒ©nh Hi·ªáp', people: 3, status: 'blue', source: 'Zalo', lat: 12.2460, lng: 109.1600 },
            { id: 13, name: 'H·ªô ƒê·ªó Th·ªã N', phone: '0934567892', address: 'Th√¥n Vƒ©nh Xu√¢n, X√£ Vƒ©nh Trung', people: 5, status: 'medical', source: 'Khu ph·ªë', lat: 12.2420, lng: 109.1550 },
            { id: 14, name: 'H·ªô Phan VƒÉn P', phone: '0945678903', address: 'X√£ Vƒ©nh Ph∆∞∆°ng, Nha Trang', people: 8, status: 'sos', source: 'Call', lat: 12.2700, lng: 109.1500 },
            { id: 15, name: 'H·ªô H√† Th·ªã Q', phone: '0956789014', address: 'Th√¥n ƒê·∫Øc L·ªôc, X√£ Vƒ©nh Ph∆∞∆°ng', people: 4, status: 'blue', source: 'Facebook', lat: 12.2650, lng: 109.1450 }
        ];
        const giftHistory = [
            { name: 'Nguy·ªÖn Th·ªã Lan', cccd: '012345678901', time: '10:30', count: 2, priority: 'Ng∆∞·ªùi gi√†' },
            { name: 'Tr·∫ßn VƒÉn H√πng', cccd: '023456789012', time: '10:15', count: 1, priority: 'Tr·∫ª nh·ªè' },
            { name: 'L√™ Th·ªã Mai', cccd: '034567890123', time: '09:45', count: 1, priority: 'Ph·ª• n·ªØ mang thai' },
        ];

        // Region data with 10 households each - Nha Trang city
        const regions = {
            'phuong-loc-tho': {
                name: 'Ph∆∞·ªùng L·ªôc Th·ªç',
                level: 'critical',
                levelText: 'C·ª±c k·ª≥ kh·∫©n c·∫•p',
                description: 'Khu v·ª±c trung t√¢m ng·∫≠p n·∫∑ng, n∆∞·ªõc d√¢ng 1.5m. Ch∆∞a c√≥ ƒëo√†n c·ª©u tr·ª£ ƒë·∫øn.',
                floodLevel: '1.5m',
                convoys: 0,
                households: [
                    { id: 1, name: 'H·ªô Nguy·ªÖn VƒÉn An', phone: '0912345001', address: 'S·ªë 12, ƒê∆∞·ªùng Tr·∫ßn Ph√∫, P. L·ªôc Th·ªç', people: 6, status: 'Ng∆∞·ªùi gi√†, tr·∫ª nh·ªè' },
                    { id: 2, name: 'H·ªô Tr·∫ßn Th·ªã B√¨nh', phone: '0912345002', address: 'S·ªë 45, ƒê∆∞·ªùng L√™ Th√°nh T√¥n, P. L·ªôc Th·ªç', people: 4, status: 'C·∫ßn thu·ªëc g·∫•p' },
                    { id: 3, name: 'H·ªô L√™ VƒÉn C∆∞·ªùng', phone: '0912345003', address: 'S·ªë 78, ƒê∆∞·ªùng Nguy·ªÖn Tr√£i, P. L·ªôc Th·ªç', people: 5, status: 'Thi·∫øu l∆∞∆°ng th·ª±c' },
                    { id: 4, name: 'H·ªô Ph·∫°m Th·ªã Dung', phone: '0912345004', address: 'S·ªë 23, ƒê∆∞·ªùng Bi·ªát Th·ª±, P. L·ªôc Th·ªç', people: 7, status: 'Ph·ª• n·ªØ mang thai' },
                    { id: 5, name: 'H·ªô Ho√†ng VƒÉn Em', phone: '0912345005', address: 'S·ªë 56, ƒê∆∞·ªùng H√πng V∆∞∆°ng, P. L·ªôc Th·ªç', people: 3, status: 'Ng∆∞·ªùi t√†n t·∫≠t' },
                    { id: 6, name: 'H·ªô V≈© Th·ªã Ph∆∞∆°ng', phone: '0912345006', address: 'S·ªë 89, ƒê∆∞·ªùng Ho√†ng Hoa Th√°m, P. L·ªôc Th·ªç', people: 5, status: 'Thi·∫øu n∆∞·ªõc s·∫°ch' },
                    { id: 7, name: 'H·ªô ƒê·∫∑ng VƒÉn Giang', phone: '0912345007', address: 'S·ªë 34, ƒê∆∞·ªùng Th·ªëng Nh·∫•t, P. L·ªôc Th·ªç', people: 4, status: 'Nh√† b·ªã s·∫≠p' },
                    { id: 8, name: 'H·ªô B√πi Th·ªã H·∫°nh', phone: '0912345008', address: 'S·ªë 67, ƒê∆∞·ªùng Quang Trung, P. L·ªôc Th·ªç', people: 6, status: 'C√¥ l·∫≠p ho√†n to√†n' },
                    { id: 9, name: 'H·ªô Ng√¥ VƒÉn Ki√™n', phone: '0912345009', address: 'S·ªë 90, ƒê∆∞·ªùng Phan B·ªôi Ch√¢u, P. L·ªôc Th·ªç', people: 5, status: 'Ng∆∞·ªùi gi√† ·ªëm n·∫∑ng' },
                    { id: 10, name: 'H·ªô L√Ω Th·ªã Lan', phone: '0912345010', address: 'S·ªë 15, ƒê∆∞·ªùng L√Ω T·ª± Tr·ªçng, P. L·ªôc Th·ªç', people: 4, status: 'Tr·∫ª s∆° sinh' }
                ]
            },
            'phuong-vinh-hai': {
                name: 'Ph∆∞·ªùng Vƒ©nh H·∫£i',
                level: 'high',
                levelText: 'Kh·∫©n c·∫•p cao',
                description: 'Khu v·ª±c ven bi·ªÉn ng·∫≠p 1.2m, 1 ƒëo√†n c·ª©u tr·ª£ ƒëang tr√™n ƒë∆∞·ªùng ƒë·∫øn.',
                floodLevel: '1.2m',
                convoys: 1,
                households: [
                    { id: 11, name: 'H·ªô Tr∆∞∆°ng VƒÉn Minh', phone: '0923456001', address: 'S·ªë 101, ƒê∆∞·ªùng 2 Th√°ng 4, P. Vƒ©nh H·∫£i', people: 5, status: 'Thi·∫øu l∆∞∆°ng th·ª±c' },
                    { id: 12, name: 'H·ªô ƒê·ªó Th·ªã Ng·ªçc', phone: '0923456002', address: 'S·ªë 55, ƒê∆∞·ªùng Ph·∫°m VƒÉn ƒê·ªìng, P. Vƒ©nh H·∫£i', people: 4, status: 'Ng∆∞·ªùi gi√†' },
                    { id: 13, name: 'H·ªô Phan VƒÉn Oanh', phone: '0923456003', address: 'S·ªë 88, ƒê∆∞·ªùng V√µ Nguy√™n Gi√°p, P. Vƒ©nh H·∫£i', people: 6, status: 'Tr·∫ª nh·ªè b·ªã ·ªëm' },
                    { id: 14, name: 'H·ªô L∆∞u Th·ªã Ph∆∞·ª£ng', phone: '0923456004', address: 'S·ªë 22, ƒê∆∞·ªùng L√™ ƒê·∫°i H√†nh, P. Vƒ©nh H·∫£i', people: 3, status: 'C·∫ßn n∆∞·ªõc s·∫°ch' },
                    { id: 15, name: 'H·ªô Mai VƒÉn Quang', phone: '0923456005', address: 'S·ªë 77, ƒê∆∞·ªùng Nguy·ªÖn ƒê√¨nh Chi·ªÉu, P. Vƒ©nh H·∫£i', people: 7, status: 'Gia ƒë√¨nh ƒë√¥ng' },
                    { id: 16, name: 'H·ªô ƒêinh Th·ªã Ros√©', phone: '0923456006', address: 'S·ªë 44, ƒê∆∞·ªùng Tr·∫ßn Quang Kh·∫£i, P. Vƒ©nh H·∫£i', people: 4, status: 'Ph·ª• n·ªØ mang thai' },
                    { id: 17, name: 'H·ªô Cao VƒÉn S∆°n', phone: '0923456007', address: 'S·ªë 99, ƒê∆∞·ªùng L√™ Lai, P. Vƒ©nh H·∫£i', people: 5, status: 'Thi·∫øu thu·ªëc' },
                    { id: 18, name: 'H·ªô T√¥ Th·ªã Th·∫£o', phone: '0923456008', address: 'S·ªë 33, ƒê∆∞·ªùng Nguy·ªÖn Ch√°nh, P. Vƒ©nh H·∫£i', people: 4, status: 'M·∫•t li√™n l·∫°c' },
                    { id: 19, name: 'H·ªô H√† VƒÉn Uy', phone: '0923456009', address: 'S·ªë 66, ƒê∆∞·ªùng Cao B√° Qu√°t, P. Vƒ©nh H·∫£i', people: 6, status: 'Ng∆∞·ªùi t√†n t·∫≠t' },
                    { id: 20, name: 'H·ªô Ch√¢u Th·ªã V√¢n', phone: '0923456010', address: 'S·ªë 11, ƒê∆∞·ªùng Ng√¥ Gia T·ª±, P. Vƒ©nh H·∫£i', people: 3, status: 'Ng∆∞·ªùi gi√† neo ƒë∆°n' }
                ]
            },
            'phuong-vinh-nguyen': {
                name: 'Ph∆∞·ªùng Vƒ©nh Nguy√™n',
                level: 'medium',
                levelText: 'C·∫ßn h·ªó tr·ª£',
                description: 'Khu v·ª±c c·∫£ng c√° ng·∫≠p 0.8m, ƒëang thi·∫øu thu·ªëc y t·∫ø v√† v·∫≠t t∆∞ s∆° c·ª©u.',
                floodLevel: '0.8m',
                convoys: 2,
                households: [
                    { id: 21, name: 'H·ªô Tr·ªãnh VƒÉn Xu√¢n', phone: '0934567001', address: 'S·ªë 45, ƒê∆∞·ªùng Yersin, P. Vƒ©nh Nguy√™n', people: 4, status: 'C·∫ßn thu·ªëc kh√°ng sinh' },
                    { id: 22, name: 'H·ªô D∆∞∆°ng Th·ªã Y·∫øn', phone: '0934567002', address: 'S·ªë 78, ƒê∆∞·ªùng B·∫°ch ƒê·∫±ng, P. Vƒ©nh Nguy√™n', people: 5, status: 'Tr·∫ª b·ªã ti√™u ch·∫£y' },
                    { id: 23, name: 'H·ªô Ki·ªÅu VƒÉn Anh', phone: '0934567003', address: 'S·ªë 23, ƒê∆∞·ªùng L√™ L·ª£i, P. Vƒ©nh Nguy√™n', people: 3, status: 'Ng∆∞·ªùi cao tu·ªïi' },
                    { id: 24, name: 'H·ªô M·∫°c Th·ªã B√≠ch', phone: '0934567004', address: 'S·ªë 56, ƒê∆∞·ªùng Nguy·ªÖn B·ªânh Khi√™m, P. Vƒ©nh Nguy√™n', people: 6, status: 'Thi·∫øu l∆∞∆°ng th·ª±c' },
                    { id: 25, name: 'H·ªô √Çu VƒÉn C√¥ng', phone: '0934567005', address: 'S·ªë 89, ƒê∆∞·ªùng T√¥ Hi·ªáu, P. Vƒ©nh Nguy√™n', people: 4, status: 'C·∫ßn b√¥ng bƒÉng' },
                    { id: 26, name: 'H·ªô La Th·ªã Di·ªáu', phone: '0934567006', address: 'S·ªë 12, ƒê∆∞·ªùng ƒê·ªìng Nai, P. Vƒ©nh Nguy√™n', people: 5, status: 'B·ªã c·∫£m c√∫m' },
                    { id: 27, name: 'H·ªô T·∫° VƒÉn Hi·ªáp', phone: '0934567007', address: 'S·ªë 34, ƒê∆∞·ªùng C·ª≠u Long, P. Vƒ©nh Nguy√™n', people: 7, status: 'Gia ƒë√¨nh ƒë√¥ng' },
                    { id: 28, name: 'H·ªô T·ª´ Th·ªã H·ªìng', phone: '0934567008', address: 'S·ªë 67, ƒê∆∞·ªùng ƒê√† N·∫µng, P. Vƒ©nh Nguy√™n', people: 4, status: 'C·∫ßn thu·ªëc ƒëau b·ª•ng' },
                    { id: 29, name: 'H·ªô Li·ªÖu VƒÉn Kh√°nh', phone: '0934567009', address: 'S·ªë 90, ƒê∆∞·ªùng Hu·ª≥nh Th√∫c Kh√°ng, P. Vƒ©nh Nguy√™n', people: 3, status: 'Ng∆∞·ªùi gi√† ·ªëm' },
                    { id: 30, name: 'H·ªô Qu√°ch Th·ªã Li√™n', phone: '0934567010', address: 'S·ªë 15, ƒê∆∞·ªùng Phan Chu Trinh, P. Vƒ©nh Nguy√™n', people: 5, status: 'Thi·∫øu n∆∞·ªõc s·∫°ch' }
                ]
            },
            'phuong-phuoc-hai': {
                name: 'Ph∆∞·ªùng Ph∆∞·ªõc H·∫£i',
                level: 'low',
                levelText: '·ªîn ƒë·ªãnh',
                description: 'N∆∞·ªõc ƒë√£ r√∫t, c√°c h·ªô ƒë√£ ƒë∆∞·ª£c h·ªó tr·ª£ c∆° b·∫£n. C·∫ßn theo d√µi.',
                floodLevel: 'ƒê√£ r√∫t',
                convoys: 3,
                households: [
                    { id: 31, name: 'H·ªô S·∫ßm VƒÉn Long', phone: '0945678001', address: 'S·ªë 101, ƒê∆∞·ªùng L√™ H·ªìng Phong, P. Ph∆∞·ªõc H·∫£i', people: 4, status: 'ƒê√£ nh·∫≠n qu√†' },
                    { id: 32, name: 'H·ªô N√¥ng Th·ªã Mai', phone: '0945678002', address: 'S·ªë 55, ƒê∆∞·ªùng Nguy·ªÖn Th·ªã Minh Khai, P. Ph∆∞·ªõc H·∫£i', people: 5, status: 'ƒê√£ nh·∫≠n qu√†' },
                    { id: 33, name: 'H·ªô TƒÉng VƒÉn Nghƒ©a', phone: '0945678003', address: 'S·ªë 88, ƒê∆∞·ªùng Th√°i Nguy√™n, P. Ph∆∞·ªõc H·∫£i', people: 3, status: '·ªîn ƒë·ªãnh' },
                    { id: 34, name: 'H·ªô M√£ Th·ªã Oanh', phone: '0945678004', address: 'S·ªë 22, ƒê∆∞·ªùng Ng√¥ Quy·ªÅn, P. Ph∆∞·ªõc H·∫£i', people: 6, status: 'ƒê√£ nh·∫≠n qu√†' },
                    { id: 35, name: 'H·ªô Tri·ªáu VƒÉn Ph√∫c', phone: '0945678005', address: 'S·ªë 77, ƒê∆∞·ªùng Tr∆∞∆°ng ƒê·ªãnh, P. Ph∆∞·ªõc H·∫£i', people: 4, status: '·ªîn ƒë·ªãnh' },
                    { id: 36, name: 'H·ªô L·ªôc Th·ªã Qu·ª≥nh', phone: '0945678006', address: 'S·ªë 44, ƒê∆∞·ªùng Hai B√† Tr∆∞ng, P. Ph∆∞·ªõc H·∫£i', people: 5, status: 'ƒê√£ nh·∫≠n qu√†' },
                    { id: 37, name: 'H·ªô Vi VƒÉn S·ªπ', phone: '0945678007', address: 'S·ªë 99, ƒê∆∞·ªùng Nguy·ªÖn C√¥ng Tr·ª©, P. Ph∆∞·ªõc H·∫£i', people: 4, status: '·ªîn ƒë·ªãnh' },
                    { id: 38, name: 'H·ªô H·ª©a Th·ªã Trang', phone: '0945678008', address: 'S·ªë 33, ƒê∆∞·ªùng ƒêinh Ti√™n Ho√†ng, P. Ph∆∞·ªõc H·∫£i', people: 3, status: 'ƒê√£ nh·∫≠n qu√†' },
                    { id: 39, name: 'H·ªô Th·∫°ch VƒÉn Vinh', phone: '0945678009', address: 'S·ªë 66, ƒê∆∞·ªùng Pasteur, P. Ph∆∞·ªõc H·∫£i', people: 5, status: '·ªîn ƒë·ªãnh' },
                    { id: 40, name: 'H·ªô C·∫ßm Th·ªã Xu√¢n', phone: '0945678010', address: 'S·ªë 11, ƒê∆∞·ªùng L√Ω Th∆∞·ªùng Ki·ªát, P. Ph∆∞·ªõc H·∫£i', people: 4, status: 'ƒê√£ nh·∫≠n qu√†' }
                ]
            }
        };

        let callCount = 5, callsList = [], completedCalls = 0, spamCalls = 0, currentCallId = null, map = null, selectedStatus = null;

        document.addEventListener('DOMContentLoaded', () => { renderGiftHistory(); });

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + screenId).classList.add('active');
            const hideNav = ['login', 'register', 'verify', 'call-list', 'record-form', 'volunteer-register', 'case-list', 'household-detail'].includes(screenId);
            document.getElementById('bottom-nav').style.display = hideNav ? 'none' : 'flex';
            if (screenId === 'map' && !map) setTimeout(initMap, 100);
        }

        function navTo(screen) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            showScreen(screen);
        }


        // Notification Panel Functions
        function openNotificationPanel() {
            document.getElementById('notification-modal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            // Update badge to show notifications were viewed
            document.getElementById('notification-badge').textContent = '8';
        }

        function closeNotificationPanel() {
            document.getElementById('notification-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Show toast message
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: var(--gray-800); color: white; padding: 12px 20px; border-radius: 25px; font-size: 13px; z-index: 2000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); max-width: 90%;';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function submitRegistration() {
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const phone = document.getElementById('reg-phone').value.trim();
            const password = document.getElementById('reg-password').value.trim();

            const errors = [];
            if (!name) errors.push('H·ªç v√† t√™n');
            if (!email) errors.push('Email');
            if (!phone) errors.push('S·ªë ƒëi·ªán tho·∫°i');
            if (!password) errors.push('M·∫≠t kh·∫©u');

            if (errors.length > 0) {
                alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc:\n\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
                return;
            }

            showScreen('personal-info');
        }

        function completeRegistration() {
            const role = document.getElementById('personal-role').value;

            if (!role) {
                alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn vai tr√≤ ƒëƒÉng k√Ω!');
                return;
            }

            // Clear all registration forms
            document.getElementById('reg-name').value = '';
            document.getElementById('reg-email').value = '';
            document.getElementById('reg-phone').value = '';
            document.getElementById('reg-password').value = '';
            document.getElementById('personal-dob').value = '';
            document.getElementById('personal-gender').value = '';
            document.getElementById('personal-cccd').value = '';
            document.getElementById('personal-address').value = '';
            document.getElementById('personal-exp').value = '';

            showToast('üéâ ƒêƒÉng k√Ω th√†nh c√¥ng!');
            showScreen('login');
        }

        function renderCaseLists() {
            const list = document.getElementById('emergency-list');
            const statusLabels = { sos: 'SOS', medical: 'Y T·∫ø', safe: 'An to√†n' };
            list.innerHTML = cases.filter(c => c.status !== 'safe').map(c => `
                <div class="case-item" onclick="showCaseDetail(${c.id})">
                    <div class="case-status ${c.status}"></div>
                    <div class="case-info">
                        <div class="case-name">${c.name}</div>
                        <div class="case-address">${c.address}</div>
                        <div class="case-meta">üë• ${c.people} ng∆∞·ªùi ‚Ä¢ ${c.source}</div>
                    </div>
                    <span class="case-badge ${c.status}">${statusLabels[c.status]}</span>
                </div>`).join('');
        }

        function renderGiftHistory() {
            const list = document.getElementById('gift-history');
            list.innerHTML = giftHistory.map(h => `
                <div class="history-item">
                    <div class="history-avatar">üë§</div>
                    <div class="history-info">
                        <div class="history-name">${h.name}</div>
                        <div class="history-cccd">CCCD: ${h.cccd}</div>
                        <div class="history-time">üïê ${h.time} ‚Ä¢ ${h.priority}</div>
                    </div>
                    <div class="history-count">
                        <div class="history-count-num">${h.count}</div>
                        <div class="history-count-label">l·∫ßn nh·∫≠n</div>
                    </div>
                </div>`).join('');
        }

        function showRegionDetail(regionId) {
            const region = regions[regionId];
            if (!region) return;

            // Update title
            document.getElementById('region-detail-title').textContent = region.name;

            // Update summary card
            const levelColors = {
                critical: 'var(--red-500)',
                high: '#f97316',
                medium: 'var(--yellow-500)',
                low: 'var(--green-500)'
            };

            document.getElementById('region-summary').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div class="card-title" style="margin: 0;">üìç ${region.name}</div>
                    <div class="region-badge ${region.level}">${region.levelText}</div>
                </div>
                <p style="font-size: 12px; color: var(--gray-600); line-height: 1.5; margin-bottom: 10px;">${region.description}</p>
                <div style="display: flex; gap: 16px; font-size: 11px; color: var(--gray-500);">
                    <span>üíß M·ª©c ng·∫≠p: <b>${region.floodLevel}</b></span>
                    <span>üöõ ƒêo√†n: <b>${region.convoys}</b></span>
                    <span>üë• H·ªô: <b>${region.households.length}</b></span>
                </div>
            `;

            // Render household list
            renderHouseholds(region.households, region.level);

            // Show the screen
            showScreen('household-detail');
        }

        function renderHouseholds(households, level) {
            const list = document.getElementById('household-list');
            list.innerHTML = households.map(h => `
                <div class="household-item" onclick="showHouseholdDetail('${h.name}', '${h.phone}', '${h.address}', ${h.people}, '${h.status}')">
                    <div class="household-status ${level}"></div>
                    <div class="household-info">
                        <div class="household-name">${h.name}</div>
                        <div class="household-detail">üìç ${h.address} ‚Ä¢ üë• ${h.people} ng∆∞·ªùi</div>
                        <div class="household-detail">üìã ${h.status}</div>
                    </div>
                    <div class="household-arrow">‚Ä∫</div>
                </div>
            `).join('');
        }

        function showHouseholdDetail(name, phone, address, people, status) {
            alert(`${name}\nüìû ${phone}\nüìç ${address}\nüë• ${people} ng∆∞·ªùi\nüìã T√¨nh tr·∫°ng: ${status}`);
        }

        function submitCase() {
            const nameEl = document.getElementById('case-name');
            const phoneEl = document.getElementById('case-phone');
            const addressEl = document.getElementById('case-address');
            const sourceEl = document.getElementById('case-source');

            const name = nameEl.value.trim();
            const phone = phoneEl.value.trim();
            const address = addressEl.value.trim();
            const source = sourceEl.value;

            // Reset border colors
            nameEl.style.borderColor = '';
            phoneEl.style.borderColor = '';
            addressEl.style.borderColor = '';
            sourceEl.style.borderColor = '';

            const errors = [];
            if (!name) {
                errors.push('T√™n ch·ªß h·ªô');
                nameEl.style.borderColor = 'var(--red-500)';
            }
            if (!phone) {
                errors.push('S·ªë ƒëi·ªán tho·∫°i');
                phoneEl.style.borderColor = 'var(--red-500)';
            }
            if (!address) {
                errors.push('ƒê·ªãa ch·ªâ');
                addressEl.style.borderColor = 'var(--red-500)';
            }
            if (!source) {
                errors.push('Ngu·ªìn th√¥ng tin');
                sourceEl.style.borderColor = 'var(--red-500)';
            }

            if (errors.length > 0) {
                alert('‚ö†Ô∏è KH√îNG TH·ªÇ G·ª¨I B√ÅO C√ÅO!\n\nVui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß T·∫§T C·∫¢ c√°c tr∆∞·ªùng sau:\n\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
                return false; // Prevent submission
            }

            // All fields filled - Clear form
            nameEl.value = '';
            phoneEl.value = '';
            addressEl.value = '';
            sourceEl.value = '';
            document.getElementById('gps-status').innerHTML = '';

            showToast('‚úÖ ƒê√£ g·ª≠i b√°o c√°o th√†nh c√¥ng!');
            showScreen('home');
            return true;
        }

        function sendSMSReport() {
            const name = document.getElementById('case-name').value.trim();
            const phone = document.getElementById('case-phone').value.trim();
            const address = document.getElementById('case-address').value.trim();
            const sourceEl = document.getElementById('case-source');
            const sourceValue = sourceEl.value;

            // Get source display text
            let sourceText = '';
            if (sourceValue) {
                sourceText = sourceEl.options[sourceEl.selectedIndex].text;
            }

            // Validate - at least name is required
            if (!name) {
                alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn √≠t nh·∫•t T√™n ch·ªß h·ªô ƒë·ªÉ g·ª≠i SMS!');
                document.getElementById('case-name').style.borderColor = 'var(--red-500)';
                return;
            }

            // Build SMS message from template
            const smsTemplate = `[C·ª®U TR·ª¢ KH·∫®N C·∫§P]
T√™n: ${name || '(Ch∆∞a ƒëi·ªÅn)'}
SƒêT: ${phone || '(Ch∆∞a ƒëi·ªÅn)'}
ƒê·ªãa ch·ªâ: ${address || '(Ch∆∞a ƒëi·ªÅn)'}
Ngu·ªìn: ${sourceText || '(Ch∆∞a ch·ªçn)'}
---
G·ª≠i t·ª´ App C·ª©u Tr·ª£ - ${new Date().toLocaleString('vi-VN')}`;

            // Phone number to send SMS to
            const phoneNumber = '0342381843';

            // Encode the message for URL
            const encodedMessage = encodeURIComponent(smsTemplate);

            // Create SMS URI (works on both Android and iOS)
            // Android uses sms:number?body=message
            // iOS uses sms:number&body=message (but also supports ?)
            const smsURI = `sms:${phoneNumber}?body=${encodedMessage}`;

            // Show confirmation
            if (confirm(`üì± S·∫Ω m·ªü ·ª©ng d·ª•ng Tin nh·∫Øn ƒë·ªÉ g·ª≠i ƒë·∫øn:\n\nS·ªë: ${phoneNumber}\n\nN·ªôi dung:\n${smsTemplate}\n\nB·∫•m OK ƒë·ªÉ ti·∫øp t·ª•c.`)) {
                // Open SMS app
                window.location.href = smsURI;
                showToast('üì± ƒêang m·ªü ·ª©ng d·ª•ng Tin nh·∫Øn...');
            }
        }

        function getGPSLocation() {
            const statusEl = document.getElementById('gps-status');
            const addressEl = document.getElementById('case-address');

            if (!navigator.geolocation) {
                statusEl.innerHTML = '<span style="color: var(--red-500);">‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS</span>';
                return;
            }

            statusEl.innerHTML = '<span style="color: var(--blue-500);">‚è≥ ƒêang l·∫•y v·ªã tr√≠ GPS...</span>';

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    statusEl.innerHTML = '<span style="color: var(--blue-500);">‚è≥ ƒêang chuy·ªÉn ƒë·ªïi t·ªça ƒë·ªô th√†nh ƒë·ªãa ch·ªâ...</span>';

                    try {
                        // Use OpenStreetMap Nominatim for reverse geocoding (free)
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=vi`);
                        const data = await response.json();

                        if (data && data.display_name) {
                            addressEl.value = data.display_name;
                            statusEl.innerHTML = `<span style="color: var(--green-500);">‚úÖ ƒê√£ l·∫•y ƒë·ªãa ch·ªâ (${lat.toFixed(5)}, ${lng.toFixed(5)})</span>`;
                        } else {
                            // Fallback to coordinates
                            addressEl.value = `T·ªça ƒë·ªô: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                            statusEl.innerHTML = '<span style="color: var(--yellow-600);">‚ö†Ô∏è Kh√¥ng t√¨m ƒë∆∞·ª£c ƒë·ªãa ch·ªâ, ƒë√£ ƒëi·ªÅn t·ªça ƒë·ªô</span>';
                        }
                    } catch (error) {
                        // Fallback to coordinates if API fails
                        addressEl.value = `T·ªça ƒë·ªô GPS: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                        statusEl.innerHTML = '<span style="color: var(--yellow-600);">‚ö†Ô∏è L·ªói k·∫øt n·ªëi, ƒë√£ ƒëi·ªÅn t·ªça ƒë·ªô GPS</span>';
                    }
                },
                (error) => {
                    let errorMsg = '';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = '‚ùå B·∫°n ƒë√£ t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr√≠';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = '‚ùå Kh√¥ng th·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠';
                            break;
                        case error.TIMEOUT:
                            errorMsg = '‚ùå H·∫øt th·ªùi gian ch·ªù l·∫•y v·ªã tr√≠';
                            break;
                        default:
                            errorMsg = '‚ùå L·ªói kh√¥ng x√°c ƒë·ªãnh';
                    }
                    statusEl.innerHTML = `<span style="color: var(--red-500);">${errorMsg}</span>`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        function getVolunteerGPSLocation() {
            const statusEl = document.getElementById('volunteer-gps-status');
            const addressEl = document.getElementById('volunteer-arrival-location');

            if (!navigator.geolocation) {
                statusEl.innerHTML = '<span style="color: var(--red-500);">‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS</span>';
                return;
            }

            statusEl.innerHTML = '<span style="color: var(--blue-500);">‚è≥ ƒêang l·∫•y v·ªã tr√≠ GPS...</span>';

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    statusEl.innerHTML = '<span style="color: var(--blue-500);">‚è≥ ƒêang chuy·ªÉn ƒë·ªïi t·ªça ƒë·ªô th√†nh ƒë·ªãa ch·ªâ...</span>';

                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=vi`);
                        const data = await response.json();

                        if (data && data.display_name) {
                            addressEl.value = data.display_name;
                            statusEl.innerHTML = `<span style="color: var(--green-500);">‚úÖ ƒê√£ l·∫•y ƒë·ªãa ch·ªâ GPS th√†nh c√¥ng!</span>`;
                        } else {
                            addressEl.value = `T·ªça ƒë·ªô GPS: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                            statusEl.innerHTML = '<span style="color: var(--yellow-600);">‚ö†Ô∏è ƒê√£ ƒëi·ªÅn t·ªça ƒë·ªô GPS</span>';
                        }
                    } catch (error) {
                        addressEl.value = `T·ªça ƒë·ªô GPS: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                        statusEl.innerHTML = '<span style="color: var(--yellow-600);">‚ö†Ô∏è L·ªói k·∫øt n·ªëi, ƒë√£ ƒëi·ªÅn t·ªça ƒë·ªô</span>';
                    }
                },
                (error) => {
                    let errorMsg = '‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠';
                    if (error.code === error.PERMISSION_DENIED) errorMsg = '‚ùå B·∫°n ƒë√£ t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr√≠';
                    statusEl.innerHTML = `<span style="color: var(--red-500);">${errorMsg}</span>`;
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }

        function confirmArrival() {
            const location = document.getElementById('volunteer-arrival-location').value.trim();
            if (!location) {
                alert('‚ö†Ô∏è Vui l√≤ng l·∫•y v·ªã tr√≠ GPS ho·∫∑c nh·∫≠p ƒë·ªãa ch·ªâ ƒëi·ªÉm ph√°t qu√† tr∆∞·ªõc khi x√°c nh·∫≠n!');
                return;
            }

            showToast('‚úÖ ƒê√£ x√°c nh·∫≠n ƒë·∫øn n∆°i ph√°t qu√†!');
            document.getElementById('volunteer-arrival-location').value = '';
            document.getElementById('volunteer-gps-status').innerHTML = '';
        }

        function showCaseDetail(id) { const c = cases.find(x => x.id === id); alert(`${c.name}\nüìç ${c.address}\nüìû ${c.phone}\nüë• ${c.people} ng∆∞·ªùi\nüìä Ngu·ªìn: ${c.source}`); }
        function decreaseCount() { if (callCount > 1) { callCount--; document.getElementById('call-count').textContent = callCount; } }
        function increaseCount() { if (callCount < 20) { callCount++; document.getElementById('call-count').textContent = callCount; } }

        function startCalling() {
            callsList = cases.filter(c => c.status !== 'safe').slice(0, callCount).map(c => ({ ...c, callStatus: 'pending' }));
            completedCalls = 0; spamCalls = 0;
            showScreen('call-list'); renderCallList(); updateProgress();
        }

        function renderCallList() {
            const container = document.getElementById('call-list-container');
            const currentTab = document.querySelector('.tab.active').textContent;
            let filtered = callsList;
            if (currentTab.includes('ƒê√£ x√°c minh')) filtered = callsList.filter(c => c.callStatus === 'completed');
            else if (currentTab.includes('Tin r√°c')) filtered = callsList.filter(c => c.callStatus === 'spam');
            else filtered = callsList.filter(c => c.callStatus === 'pending');

            container.innerHTML = filtered.map(c => `
                <div class="call-item">
                    <div class="call-item-header">
                        <div class="call-item-status ${c.callStatus}"></div>
                        <div style="flex:1;">
                            <div class="call-item-name">${c.name}</div>
                            <div class="call-item-phone">${formatPhone(c.phone)}</div>
                            <div class="call-item-address">${c.address} ‚Ä¢ ${c.source}</div>
                        </div>
                    </div>
                    ${c.callStatus === 'pending' ? `
                    <div class="call-actions">
                        <button class="call-action-btn call" onclick="makeCall('${c.phone}')">üìû G·ªçi</button>
                        <button class="call-action-btn form" onclick="openForm(${c.id})">üìù Ghi nh·∫≠n</button>
                        <button class="call-action-btn skip" onclick="markSpam(${c.id})">üóëÔ∏è Tin r√°c</button>
                    </div>` : ''}
                </div>`).join('') || '<div style="text-align: center; padding: 40px; color: var(--gray-500);">Kh√¥ng c√≥ cu·ªôc g·ªçi n√†o</div>';
        }

        function formatPhone(phone) { return phone.replace(/(\d{4})(\d{3})(\d{3})/, '$1 $2 $3'); }
        function switchTab(tab) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); event.currentTarget.classList.add('active'); renderCallList(); }
        function toggleScript() { const c = document.getElementById('script-content'); const t = document.getElementById('script-toggle'); c.classList.toggle('show'); t.textContent = c.classList.contains('show') ? '‚ñ≤' : '‚ñº'; }
        function updateProgress() {
            const total = callsList.length, progress = total > 0 ? (completedCalls / total * 100) : 0;
            document.getElementById('call-progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `ƒê√£ x√°c minh: ${completedCalls}/${total}`;
            document.getElementById('unreachable-text').textContent = `L·ªçc r√°c: ${spamCalls}`;
        }

        function makeCall(phone) { showToast(`ƒêang g·ªçi ƒë·∫øn ${formatPhone(phone)}...`); }
        function openForm(id) { currentCallId = id; const c = callsList.find(x => x.id === id); document.getElementById('current-phone').textContent = formatPhone(c.phone); selectedStatus = null; document.getElementById('need-form').classList.add('hidden'); showScreen('record-form'); }
        function markSpam(id) { const c = callsList.find(x => x.id === id); c.callStatus = 'spam'; spamCalls++; updateProgress(); renderCallList(); showToast('ƒê√£ ƒë√°nh d·∫•u tin r√°c'); }

        function selectStatus(status) {
            selectedStatus = status;
            document.getElementById('btn-safe').style.background = status === 'safe' ? 'var(--green-500)' : 'white';
            document.getElementById('btn-safe').style.color = status === 'safe' ? 'white' : 'var(--green-600)';
            document.getElementById('btn-need').style.background = status === 'need' ? 'var(--red-500)' : 'linear-gradient(135deg, var(--red-500), var(--red-600))';
            document.getElementById('need-form').classList.toggle('hidden', status !== 'need');
        }

        function toggleRecording() { showToast('üéôÔ∏è ƒêang ghi √¢m...'); }
        function selectPriority(p) { document.querySelectorAll('.priority-tag').forEach(t => t.style.opacity = '0.5'); event.currentTarget.style.opacity = '1'; }

        function saveVerification() {
            if (currentCallId) { const c = callsList.find(x => x.id === currentCallId); c.callStatus = 'completed'; completedCalls++; updateProgress(); }
            showScreen('call-list'); renderCallList(); showToast(selectedStatus === 'safe' ? '‚úÖ ƒê√£ x√°c minh AN TO√ÄN' : 'üÜò ƒê√£ chuy·ªÉn cho nh√¢n vi√™n x·ª≠ l√Ω');
        }

        // QR Scanner variables
        let html5QrCode = null;
        let isScanning = false;
        let currentScannedCode = null;
        // Set to track received codes (in real app, this would be in database)
        const receivedCodes = new Set(['012345678901', '023456789012', '034567890123']); // Pre-populate with gift history CCCDs

        function startQRScanner() {
            const qrReaderElement = document.getElementById('qr-reader');
            const scannerPlaceholder = document.getElementById('scanner-placeholder');
            const btnStart = document.getElementById('btn-start-scan');
            const btnStop = document.getElementById('btn-stop-scan');
            const scanInstruction = document.getElementById('scan-instruction');

            // Hide placeholder, show scanner
            scannerPlaceholder.classList.add('hidden');
            btnStart.classList.add('hidden');
            btnStop.classList.remove('hidden');
            scanInstruction.textContent = 'ƒê∆∞a m√£ QR v√†o khung h√¨nh ƒë·ªÉ qu√©t...';

            // Initialize html5-qrcode
            html5QrCode = new Html5Qrcode("qr-reader");

            const config = {
                fps: 10,
                qrbox: { width: 200, height: 200 },
                aspectRatio: 1.0
            };

            html5QrCode.start(
                { facingMode: "environment" }, // Use back camera on mobile
                config,
                onQRCodeSuccess,
                onQRCodeError
            ).then(() => {
                isScanning = true;
                showToast('üì∑ Camera ƒë√£ m·ªü - H∆∞·ªõng v√†o m√£ QR');
            }).catch((err) => {
                console.error('Camera error:', err);
                showToast('‚ùå Kh√¥ng th·ªÉ m·ªü camera. Vui l√≤ng cho ph√©p truy c·∫≠p camera.');
                resetScannerUI();
            });
        }

        function stopQRScanner() {
            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(() => {
                    isScanning = false;
                    resetScannerUI();
                    showToast('‚èπÔ∏è ƒê√£ d·ª´ng qu√©t');
                }).catch(err => console.error('Stop scanner error:', err));
            }
        }

        function onQRCodeSuccess(decodedText, decodedResult) {
            // Stop scanning immediately after successful read
            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(() => {
                    isScanning = false;
                    processScannedCode(decodedText);
                }).catch(err => console.error('Stop after scan error:', err));
            }
        }

        function onQRCodeError(errorMessage) {
            // Ignore errors during scanning (they happen frequently when no QR is in view)
        }

        function processScannedCode(fullText) {
            // Extract first 12 characters
            const first12Chars = fullText.substring(0, 12);
            currentScannedCode = first12Chars;

            console.log('Full scanned text:', fullText);
            console.log('First 12 characters:', first12Chars);

            // Hide scanner UI
            resetScannerUI();

            // Check if this code has already received a gift
            if (receivedCodes.has(first12Chars)) {
                // Show already received warning
                showAlreadyReceived(first12Chars);
            } else {
                // Show scan result for new recipient
                showNewRecipient(first12Chars);
            }
        }

        function showAlreadyReceived(code) {
            document.getElementById('scan-result').classList.add('hidden');
            document.getElementById('already-received').classList.remove('hidden');
            document.getElementById('already-received-detail').textContent =
                `M√£ ${code} ƒë√£ ƒë∆∞·ª£c nh·∫≠n qu√† tr∆∞·ªõc ƒë√≥. Kh√¥ng th·ªÉ nh·∫≠n th√™m.`;

            showToast('üö´ M√£ n√†y ƒë√£ nh·∫≠n qu√† r·ªìi!');
        }

        function showNewRecipient(code) {
            document.getElementById('already-received').classList.add('hidden');
            document.getElementById('scan-result').classList.remove('hidden');
            document.getElementById('scanned-cccd').textContent = code;

            showToast('‚úÖ Qu√©t th√†nh c√¥ng - M√£ m·ªõi!');
        }

        function resetScan() {
            currentScannedCode = null;
            document.getElementById('scan-result').classList.add('hidden');
            document.getElementById('already-received').classList.add('hidden');
            resetScannerUI();
        }

        function resetScannerUI() {
            const scannerPlaceholder = document.getElementById('scanner-placeholder');
            const btnStart = document.getElementById('btn-start-scan');
            const btnStop = document.getElementById('btn-stop-scan');
            const scanInstruction = document.getElementById('scan-instruction');
            const qrReader = document.getElementById('qr-reader');

            scannerPlaceholder.classList.remove('hidden');
            btnStart.classList.remove('hidden');
            btnStop.classList.add('hidden');
            scanInstruction.textContent = 'Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ m·ªü camera qu√©t m√£ QR';

            // Clear the qr-reader div
            qrReader.innerHTML = '';
        }

        function confirmGift() {
            if (currentScannedCode) {
                // Add to received codes set
                receivedCodes.add(currentScannedCode);

                // Add to gift history
                const now = new Date();
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                    now.getMinutes().toString().padStart(2, '0');

                giftHistory.unshift({
                    name: 'Ng∆∞·ªùi nh·∫≠n m·ªõi',
                    cccd: currentScannedCode,
                    time: timeStr,
                    count: 1,
                    priority: 'M·ªõi qu√©t QR'
                });

                renderGiftHistory();
                showToast('‚úÖ ƒê√£ ghi nh·∫≠n ph√°t qu√† cho m√£ ' + currentScannedCode);
            }

            resetScan();
        }

        function goBackFromIdentify() {
            // Make sure to stop scanner when leaving the screen
            if (html5QrCode && isScanning) {
                html5QrCode.stop().catch(err => console.error('Stop on back error:', err));
                isScanning = false;
            }
            resetScan();
            showScreen('home');
        }
        function registerVolunteer() {
            const isRouting = document.getElementById('volunteer-routing-optin')?.checked;
            const isStation = document.getElementById('register-station-toggle')?.checked;

            if (isStation) {
                showToast('üè† ƒê√£ ƒëƒÉng k√Ω ƒêi·ªÉm Cung c·∫•p C·ª©u tr·ª£ th√†nh c√¥ng!');
            } else if (isRouting) {
                showToast('‚úÖ ƒê√£ ƒëƒÉng k√Ω. H·ªá th·ªëng s·∫Ω g·ª≠i g·ª£i √Ω ƒëi·ªÅu ph·ªëi ngay!');
                setTimeout(() => {
                    // Simulate system routing suggestion
                    showToast('üîî G·ª¢I √ù ƒêI·ªÄU PH·ªêI: M·ªùi ƒëo√†n ƒë·∫øn X√£ Vƒ©nh L∆∞∆°ng (ƒêang thi·∫øu l∆∞∆°ng th·ª±c)');
                }, 2000);
            } else {
                showToast('üìù ƒê√£ ƒëƒÉng k√Ω l·ªô tr√¨nh th√†nh c√¥ng!');
            }
            showScreen('home');
        }
        function submitCase() { showToast('üÜò ƒê√£ g·ª≠i b√°o c√°o!'); showScreen('home'); }

        function initMap() {
            // Nha Trang city coordinates
            map = L.map('map').setView([12.2450, 109.1950], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

            const colors = { sos: '#ef4444', medical: '#eab308', blue: '#3b82f6' };
            const statusLabels = { sos: 'üî¥ KH·∫®N C·∫§P', medical: 'üü° C·∫¶N H·ªñ TR·ª¢', blue: 'üîµ ƒêO√ÄN THI·ªÜN NGUY·ªÜN' };

            cases.forEach(c => {
                const popupContent = `
                    <div style="min-width: 200px; font-family: system-ui;">
                        <div style="font-weight: bold; font-size: 14px; color: ${colors[c.status]}; margin-bottom: 8px;">${statusLabels[c.status]}</div>
                        <div style="font-weight: bold; font-size: 13px; margin-bottom: 4px;">${c.name}</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 4px;">üìç ${c.address}</div>
                        <div style="font-size: 12px; margin-bottom: 4px;">üë• ${c.people} ng∆∞·ªùi | üìû ${c.phone}</div>
                        <div style="font-size: 11px; color: #888; margin-bottom: 8px;">üìä Ngu·ªìn: ${c.source}</div>
                        <div style="background: #f3f4f6; padding: 8px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="font-size: 11px; color: #666;">üìç T·ªça ƒë·ªô GPS:</div>
                            <div style="font-weight: bold; font-size: 12px; color: #1d4ed8;">${c.lat.toFixed(6)}, ${c.lng.toFixed(6)}</div>
                        </div>
                        <button onclick="copyCoordinates(${c.lat}, ${c.lng}, '${c.name}')" 
                            style="width: 100%; padding: 8px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px;">
                            üìã Sao ch√©p t·ªça ƒë·ªô
                        </button>
                        <a href="https://www.google.com/maps/dir/?api=1&destination=${c.lat},${c.lng}" target="_blank"
                            style="display: block; width: 100%; padding: 8px; background: #22c55e; color: white; border: none; border-radius: 6px; font-weight: 600; text-align: center; text-decoration: none; margin-top: 6px; font-size: 12px; box-sizing: border-box;">
                            üó∫Ô∏è M·ªü Google Maps
                        </a>
                    </div>
                `;
                L.circleMarker([c.lat, c.lng], {
                    radius: 14,
                    fillColor: colors[c.status],
                    color: '#fff',
                    weight: 2,
                    fillOpacity: 0.9
                }).addTo(map).bindPopup(popupContent);
            });

            // Volunteer convoy markers - Nha Trang locations
            const convoyPopup1 = `
                <div style="min-width: 180px; font-family: system-ui;">
                    <div style="font-weight: bold; font-size: 13px; color: #3b82f6;">üöõ ƒêo√†n H√† N·ªôi 1</div>
                    <div style="font-size: 12px; margin: 4px 0;">üì¶ G·∫°o 1 t·∫•n, M√¨ 500 th√πng</div>
                    <div style="font-size: 11px; color: #666;">üìç ƒêang ƒë·∫øn: P. Vƒ©nh H·∫£i</div>
                </div>
            `;
            const convoyPopup2 = `
                <div style="min-width: 180px; font-family: system-ui;">
                    <div style="font-weight: bold; font-size: 13px; color: #3b82f6;">üöõ ƒêo√†n B·∫Øc Ninh</div>
                    <div style="font-size: 12px; margin: 4px 0;">üíä Thu·ªëc y t·∫ø, S·ªØa</div>
                    <div style="font-size: 11px; color: #666;">üìç ƒêang ƒë·∫øn: P. L·ªôc Th·ªç</div>
                </div>
            `;
            L.circleMarker([12.2520, 109.1880], { radius: 10, fillColor: '#3b82f6', color: '#fff', weight: 2, fillOpacity: 0.9 }).addTo(map).bindPopup(convoyPopup1);
            L.circleMarker([12.2380, 109.1920], { radius: 10, fillColor: '#3b82f6', color: '#fff', weight: 2, fillOpacity: 0.9 }).addTo(map).bindPopup(convoyPopup2);
        }

        // Copy coordinates function
        function copyCoordinates(lat, lng, name) {
            const text = `${lat}, ${lng}`;
            navigator.clipboard.writeText(text).then(() => {
                showToast('‚úÖ ƒê√£ sao ch√©p t·ªça ƒë·ªô: ' + text);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('‚úÖ ƒê√£ sao ch√©p t·ªça ƒë·ªô: ' + text);
            });
        }

        function showToast(message) { const toast = document.getElementById('toast'); toast.textContent = message; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }

        // VNeID Login function
        function loginWithVNeID() {
            const cccd = document.getElementById('vneid-cccd').value.trim();
            const pin = document.getElementById('vneid-pin').value.trim();

            if (!cccd) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë CCCD!');
                return;
            }
            if (!pin) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p m√£ PIN!');
                return;
            }

            showToast('üîÑ ƒêang x√°c th·ª±c VNeID...');

            // Simulate VNeID authentication
            setTimeout(() => {
                showToast('‚úÖ X√°c th·ª±c VNeID th√†nh c√¥ng!');
                showScreen('home');
            }, 1500);
        }

        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const toggle = document.getElementById(sectionId + '-toggle');

            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
                toggle.textContent = '‚ñº';
            } else {
                section.classList.add('collapsed');
                toggle.classList.add('collapsed');
                toggle.textContent = '‚ñ∂';
            }
        }

        // Symptom Modal functions
        function openSymptomModal() {
            document.getElementById('symptom-modal').classList.add('show');
        }

        function closeSymptomModal() {
            document.getElementById('symptom-modal').classList.remove('show');
            // Reset all checkboxes
            document.querySelectorAll('.symptom-option').forEach(option => {
                option.classList.remove('selected');
                option.querySelector('input[type="checkbox"]').checked = false;
            });
        }

        function toggleSymptom(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected', checkbox.checked);
        }

        function confirmSymptoms() {
            const selectedSymptoms = [];
            document.querySelectorAll('#symptom-modal .symptom-option.selected').forEach(option => {
                const title = option.querySelector('.symptom-text-title').textContent;
                selectedSymptoms.push(title);
            });

            // Get other symptoms input
            const otherSymptoms = document.getElementById('other-symptoms').value.trim();
            if (otherSymptoms) {
                selectedSymptoms.push('Kh√°c: ' + otherSymptoms);
            }

            if (selectedSymptoms.length === 0) {
                showToast('‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt tri·ªáu ch·ª©ng');
                return;
            }

            // Store selected symptoms for emergency request
            window.selectedSymptoms = selectedSymptoms;

            // Create SMS message with symptoms
            const symptomsText = selectedSymptoms.join(', ');
            showToast('‚úÖ ƒê√£ l∆∞u tri·ªáu ch·ª©ng: ' + selectedSymptoms.length + ' m·ª•c');
            closeSymptomModal();
        }

        // Items Modal functions
        function openItemsModal() {
            document.getElementById('items-modal').classList.add('show');
        }

        function closeItemsModal() {
            document.getElementById('items-modal').classList.remove('show');
            // Reset all checkboxes in items modal
            document.querySelectorAll('#items-modal .symptom-option').forEach(option => {
                option.classList.remove('selected');
                option.querySelector('input[type="checkbox"]').checked = false;
            });
            document.getElementById('other-items').value = '';
        }

        function confirmItems() {
            const selectedItems = [];
            document.querySelectorAll('#items-modal .symptom-option.selected').forEach(option => {
                const title = option.querySelector('.symptom-text-title').textContent;
                selectedItems.push(title);
            });

            // Get other items input
            const otherItems = document.getElementById('other-items').value.trim();
            if (otherItems) {
                selectedItems.push('Kh√°c: ' + otherItems);
            }

            if (selectedItems.length === 0) {
                showToast('‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt v·∫≠t d·ª•ng');
                return;
            }

            // Store selected items for emergency request
            window.selectedItems = selectedItems;

            showToast('‚úÖ ƒê√£ l∆∞u v·∫≠t d·ª•ng c·∫ßn h·ªó tr·ª£: ' + selectedItems.length + ' m·ª•c');
            closeItemsModal();
        }

        // Send emergency request function
        // Send emergency request function - UPDATED
        function sendEmergencyRequest() {
            // Auto get GPS if not already
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const gps = `${pos.coords.latitude}, ${pos.coords.longitude}`;
                    submitEmergency(gps);
                }, err => {
                    submitEmergency("Kh√¥ng l·∫•y ƒë∆∞·ª£c GPS");
                });
            } else {
                submitEmergency("Kh√¥ng h·ªó tr·ª£ GPS");
            }
        }

        function submitEmergency(locationInfo) {
            // Build emergency request message
            let message = 'üÜò Y√äU C·∫¶U H·ªñ TR·ª¢ KH·∫®N C·∫§P\n';
            message += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
            message += 'üìç V·ªã tr√≠: ' + locationInfo + '\n';
            message += 'üïê Th·ªùi gian: ' + new Date().toLocaleString('vi-VN') + '\n\n';

            if (window.selectedSymptoms && window.selectedSymptoms.length > 0) {
                message += 'ü©∫ TRI·ªÜU CH·ª®NG:\n';
                window.selectedSymptoms.forEach((s, i) => {
                    message += '  ‚Ä¢ ' + s + '\n';
                });
                message += '\n';
            }

            if (window.selectedItems && window.selectedItems.length > 0) {
                message += 'üì¶ V·∫¨T D·ª§NG C·∫¶N H·ªñ TR·ª¢:\n';
                window.selectedItems.forEach((item, i) => {
                    message += '  ‚Ä¢ ' + item + '\n';
                });
            }

            console.log(message);
            showToast('‚úÖ ƒê√£ g·ª≠i y√™u c·∫ßu h·ªó tr·ª£!');

            // Close all modals
            closeSymptomModal();
            closeItemsModal();
        }

        // New Functions for Video Location & Add Case Smart Address
        let videoLocInterval;
        function openVideoRecording() {
            document.getElementById('video-modal').classList.add('show');
            refreshVideoLocation(); // Initial fetch
            videoLocInterval = setInterval(refreshVideoLocation, 60000); // Update every minute
        }

        function closeVideoModal() {
            document.getElementById('video-modal').classList.remove('show');
            if (videoLocInterval) clearInterval(videoLocInterval);
        }

        function refreshVideoLocation() {
            const statusEl = document.getElementById('video-location-text');
            statusEl.innerHTML = '<span style="color: var(--orange-500);">‚è≥ ƒêang c·∫≠p nh·∫≠t...</span>';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=vi`);
                        const data = await response.json();
                        statusEl.innerHTML = data.display_name || `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    } catch (e) {
                        statusEl.innerHTML = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    }
                }, () => {
                    statusEl.innerHTML = '‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠';
                });
            } else {
                statusEl.innerHTML = '‚ùå GPS kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£';
            }
        }

        // Add Case Logic
        let caseAddrMode = 'me';
        function toggleCaseAddressMode(mode) {
            caseAddrMode = mode;
            const btnMe = document.getElementById('btn-addr-me');
            const btnRel = document.getElementById('btn-addr-relative');
            const divMe = document.getElementById('addr-mode-me');
            const divRel = document.getElementById('addr-mode-relative');
            const textarea = document.getElementById('case-address');

            if (mode === 'me') {
                btnMe.style.background = 'var(--blue-500)';
                btnMe.style.color = 'white';
                btnMe.style.border = 'none';
                btnRel.style.background = 'white';
                btnRel.style.color = 'var(--gray-700)';
                btnRel.style.border = '1px solid var(--gray-300)';

                divMe.style.display = 'block';
                divRel.style.display = 'none';

                textarea.readOnly = true;
                textarea.style.background = '#f3f4f6';
                getGPSLocation(); // Trigger GPS
            } else {
                btnRel.style.background = 'var(--blue-500)';
                btnRel.style.color = 'white';
                btnRel.style.border = 'none';
                btnMe.style.background = 'white';
                btnMe.style.color = 'var(--gray-700)';
                btnMe.style.border = '1px solid var(--gray-300)';

                divMe.style.display = 'none';
                divRel.style.display = 'block';

                textarea.readOnly = false; // Actually we use hidden input logic but let's just use updateCaseAddressFromFields to sync to textarea
                updateCaseAddressFromFields();
            }
        }

        function updateCaseAddressFromFields() {
            const p = document.getElementById('addr-province').value.trim();
            const d = document.getElementById('addr-district').value.trim();
            const w = document.getElementById('addr-ward').value.trim();
            const s = document.getElementById('addr-street').value.trim();

            const parts = [s, w, d, p].filter(x => x);
            document.getElementById('case-address').value = parts.join(', ');
        }

        // Wrapper for video upload button to just trigger the input
        function handleVideoUploadWrapper() {
            // Label triggers input automatically
        }


        // Convoy photo upload handler
        function handleConvoyPhotoUpload(input, convoyId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const previewContainer = document.getElementById(convoyId + '-photos');
                    const photoItem = document.createElement('div');
                    photoItem.className = 'convoy-photo-item';
                    photoItem.innerHTML = `
                        <img src="${e.target.result}" alt="·∫¢nh ƒë·ªãa ƒëi·ªÉm">
                    `;
                    previewContainer.appendChild(photoItem);
                    showToast('‚úÖ ƒê√£ t·∫£i ·∫£nh ƒë·ªãa ƒëi·ªÉm th√†nh c√¥ng!');
                };
                reader.readAsDataURL(file);
            }
        }

        // Video Recording Functions
        function openVideoRecording() {
            document.getElementById('video-modal').classList.add('show');
        }

        function closeVideoModal() {
            document.getElementById('video-modal').classList.remove('show');
            document.getElementById('video-preview').style.display = 'none';
            document.getElementById('video-description').value = '';
        }

        function handleVideoUpload(input) {
            const file = input.files[0];
            if (file) {
                const videoPreview = document.getElementById('video-preview');
                const videoElement = document.getElementById('recorded-video');
                videoElement.src = URL.createObjectURL(file);
                videoPreview.style.display = 'block';
                showToast('‚úÖ Video ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n!');
            }
        }

        function sendVideoToMedical() {
            const description = document.getElementById('video-description').value.trim();
            const videoElement = document.getElementById('recorded-video');

            if (!videoElement.src) {
                showToast('‚ö†Ô∏è Vui l√≤ng quay video tr∆∞·ªõc!');
                return;
            }

            showToast('üì§ ƒêang g·ª≠i video ƒë·∫øn ƒë·ªôi Y t·∫ø...');

            // Simulate sending
            setTimeout(() => {
                showToast('‚úÖ Video ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ƒë·ªôi Y t·∫ø!');
                closeVideoModal();

                // Update notification badge
                const badge = document.getElementById('notification-badge');
                badge.textContent = parseInt(badge.textContent) + 1;

                alert('üÜò VIDEO ƒê√É ƒê∆Ø·ª¢C G·ª¨I!\n\nƒê·ªôi ng≈© y t·∫ø ƒë√£ nh·∫≠n ƒë∆∞·ª£c video hi·ªán tr·∫°ng c·ªßa b·∫°n.\nH·ªç s·∫Ω li√™n h·ªá b·∫°n trong th·ªùi gian s·ªõm nh·∫•t.');
            }, 1500);
        }

        // Notification Panel Functions
        function openNotificationPanel() {
            document.getElementById('notification-modal').classList.add('show');
            // Reset badge
            document.getElementById('notification-badge').textContent = '0';
        }

        function closeNotificationPanel() {
            document.getElementById('notification-modal').classList.remove('show');
        }

        function replyToNotification(type) {
            const recipient = type === 'medical' ? 'ƒê·ªôi Y t·∫ø' : 'Ng∆∞·ªùi th√¢n';
            const message = prompt(`Nh·∫≠p tin nh·∫Øn g·ª≠i ƒë·∫øn ${recipient}:`);
            if (message) {
                showToast(`‚úÖ ƒê√£ g·ª≠i tin nh·∫Øn ƒë·∫øn ${recipient}!`);
            }
        }

        // Pilot Registration Functions
        function openPilotRegisterModal() {
            document.getElementById('pilot-register-modal').classList.add('show');
        }

        function closePilotRegisterModal() {
            document.getElementById('pilot-register-modal').classList.remove('show');
            // Reset form
            document.getElementById('pilot-name').value = '';
            document.getElementById('pilot-phone').value = '';
            document.getElementById('pilot-area').value = '';
            document.getElementById('pilot-availability').value = '';
            document.getElementById('pilot-notes').value = '';
        }

        function registerPilot() {
            const name = document.getElementById('pilot-name').value.trim();
            const phone = document.getElementById('pilot-phone').value.trim();
            const area = document.getElementById('pilot-area').value.trim();
            const vehicle = document.getElementById('pilot-vehicle').value;
            const availability = document.getElementById('pilot-availability').value.trim();
            const notes = document.getElementById('pilot-notes').value.trim();

            if (!name) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p h·ªç t√™n!');
                return;
            }
            if (!phone) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!');
                return;
            }
            if (!area) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p khu v·ª±c th√¥ng th·∫°o!');
                return;
            }

            // Build pilot info
            const vehicleNames = {
                'motorbike': 'Xe m√°y',
                'car': '√î t√¥',
                'bicycle': 'Xe ƒë·∫°p',
                'walking': 'ƒêi b·ªô',
                'boat': 'Thuy·ªÅn/Ghe'
            };

            let message = 'üß≠ ƒêƒÇNG K√ù HOA TI√äU D·∫™N ƒê∆Ø·ªúNG\n';
            message += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
            message += 'üë§ H·ªç t√™n: ' + name + '\n';
            message += 'üìû SƒêT: ' + phone + '\n';
            message += 'üìç Khu v·ª±c: ' + area + '\n';
            message += 'üèçÔ∏è Ph∆∞∆°ng ti·ªán: ' + vehicleNames[vehicle] + '\n';
            if (availability) message += '‚è∞ Th·ªùi gian: ' + availability + '\n';
            if (notes) message += 'üìù Ghi ch√∫: ' + notes + '\n';
            message += 'üïê ƒêƒÉng k√Ω l√∫c: ' + new Date().toLocaleString('vi-VN');

            console.log(message);

            showToast('‚úÖ ƒêƒÉng k√Ω Hoa ti√™u th√†nh c√¥ng!');
            closePilotRegisterModal();

            alert('üß≠ ƒêƒÇNG K√ù HOA TI√äU TH√ÄNH C√îNG!\n\nTh√¥ng tin c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n v√†o h·ªá th·ªëng.\nC√°c ƒëo√†n thi·ªán nguy·ªán s·∫Ω c√≥ th·ªÉ li√™n h·ªá b·∫°n khi c·∫ßn d·∫´n ƒë∆∞·ªùng.\n\n' + message);
        }

        // Find Pilot Functions  
        function openFindPilotModal() {
            document.getElementById('find-pilot-modal').classList.add('show');
        }

        function closeFindPilotModal() {
            document.getElementById('find-pilot-modal').classList.remove('show');
            document.getElementById('pilot-gps-status').textContent = '';
        }

        function getPilotGPSLocation() {
            const statusDiv = document.getElementById('pilot-gps-status');
            statusDiv.innerHTML = '<span style="color: var(--blue-500);">üì° ƒêang l·∫•y v·ªã tr√≠ GPS...</span>';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        statusDiv.innerHTML = `<span style="color: var(--green-600);">‚úÖ V·ªã tr√≠: ${lat}, ${lng}</span>`;
                        showToast('‚úÖ ƒê√£ x√°c ƒë·ªãnh v·ªã tr√≠! ƒêang t√¨m hoa ti√™u g·∫ßn nh·∫•t...');

                        // Highlight nearest pilot
                        const nearestPilot = document.getElementById('pilot-nearest');
                        nearestPilot.style.animation = 'pulse 1s ease-in-out 3';
                    },
                    (error) => {
                        statusDiv.innerHTML = '<span style="color: var(--red-500);">‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ GPS</span>';
                        showToast('‚ö†Ô∏è Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ GPS!');
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                statusDiv.innerHTML = '<span style="color: var(--red-500);">‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS</span>';
            }
        }

        // Confirm Arrival function for volunteer
        function confirmArrival() {
            const location = document.getElementById('volunteer-arrival-location').value.trim();
            if (!location) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ ƒëi·ªÉm ph√°t qu√†!');
                return;
            }
            showToast('‚úÖ ƒê√£ x√°c nh·∫≠n ƒë·∫øn n∆°i ph√°t qu√†!');
            alert('üìç X√ÅC NH·∫¨N ƒê·∫æN N∆†I!\n\nƒê·ªãa ƒëi·ªÉm: ' + location + '\nTh·ªùi gian: ' + new Date().toLocaleString('vi-VN') + '\n\nTh√¥ng tin ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t l√™n h·ªá th·ªëng.');
        }

        // Get Volunteer GPS Location
        function getVolunteerGPSLocation() {
            const statusDiv = document.getElementById('volunteer-gps-status');
            const locationInput = document.getElementById('volunteer-arrival-location');

            statusDiv.innerHTML = '<span style="color: var(--blue-500);">üì° ƒêang l·∫•y v·ªã tr√≠ GPS...</span>';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        statusDiv.innerHTML = `<span style="color: var(--green-600);">‚úÖ GPS: ${lat}, ${lng}</span>`;
                        locationInput.value = locationInput.value + ` [GPS: ${lat}, ${lng}]`;
                        showToast('‚úÖ ƒê√£ l·∫•y v·ªã tr√≠ GPS!');
                    },
                    (error) => {
                        statusDiv.innerHTML = '<span style="color: var(--red-500);">‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠</span>';
                        showToast('‚ö†Ô∏è Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ GPS!');
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                statusDiv.innerHTML = '<span style="color: var(--red-500);">‚ùå Kh√¥ng h·ªó tr·ª£ GPS</span>';
            }
        }

        // --- NEW: Household Lookup Logic ---

        // Dummy data generator for households
        function generateHouseholds(regionName) {
            const familyNames = ['Nguy·ªÖn', 'Tr·∫ßn', 'L√™', 'Ph·∫°m', 'Hu·ª≥nh', 'Ho√†ng', 'Phan', 'V≈©', 'V√µ', 'ƒê·∫∑ng'];
            const middleNames = ['VƒÉn', 'Th·ªã', 'ƒê·ª©c', 'Th√†nh', 'Minh', 'Ng·ªçc', 'Qu·ªëc', 'H·ªØu'];
            const lastNames = ['An', 'B√¨nh', 'C∆∞·ªùng', 'D≈©ng', 'Em', 'Giang', 'H√πng', 'Huy', 'Kh√°nh', 'Lan', 'Nam', 'Nghƒ©a', 'Ph√∫c', 'Qu√¢n', 'S∆°n', 'T√¢m', 'Th·∫£o', 'T√πng', 'Vi·ªát', 'Y·∫øn'];
            const statuses = [
                { type: 'pending', label: 'Ch∆∞a c·ª©u', color: 'red', icon: 'üÜò' },
                { type: 'inprogress', label: 'ƒêang c·ª©u', color: 'orange', icon: 'üîÑ' },
                { type: 'rescued', label: 'ƒê√£ c·ª©u', color: 'green', icon: '‚úÖ' },
                { type: 'safe', label: 'An to√†n', color: 'blue', icon: 'üîµ' }
            ];
            const healthConditions = ['B√¨nh th∆∞·ªùng', 'B·ªã th∆∞∆°ng nh·∫π', 'S·ªët cao', 'Ki·ªát s·ª©c', 'C·∫ßn thu·ªëc g·∫•p', 'C√≥ ng∆∞·ªùi gi√† y·∫øu'];

            let households = [];
            for (let i = 1; i <= 20; i++) {
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                const randomHealth = healthConditions[Math.floor(Math.random() * healthConditions.length)];
                const isRescued = randomStatus.type === 'rescued' || randomStatus.type === 'safe';

                households.push({
                    id: i,
                    name: `${familyNames[Math.floor(Math.random() * familyNames.length)]} ${middleNames[Math.floor(Math.random() * middleNames.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`,
                    address: `S·ªë nh√† ${Math.floor(Math.random() * 100) + 1}, ${regionName}`,
                    phone: `09${Math.floor(Math.random() * 90000000 + 10000000)}`,
                    people: Math.floor(Math.random() * 4) + 2, // 2-6 people
                    status: randomStatus,
                    health: randomHealth,
                    rescuedTime: isRescued ? `${Math.floor(Math.random() * 24)} gi·ªù tr∆∞·ªõc` : null,
                    note: isRescued ? 'ƒê√£ ƒë∆∞·ª£c ƒë∆∞a v·ªÅ n∆°i an to√†n' : 'N∆∞·ªõc ng·∫≠p s√¢u, c·∫ßn h·ªó tr·ª£ g·∫•p'
                });
            }
            return households;
        }

        let currentHouseholds = [];

        function showRegionDetail(regionId) {
            // Map region IDs to Names
            const regionNames = {
                'vinh-luong': 'X√£ Vƒ©nh L∆∞∆°ng',
                'vinh-hai': 'Ph∆∞·ªùng Vƒ©nh H·∫£i',
                'vinh-ngoc': 'Ph∆∞·ªùng Vƒ©nh Ng·ªçc',
                'vinh-tho': 'Ph∆∞·ªùng Vƒ©nh Th·ªç',
                'phuoc-hai': 'Ph∆∞·ªùng Ph∆∞·ªõc H·∫£i',
                'loc-tho': 'Ph∆∞·ªùng L·ªôc Th·ªç',
                'phuoc-long': 'Ph∆∞·ªùng Ph∆∞·ªõc Long',
                'vinh-nguyen': 'Ph∆∞·ªùng Vƒ©nh Nguy√™n',
                'phuoc-tien': 'Ph∆∞·ªùng Ph∆∞·ªõc Ti·∫øn',
                'tan-lap': 'Ph∆∞·ªùng Ph∆∞·ªõc T√¢n L·∫≠p'
            };

            const name = regionNames[regionId] || 'Khu v·ª±c ch∆∞a x√°c ƒë·ªãnh';

            // Generate dummy data
            currentHouseholds = generateHouseholds(name);

            // Update Title
            const titleEl = document.getElementById('region-detail-title');
            if (titleEl) titleEl.textContent = name;

            // Render Stats
            updateRegionStats();

            // Render List
            renderHouseholdList(currentHouseholds);

            // Show screen
            showScreen('household-detail');
        }

        function updateRegionStats() {
            let pending = 0, inprogress = 0, rescued = 0, safe = 0;
            currentHouseholds.forEach(h => {
                if (h.status.type === 'pending') pending++;
                else if (h.status.type === 'inprogress') inprogress++;
                else if (h.status.type === 'rescued') rescued++;
                else if (h.status.type === 'safe') safe++;
            });

            document.querySelector('#stat-pending div:first-child').textContent = pending;
            document.querySelector('#stat-inprogress div:first-child').textContent = inprogress;
            document.querySelector('#stat-rescued div:first-child').textContent = rescued;
            document.querySelector('#stat-safe div:first-child').textContent = safe;
        }

        function renderHouseholdList(list) {
            const container = document.getElementById('household-list');
            container.innerHTML = '';

            if (list.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--gray-500); padding: 20px;">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</div>';
                return;
            }

            list.forEach(h => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.padding = '12px';
                card.style.marginBottom = '10px';
                card.style.borderLeft = `4px solid var(--${h.status.color}-500)`;

                let details = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                        <div style="font-weight: 700; font-size: 15px; color: var(--gray-800);">${h.name}</div>
                        <div style="font-size: 11px; font-weight: 600; background: var(--${h.status.color}-100); color: var(--${h.status.color}-600); padding: 4px 8px; border-radius: 12px; white-space: nowrap;">
                            ${h.status.icon} ${h.status.label}
                        </div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-600); margin-bottom: 4px;">üìç ${h.address}</div>
                    <div style="font-size: 13px; color: var(--gray-600); margin-bottom: 4px;">üë• Gia ƒë√¨nh: ${h.people} ng∆∞·ªùi</div>
                    <div style="font-size: 13px; color: var(--gray-600); margin-bottom: 4px;">üè• S·ª©c kh·ªèe: <span style="font-weight: 600;">${h.health}</span></div>
                `;

                if (h.rescuedTime) {
                    details += `<div style="font-size: 12px; color: var(--green-600); margin-top: 6px;">üïí ƒê√£ c·ª©u l√∫c: ${h.rescuedTime}</div>`;
                } else {
                    details += `<div style="font-size: 12px; color: var(--red-600); margin-top: 6px;">‚ö†Ô∏è ${h.note}</div>`;
                }

                card.innerHTML = details;
                container.appendChild(card);
            });

            // Update search count
            const countEl = document.getElementById('search-result-count');
            if (countEl) countEl.textContent = `Hi·ªÉn th·ªã ${list.length} h·ªô d√¢n`;
        }

        function filterHouseholds(query) {
            if (!query) {
                renderHouseholdList(currentHouseholds);
                return;
            }
            const lowerInfo = query.toLowerCase();
            const filtered = currentHouseholds.filter(h =>
                h.name.toLowerCase().includes(lowerInfo) ||
                h.address.toLowerCase().includes(lowerInfo)
            );
            renderHouseholdList(filtered);
        }
        // Home Screen Location Tracking works
        let homeLocInterval;

        function initHomeLocation() {
            refreshHomeLocation();
            homeLocInterval = setInterval(refreshHomeLocation, 60000); // 1 minute
        }

        function refreshHomeLocation() {
            const statusEl = document.getElementById('home-location-text');
            if (!statusEl) return;

            statusEl.innerHTML = '<span style="color: var(--orange-500);">‚è≥ ƒêang c·∫≠p nh·∫≠t...</span>';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=vi`);
                        const data = await response.json();
                        statusEl.innerHTML = data.display_name || `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    } catch (e) {
                        statusEl.innerHTML = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    }
                }, () => {
                    statusEl.innerHTML = '‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠';
                });
            } else {
                statusEl.innerHTML = '‚ùå GPS kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£';
            }
        }

        // Start on load
        window.addEventListener('load', initHomeLocation);

        // ========== LANGUAGE TOGGLE FUNCTIONALITY ==========
        let currentLang = localStorage.getItem('appLanguage') || 'vi';

        function applyLanguage() {
            // Update flag icons
            const newFlag = currentLang === 'vi' ? 'üáªüá≥' : 'üá¨üáß';
            const loginFlag = document.getElementById('lang-flag-login');
            if (loginFlag) loginFlag.textContent = newFlag;

            // Toggle visibility of language spans
            document.querySelectorAll('.lang-vi').forEach(el => {
                el.style.display = currentLang === 'vi' ? '' : 'none';
            });
            document.querySelectorAll('.lang-en').forEach(el => {
                el.style.display = currentLang === 'en' ? '' : 'none';
            });
        }

        function toggleLanguage() {
            currentLang = currentLang === 'vi' ? 'en' : 'vi';
            localStorage.setItem('appLanguage', currentLang);
            applyLanguage();
            showToast(currentLang === 'vi' ? 'üáªüá≥ ƒê√£ chuy·ªÉn sang Ti·∫øng Vi·ªát' : 'üá¨üáß Switched to English');
        }

        // Apply language on load
        window.addEventListener('DOMContentLoaded', applyLanguage);

        // ========== SOS FUNCTIONALITY ==========
        let sosTimer = null;
        let sosProgress = 0;
        let sosInterval = null;
        let sosGpsLat = null;
        let sosGpsLng = null;

        function toggleSOSOverlay(show) {
            const overlay = document.getElementById('sos-overlay');
            const victimPanel = document.getElementById('victim-info-panel');
            const btnContainer = document.getElementById('sos-btn-container');

            if (show) {
                overlay.style.display = 'flex';
                victimPanel.style.display = 'none';
                btnContainer.style.display = 'block';
                resetSOSProgress();
                initSOS();
                getSOSLocation();
            } else {
                overlay.style.display = 'none';
                cancelSOS();
            }
        }

        function initSOS() {
            const btn = document.getElementById('sos-btn');
            if (!btn) return;

            // Remove old listeners
            btn.replaceWith(btn.cloneNode(true));
            const newBtn = document.getElementById('sos-btn');

            // Mouse events
            newBtn.addEventListener('mousedown', startSOS);
            newBtn.addEventListener('mouseup', cancelSOS);
            newBtn.addEventListener('mouseleave', cancelSOS);

            // Touch events
            newBtn.addEventListener('touchstart', startSOS);
            newBtn.addEventListener('touchend', cancelSOS);
            newBtn.addEventListener('touchcancel', cancelSOS);
        }

        function startSOS(e) {
            e.preventDefault();
            sosProgress = 0;
            updateProgressRing(0);

            sosInterval = setInterval(() => {
                sosProgress += 3.33; // 3 seconds = 100%
                updateProgressRing(sosProgress);

                if (sosProgress >= 100) {
                    clearInterval(sosInterval);
                    activateSOS();
                }
            }, 100);
        }

        function cancelSOS() {
            if (sosInterval) {
                clearInterval(sosInterval);
                sosInterval = null;
            }
            resetSOSProgress();
        }

        function resetSOSProgress() {
            sosProgress = 0;
            updateProgressRing(0);
        }

        function updateProgressRing(percent) {
            const circle = document.getElementById('sos-progress-circle');
            if (!circle) return;
            const circumference = 2 * Math.PI * 74; // r=74
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        function activateSOS() {
            // Hide SOS button, show victim info
            document.getElementById('sos-btn-container').style.display = 'none';
            document.getElementById('victim-info-panel').style.display = 'block';

            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }

            // Show toast
            showToast(currentLang === 'vi' ? 'üÜò ƒê√£ k√≠ch ho·∫°t c·∫ßu c·ª©u!' : 'üÜò Emergency activated!');
        }

        function getSOSLocation() {
            const coordsEl = document.getElementById('sos-gps-coords');
            if (!coordsEl) return;

            if (navigator.geolocation) {
                coordsEl.textContent = currentLang === 'vi' ? 'ƒêang l·∫•y t·ªça ƒë·ªô...' : 'Getting coordinates...';
                navigator.geolocation.getCurrentPosition(
                    position => {
                        sosGpsLat = position.coords.latitude;
                        sosGpsLng = position.coords.longitude;
                        coordsEl.textContent = `${sosGpsLat.toFixed(6)}, ${sosGpsLng.toFixed(6)}`;
                    },
                    () => {
                        coordsEl.textContent = currentLang === 'vi' ? '‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠' : '‚ùå Cannot get location';
                    }
                );
            } else {
                coordsEl.textContent = currentLang === 'vi' ? '‚ùå GPS kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£' : '‚ùå GPS not supported';
            }
        }

        function sendEmergencySMS() {
            // Victim information
            const victimInfo = {
                name: 'Nguy·ªÖn Tr·∫ßn Ti·∫øn Ph√∫c',
                cccd: '012345678901',
                address: '123 ƒê∆∞·ªùng 2 Th√°ng 4, P. Vƒ©nh H·∫£i, TP. Nha Trang',
                phone: '0342381843',
                bloodType: 'O+',
                conditions: 'Ti·ªÉu ƒë∆∞·ªùng type 2, Huy·∫øt √°p cao',
                allergies: 'Penicillin, H·∫£i s·∫£n'
            };

            // Build SMS content
            let smsBody = currentLang === 'vi'
                ? `üÜò C·∫¶U C·ª®U KH·∫®N C·∫§P!\n\nüë§ H·ªç t√™n: ${victimInfo.name}\nü™™ CCCD: ${victimInfo.cccd}\nüìç ƒê·ªãa ch·ªâ: ${victimInfo.address}\nüìû SƒêT: ${victimInfo.phone}\nü©∏ Nh√≥m m√°u: ${victimInfo.bloodType}\n‚ö†Ô∏è B·ªánh n·ªÅn: ${victimInfo.conditions}\nüö´ D·ªã ·ª©ng: ${victimInfo.allergies}`
                : `üÜò EMERGENCY HELP!\n\nüë§ Name: ${victimInfo.name}\nü™™ ID: ${victimInfo.cccd}\nüìç Address: ${victimInfo.address}\nüìû Phone: ${victimInfo.phone}\nü©∏ Blood: ${victimInfo.bloodType}\n‚ö†Ô∏è Conditions: ${victimInfo.conditions}\nüö´ Allergies: ${victimInfo.allergies}`;

            // Add GPS if available
            if (sosGpsLat && sosGpsLng) {
                const gpsText = currentLang === 'vi' ? 'T·ªça ƒë·ªô GPS' : 'GPS Location';
                smsBody += `\n\nüìç ${gpsText}: ${sosGpsLat.toFixed(6)}, ${sosGpsLng.toFixed(6)}`;
                smsBody += `\nüó∫Ô∏è Google Maps: https://maps.google.com/?q=${sosGpsLat},${sosGpsLng}`;
            }

            // Emergency number (can be customized)
            const emergencyNumber = '113';

            // Create SMS URI
            const smsUri = `sms:${emergencyNumber}?body=${encodeURIComponent(smsBody)}`;

            // Open SMS app
            window.location.href = smsUri;
        }
    </script>
</body>

</html>
